{% extends 'base.html' %}
{% load static %}

{% block title %}Conteúdo{% endblock %}

{% block extra_css %}
<style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
    
    .card-hover {
      transition: all 0.3s ease;
    }
    
    .card-hover:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px -5px rgba(59, 130, 246, 0.4);
    }
    
    .progress-bar {
      overflow: hidden;
      position: relative;
    }
    
    .progress-bar::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      height: 100%;
      width: 45%;
      background: linear-gradient(90deg, #3B82F6 0%, #1E40AF 100%);
      border-radius: 9999px;
      animation: progressAnimation 1.5s ease-in-out;
    }
    
    @keyframes progressAnimation {
      0% { width: 0%; }
      100% { width: 45%; }
    }
    
    .module-card {
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }
    
    .module-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px -5px rgba(59, 130, 246, 0.4);
    }
    
    .module-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 4px;
      background: linear-gradient(90deg, #3B82F6 0%, #1E40AF 100%);
    }
    
    .locked-module {
      position: relative;
    }
    
    .locked-module::after {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(255, 255, 255, 0.9);
      border-radius: 1rem;
      display: flex;
      align-items: center;
      justify-content: center;
      background-image: url("{% static 'imagem/lock_100dp_2682EA_FILL0_wght400_GRAD0_opsz48.png' %}");
      background-repeat: no-repeat;
      background-position: center;
      background-size: 50px;
    }
    
    .floating-element {
      animation: float 6s ease-in-out infinite;
    }
    
    @keyframes float {
      0% { transform: translateY(0px); }
      50% { transform: translateY(-10px); }
      100% { transform: translateY(0px); }
    }
    
    .circular-chart {
      display: block;
      max-width: 100%;
      max-height: 100%;
    }
    
    .circle-bg {
      fill: none;
      stroke: #EFF6FF;
      stroke-width: 3.8;
    }
    
    .circle {
      fill: none;
      stroke-width: 2.8;
      stroke-linecap: round;
      stroke: #3B82F6;
      animation: progress 1.5s ease-out forwards;
    }
    
    @keyframes progress {
      0% { stroke-dasharray: 0 100; }
    }
    
    .percentage {
      fill: #1E40AF;
      font-size: 0.5em;
      text-anchor: middle;
      font-weight: bold;
    }
  </style>
{% endblock %}

{% block content %}
<!-- Cabeçalho com título e estatísticas -->
<div class="mb-8">
  <h1 class="text-3xl font-bold text-blue-700 mb-2">Trilha de Aprendizado</h1>
  <p class="text-blue-600">Domine Python através de uma jornada gamificada e divertida</p>
  
  <!-- Cartões de visão geral -->
  <div class="grid md:grid-cols-3 gap-6 mt-6">
    <div class="bg-blue-700 text-white rounded-2xl p-5 shadow-lg flex flex-col items-center">
      <img src="{% static 'imagem/check_circle_35dp_FFFFFF_FILL0_wght400_GRAD0_opsz40.png' %}" alt="Concluídos" class="w-10 h-10 mb-2">
      <h3 class="font-bold text-lg">Capítulos Concluídos</h3>
      <p class="text-4xl font-extrabold mt-1">0</p>
    </div>
    
    <div class="bg-blue-700 text-white rounded-2xl p-5 shadow-lg flex flex-col items-center">
      <img src="{% static 'imagem/play_circle_35dp_FFFFFF_FILL0_wght400_GRAD0_opsz40.png' %}" alt="Em Progresso" class="w-10 h-10 mb-2">
      <h3 class="font-bold text-lg">Em Progresso</h3>
      <p class="text-4xl font-extrabold mt-1">3</p>
    </div>
    
    <div class="bg-blue-700 text-white rounded-2xl p-5 shadow-lg flex flex-col items-center">
      <img src="{% static 'imagem/lock_35dp_FFFFFF_FILL0_wght400_GRAD0_opsz40.png' %}" alt="Bloqueados" class="w-10 h-10 mb-2">
      <h3 class="font-bold text-lg">Bloqueados</h3>
      <p class="text-4xl font-extrabold mt-1">2</p>
    </div>
  </div>
</div>

<!-- Dica -->
<div class="bg-gradient-to-r from-blue-100 to-blue-50 border-l-4 border-blue-500 text-blue-700 text-sm rounded-r-xl p-4 mb-8 shadow flex items-start">
  <img src="{% static 'imagem/lightbulb_2_100dp_2682EA_FILL0_wght400_GRAD0_opsz48.png' %}" alt="Dica" class="w-6 h-6 mr-3 flex-shrink-0">
  <p>Complete os capítulos em ordem para uma melhor experiência de aprendizado e desbloqueie conquistas especiais!</p>
</div>

<!-- Grid de módulos -->
<div class="grid md:grid-cols-2 lg:grid-cols-3 gap-6">

  {% for chapter in page_obj %}
  <!-- Módulo {{ chapter.id }} -->
  <div class="module-card bg-gradient-to-b from-white to-blue-50 border border-blue-200 rounded-2xl shadow p-5 relative {% if chapter.bloqueado %}locked-module{% endif %}">
    
    {% if not chapter.bloqueado %}
    <a href="{% url 'modulos' %}">
    {% endif %}
    
      <div class="flex items-center justify-between mb-3">
        <span class="text-xs bg-blue-100 text-blue-600 font-bold px-3 py-1 rounded-full">
          {% if chapter.id <= 2 %}Iniciante{% elif chapter.id <= 4 %}Intermediário{% else %}Avançado{% endif %}
        </span>
        <div class="w-10 h-10">
          <svg viewBox="0 0 36 36" class="circular-chart">
            <path class="circle-bg" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
            <path class="circle" stroke-dasharray="{{ chapter.progresso }}, 100" d="M18 2.0845 a 15.9155 15.9155 0 0 1 0 31.831 a 15.9155 15.9155 0 0 1 0 -31.831" />
            <text x="18" y="20.35" class="percentage">{{ chapter.progresso }}%</text>
          </svg>
        </div>
      </div>
      
      <div class="flex justify-center mb-4">
        <img src="{% static chapter.imagem %}" alt="{{ chapter.nome }}" class="w-16 h-16 {% if not chapter.bloqueado %}floating-element{% endif %}">
      </div>
      
      <h3 class="font-bold text-lg text-blue-800 mb-2 {% if chapter.bloqueado %}opacity-50{% endif %}">{{ chapter.nome }}</h3>
      <p class="text-sm text-blue-600 mb-4 {% if chapter.bloqueado %}opacity-50{% endif %}">{{ chapter.descricao }}</p>

      <!-- Barra de progresso -->
      <div class="mt-4">
        <div class="w-full bg-blue-200 rounded-full h-2">
          <div class="bg-gradient-to-r from-blue-500 to-blue-700 h-2 rounded-full" style="width: {{ chapter.progresso }}%"></div>
        </div>
        <p class="text-xs text-blue-500 mt-2">
          {% if chapter.progresso > 0 %}
            {{ chapter.progresso|floatformat:0 }}% concluído
          {% else %}
            Não iniciado
          {% endif %}
        </p>
      </div>
      
      {% if not chapter.bloqueado %}
      <div class="absolute bottom-3 right-3">
        <img src="{% static 'imagem/arrow_forward_35dp_2682EA_FILL0_wght400_GRAD0_opsz40.png' %}" alt="Abrir" class="w-5 h-5 opacity-0 transition-opacity group-hover:opacity-100">
      </div>
      {% endif %}
    
    {% if not chapter.bloqueado %}
    </a>
    {% endif %}

    {% if chapter.bloqueado %}
    <div class="mt-6 text-center">
      <span class="text-xs bg-blue-200 text-blue-700 font-medium px-3 py-1 rounded-full">Complete o módulo anterior para desbloquear</span>
    </div>
    {% endif %}
  </div>
  {% endfor %}

</div>

<!-- PAGINAÇÃO - ESTILO TAREFAS -->
<div class="mt-8 flex justify-between items-center border-t border-blue-200 pt-4">
    <div class="text-sm text-blue-600">
        Mostrando {{ page_obj|length }} de {{ page_obj.paginator.count }} capítulos
    </div>
    
    <div class="flex items-center gap-4">
        {% if page_obj.has_previous %}
            <a href="?page={{ page_obj.previous_page_number }}" class="bg-blue-100 text-blue-600 px-4 py-2 rounded-lg hover:bg-blue-200 transition">
                ←
            </a>
        {% endif %}
        
        <span class="text-blue-600 font-medium">
            Página {{ page_obj.number }} de {{ page_obj.paginator.num_pages }}
        </span>
        
        {% if page_obj.has_next %}
            <a href="?page={{ page_obj.next_page_number }}" class="bg-blue-100 text-blue-600 px-4 py-2 rounded-lg hover:bg-blue-200 transition">
                →
            </a>
        {% endif %}
    </div>
</div>

{% endblock %}