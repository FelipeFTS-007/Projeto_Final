{% extends "base.html" %}
{% load static %}

{% block title %}F√≥rum - PyQuest{% endblock %}

{% block extra_css %}
<style>
  @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
  
  /* Vari√°veis de cores para consist√™ncia */
  :root {
      --primary-blue: #3B82F6;
      --primary-dark-blue: #1E40AF;
      --light-blue: #EFF6FF;
      --text-blue: #1E40AF;
      --light-bg: #F8FAFC;
  }
  
  /* Anima√ß√µes globais */
  @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
  }
  
  @keyframes float {
      0% { transform: translateY(0px); }
      50% { transform: translateY(-8px); }
      100% { transform: translateY(0px); }
  }
  
  @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
  }
  
  @keyframes heartPulse {
    0% { transform: scale(1); }
    25% { transform: scale(1.3); }
    50% { transform: scale(0.9); }
    75% { transform: scale(1.15); }
    100% { transform: scale(1); }
  }

  .animate-heart {
    animation: heartPulse 0.4s ease-in-out;
  }

  /* Cabe√ßalho modernizado */
  .page-header {
      background: linear-gradient(135deg, #3B82F6 0%, #1E40AF 100%);
      border-radius: 1.5rem;
      padding: 2.5rem;
      margin-bottom: 2rem;
      position: relative;
      overflow: hidden;
      box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
  }
  
  .page-header::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.1'%3E%3Ccircle cx='30' cy='30' r='2'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
      animation: float 6s ease-in-out infinite;
  }
  
  .header-content {
      position: relative;
      z-index: 2;
  }
  
  .page-title {
      font-size: 2.5rem;
      font-weight: 800;
      color: white;
      margin-bottom: 0.5rem;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      background: linear-gradient(135deg, #fff 0%, #f0f4ff 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
  }
  
  .page-subtitle {
      font-size: 1.125rem;
      color: rgba(255, 255, 255, 0.9);
      margin-bottom: 0;
      font-weight: 400;
      max-width: 600px;
  }

  /* Estat√≠sticas modernizadas */
  .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 1.5rem;
      margin-bottom: 2rem;
  }
  
  .stat-card {
      border-radius: 1rem;
      padding: 1.5rem;
      box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
      transition: all 0.3s ease;
      display: flex;
      flex-direction: column;
      align-items: center;
      text-align: center;
      position: relative;
      overflow: hidden;
  }
  
  .stat-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 4px;
      background: linear-gradient(90deg, var(--card-color-1, #3B82F6), var(--card-color-2, #1E40AF));
  }
  
  .stat-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
  }
  
  .stat-icon {
      width: 3rem;
      height: 3rem;
      margin-bottom: 1rem;
      display: flex;
      align-items: center;
      justify-content: center;
      border-radius: 0.75rem;
      background: rgba(255, 255, 255, 0.2);
  }
  
  .stat-number {
      font-size: 2rem;
      font-weight: 700;
      color: white;
      margin-bottom: 0.25rem;
      text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
  }
  
  .stat-label {
      font-size: 0.875rem;
      color: rgba(255, 255, 255, 0.9);
      font-weight: 500;
  }
  
  /* Cores espec√≠ficas para cada card de estat√≠stica */
  .stat-card-members {
      background: linear-gradient(135deg, #10B981 0%, #059669 100%);
      --card-color-1: #10B981;
      --card-color-2: #059669;
  }
  
  .stat-card-active {
      background: linear-gradient(135deg, #F59E0B 0%, #D97706 100%);
      --card-color-1: #F59E0B;
      --card-color-2: #D97706;
  }
  
  .stat-card-posts {
      background: linear-gradient(135deg, #8B5CF6 0%, #7C3AED 100%);
      --card-color-1: #8B5CF6;
      --card-color-2: #7C3AED;
  }

  /* Posts modernizados */
  .post {
    background: white;
    border-radius: 1.5rem;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    overflow: hidden;
    transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
    position: relative;
    animation: fadeIn 0.5s ease forwards;
    opacity: 0;
    transform: translateY(10px);
    border: 2px solid transparent;
    margin-bottom: 1.5rem;
  }

  .post:hover {
    transform: translateY(-8px);
    box-shadow: 0 20px 25px -5px rgba(59, 130, 246, 0.2), 0 10px 10px -5px rgba(59, 130, 246, 0.1);
    border-color: var(--primary-blue);
  }

  .comment {
    border-left: 3px solid #e5e7eb;
  }

  .comment:hover {
    border-left-color: var(--primary-blue);
  }

  .reply-form {
    transition: all 0.3s ease;
  }

  .filter-btn {
    background: white;
    border: 1px solid #CBD5E1;
    border-radius: 9999px;
    padding: 0.5rem 1.25rem;
    font-size: 0.875rem;
    font-weight: 500;
    color: #64748B;
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .filter-btn:hover {
    border-color: var(--primary-blue);
    color: var(--primary-blue);
    transform: translateY(-2px);
  }

  .filter-btn.active {
    background: var(--primary-blue);
    color: white;
    border-color: var(--primary-blue);
  }

  .avatar {
    transition: transform 0.2s ease;
  }

  .avatar:hover {
    transform: scale(1.05);
  }

  /* CORRE√á√ÉO DA IMAGEM - REMOVIDO OBJECT-COVER */
  .post-image {
    width: 100%;
    height: auto;
    border-radius: 12px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    transition: transform 0.3s ease;
    max-height: 500px;
    object-fit: contain;
  }

  /* Estilos para o modal de perfil */
  #profileModal {
    font-family: inherit;
  }

  .modal-enter {
    transition: all 0.3s ease;
  }

  .animate-fadeInUp {
    animation: fadeInUp 0.4s ease-out;
  }

  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(20px) scale(0.95);
    }
    to {
      opacity: 1;
      transform: translateY(0) scale(1);
    }
  }

  .post-image:hover {
    transform: scale(1.01);
  }

  /* Estilos para o emoji picker */
  .emoji-picker-container {
    position: relative;
    margin-bottom: 8px;
  }

  .emoji-trigger {
    background: #f3f4f6;
    border: 1px solid #d1d5db;
    border-radius: 6px;
    padding: 4px 8px;
    cursor: pointer;
    font-size: 1.2rem;
    transition: all 0.2s ease;
  }

  .emoji-trigger:hover {
    background: #e5e7eb;
    transform: scale(1.05);
  }

  .emoji-panel {
    position: absolute;
    bottom: 100%;
    left: 0;
    background: white;
    border: 1px solid #d1d5db;
    border-radius: 12px;
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
    padding: 12px;
    z-index: 1000;
    max-height: 200px;
    overflow-y: auto;
    display: none;
    backdrop-filter: blur(10px);
  }

  .emoji-category {
    margin-bottom: 12px;
  }

  .emoji-category h4 {
    margin: 0 0 8px 0;
    font-size: 0.75rem;
    color: #6b7280;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .emoji-grid {
    display: grid;
    grid-template-columns: repeat(8, 1fr);
    gap: 4px;
  }

  .emoji-btn {
    background: none;
    border: none;
    padding: 6px;
    cursor: pointer;
    border-radius: 6px;
    font-size: 1.3rem;
    transition: all 0.2s ease;
  }

  .emoji-btn:hover {
    background: var(--primary-blue);
    transform: scale(1.2);
  }

  .file-upload-preview {
    margin-top: 8px;
  }

  .image-preview {
    max-width: 200px;
    max-height: 150px;
    border-radius: 8px;
    margin-top: 4px;
    border: 2px solid #e5e7eb;
    object-fit: contain;
  }

  /* Estilos modernos para os modais */
  .modal-overlay {
    background: rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(8px);
  }

  .modal-content {
    background: white;
    border-radius: 20px;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
    border: 1px solid rgba(255, 255, 255, 0.2);
    width: 100%;
    max-width: 600px;
  }

  .modal-header {
    border-bottom: 1px solid #e5e7eb;
    padding: 0;
  }

  .modal-body {
    padding: 1.5rem;
    max-height: 70vh;
    overflow-y: auto;
  }

  .modal-footer {
    border-top: 1px solid #e5e7eb;
    padding: 1.5rem;
  }

  .btn-primary {
    background: linear-gradient(135deg, var(--primary-blue) 0%, var(--primary-dark-blue) 100%);
    border: none;
    border-radius: 10px;
    padding: 10px 24px;
    font-weight: 600;
    transition: all 0.3s ease;
    color: white;
  }

  .btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(59, 130, 246, 0.4);
  }

  .btn-secondary {
    background: #f8fafc;
    border: 1px solid #e5e7eb;
    border-radius: 10px;
    padding: 10px 24px;
    font-weight: 600;
    transition: all 0.3s ease;
  }

  .btn-secondary:hover {
    background: #f1f5f9;
    transform: translateY(-1px);
  }

  .form-input {
    border: 2px solid #e5e7eb;
    border-radius: 12px;
    padding: 12px 16px;
    transition: all 0.3s ease;
    font-size: 14px;
    width: 100%;
  }

  .form-input:focus {
    border-color: var(--primary-blue);
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    transform: translateY(-1px);
  }

  /* Sidebar modernizada */
  .sidebar-card {
    background: white;
    border-radius: 1.5rem;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    overflow: hidden;
    transition: all 0.3s ease;
    margin-bottom: 1.5rem;
    border: 2px solid transparent;
  }

  .sidebar-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
    border-color: var(--primary-blue);
  }

  /* Hashtags modernizadas */
  .hashtag {
    background: linear-gradient(to right, var(--light-blue), #EDF2FF);
    color: var(--text-blue);
    padding: 0.5rem 1rem;
    border-radius: 9999px;
    font-size: 0.875rem;
    font-weight: 500;
    transition: all 0.3s ease;
    border: 1px solid #E2E8F0;
  }

  .hashtag:hover {
    background: var(--primary-blue);
    color: white;
    transform: translateY(-2px);
  }

  /* Toast modernizado */
  #toast {
    background: linear-gradient(135deg, var(--primary-blue) 0%, var(--primary-dark-blue) 100%);
    color: white;
    border-radius: 1rem;
    box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
  }

  /* Pagina√ß√£o moderna */
  .pagination {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-top: 3rem;
    padding-top: 1.5rem;
    border-top: 1px solid #E2E8F0;
  }
  
  .pagination-info {
    color: #64748B;
    font-size: 0.875rem;
  }
  
  .pagination-controls {
    display: flex;
    gap: 0.75rem;
  }
  
  .pagination-btn {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    background: white;
    border: 1px solid #CBD5E1;
    border-radius: 0.75rem;
    padding: 0.5rem 1rem;
    font-size: 0.875rem;
    color: #64748B;
    transition: all 0.3s ease;
  }
  
  .pagination-btn:hover {
    border-color: var(--primary-blue);
    color: var(--primary-blue);
    transform: translateY(-2px);
  }
  
  .pagination-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    transform: none;
  }

  /* Anima√ß√µes de entrada para os posts */
  .post:nth-child(1) { animation-delay: 0.1s; }
  .post:nth-child(2) { animation-delay: 0.2s; }
  .post:nth-child(3) { animation-delay: 0.3s; }
  .post:nth-child(4) { animation-delay: 0.4s; }
  .post:nth-child(5) { animation-delay: 0.5s; }
  .post:nth-child(6) { animation-delay: 0.6s; }

  /* ===== ESTILOS ESPEC√çFICOS PARA MODAIS MODERNIZADOS ===== */
  
  /* Modal Header com Gradiente */
  .modal-gradient-header {
    background: linear-gradient(135deg, var(--primary-blue) 0%, var(--primary-dark-blue) 100%);
    color: white;
    border-radius: 1.5rem 1.5rem 0 0;
    padding: 1.5rem;
  }

  /* Bot√µes de ferramentas */
  .tool-btn {
    padding: 0.5rem;
    border-radius: 0.5rem;
    color: #6b7280;
    transition: all 0.2s ease;
    border: none;
    background: transparent;
    cursor: pointer;
  }

  .tool-btn:hover {
    background: #e5e7eb;
    color: var(--primary-blue);
  }

  /* √Årea de upload moderna */
  .file-upload-section {
    border: 2px dashed #d1d5db;
    border-radius: 1rem;
    padding: 1.5rem;
    transition: all 0.3s ease;
    cursor: pointer;
  }

  .file-upload-section:hover {
    border-color: var(--primary-blue);
    background: var(--light-blue);
  }

  .file-upload-area.dragover {
    border-color: var(--primary-blue);
    background: #f0f7ff;
    transform: scale(1.02);
  }

  .upload-content {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-align: center;
  }

  .upload-icon {
    font-size: 2rem;
    color: var(--primary-blue);
    margin-bottom: 0.5rem;
  }

  .upload-text {
    margin-top: 0.75rem;
  }

  /* Tags sugeridas */
  .suggested-tags {
    animation: fadeIn 0.3s ease-out;
  }

  .suggested-tag {
    padding: 0.5rem 1rem;
    background: var(--light-blue);
    color: var(--text-blue);
    border-radius: 9999px;
    font-size: 0.875rem;
    font-weight: 500;
    transition: all 0.2s ease;
    border: none;
    cursor: pointer;
  }

  .suggested-tag:hover {
    background: var(--primary-blue);
    color: white;
    transform: translateY(-1px);
  }

  /* Bot√£o de publicar */
  .publish-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    transform: none !important;
  }

  .publish-btn:not(:disabled):hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(59, 130, 246, 0.4);
  }

  /* Preview de imagem */
  .image-preview-container {
    position: relative;
    display: inline-block;
    margin-top: 0.75rem;
  }

  .image-preview {
    max-width: 100%;
    max-height: 12rem;
    border-radius: 0.75rem;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
  }

  .remove-image {
    position: absolute;
    top: -0.5rem;
    right: -0.5rem;
    background: #ef4444;
    color: white;
    border-radius: 9999px;
    padding: 0.25rem;
    transition: all 0.2s ease;
    border: none;
    cursor: pointer;
    width: 1.5rem;
    height: 1.5rem;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .remove-image:hover {
    background: #dc2626;
    transform: scale(1.1);
  }

  /* Modal de confirma√ß√£o */
  .confirmation-modal {
    text-align: center;
    padding: 2rem;
  }

  .confirmation-icon {
    width: 4rem;
    height: 4rem;
    margin: 0 auto 1rem;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 9999px;
  }

  .confirmation-icon.warning {
    background: #fef3c7;
    color: #d97706;
  }

  .confirmation-icon.success {
    background: #d1fae5;
    color: #059669;
  }

  /* Scrollbar personalizada */
  .modal-body::-webkit-scrollbar {
    width: 6px;
  }

  .modal-body::-webkit-scrollbar-track {
    background: #f1f5f9;
    border-radius: 3px;
  }

  .modal-body::-webkit-scrollbar-thumb {
    background: #cbd5e1;
    border-radius: 3px;
  }

  .modal-body::-webkit-scrollbar-thumb:hover {
    background: #94a3b8;
  }

  /* Responsividade */
  @media (max-width: 768px) {
    .page-header {
        padding: 2rem 1.5rem;
    }
    
    .page-title {
        font-size: 2rem;
    }
    
    .filter-container {
        justify-content: center;
    }
    
    .stats-grid {
        grid-template-columns: repeat(2, 1fr);
    }
    
    .pagination {
        flex-direction: column;
        gap: 1rem;
        text-align: center;
    }

    .modal-content {
        margin: 1rem;
        width: calc(100% - 2rem);
    }
  }
  
  @media (max-width: 640px) {
    .stats-grid {
        grid-template-columns: 1fr;
    }
    
    .page-title {
        font-size: 1.75rem;
    }
    
    .page-subtitle {
        font-size: 1rem;
    }
  }
</style>
{% endblock %}

{% block content %}
<!-- Cabe√ßalho modernizado -->
<div class="page-header">
    <div class="header-content">
        <h1 class="page-title">Comunidade PyQuest</h1>
        <p class="page-subtitle">Conecte-se com outros aprendizes de Python, compartilhe conhecimento, fa√ßa perguntas e ajude a comunidade a crescer juntos.</p>
    </div>
</div>

<div class="flex flex-col md:flex-row gap-6 p-6">
  <!-- CONTE√öDO PRINCIPAL -->
  <div class="flex-1">
    <!-- Estat√≠sticas modernizadas -->
    <div class="stats-grid">
      <div class="stat-card stat-card-members">
        <div class="stat-icon">
          <img src="{% static 'imagem/groups_35dp_FFFFFF_FILL0_wght400_GRAD0_opsz40.png' %}" alt="Membros">
        </div>
        <div class="stat-number">{{ total_users }}</div>
        <div class="stat-label">Membros Totais</div>
      </div>
      <div class="stat-card stat-card-active">
        <div class="stat-icon">
          <img src="{% static 'imagem/visibility_35dp_FFFFFF_FILL0_wght400_GRAD0_opsz40.png' %}" alt="Ativos">
        </div>
        <div class="stat-number">{{ active_today }}</div>
        <div class="stat-label">Ativos Hoje</div>
      </div>
      <div class="stat-card stat-card-posts">
        <div class="stat-icon">
          <img src="{% static 'imagem/chat_35dp_FFFFFF_FILL0_wght400_GRAD0_opsz40.png' %}" alt="Posts">
        </div>
        <div class="stat-number">{{ posts_today }}</div>
        <div class="stat-label">Posts Hoje</div>
      </div>
    </div>

    <!-- Busca e filtros modernizados -->
    <div class="sidebar-card p-4 mb-6">
      <form method="get"
        class="flex items-center gap-2 border-2 border-gray-200 rounded-xl px-3 py-2 focus-within:border-[#2682EA] transition-colors duration-300">
        <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
        </svg>
        <input name="q" value="{{ request.GET.q }}" type="text" placeholder="Buscar no f√≥rum..."
          class="w-full outline-none text-gray-600 bg-transparent" />
      </form>

      <div id="filters" class="flex flex-wrap gap-2 mt-3">
        <button data-filter="all"
          class="filter-btn {% if current_filter == 'all' %}active{% endif %}">Todos os Posts</button>
        <button data-filter="popular"
          class="filter-btn {% if current_filter == 'popular' %}active{% endif %}">Mais Populares</button>
        <button data-filter="recent"
          class="filter-btn {% if current_filter == 'recent' %}active{% endif %}">Mais Recentes</button>
        <button data-filter="following"
          class="filter-btn {% if current_filter == 'following' %}active{% endif %}">Seguindo</button>
      </div>
    </div>

    <!-- LISTA DE POSTS MODERNIZADA -->
    <div id="postsContainer" class="space-y-4">
      {% for post in posts %}
      <div class="post p-6">
        <div class="flex items-center gap-3 mb-4">
          <img src="{{ post.autor.perfil.avatar.url }}"
            class="avatar w-12 h-12 rounded-full cursor-pointer border-2 border-[#2682EA] p-1"
            alt="{{ post.autor.username }}" onclick="openProfile(this)" data-name="{{ post.autor.username }}"
            data-xp="{{ post.autor.perfil.xp }}" data-level="{{ post.autor.perfil.nivel }}"
            data-bio="{{ post.autor.perfil.descricao|default:'Esse usu√°rio ainda n√£o escreveu uma bio.' }}"
            data-avatar="{{ post.autor.perfil.avatar.url }}" data-github="{{ post.autor.perfil.github|default:'' }}"
            data-linkedin="{{ post.autor.perfil.linkedin|default:'' }}"
            data-conquistas='[{% for c in post.autor.conquistas.all|slice:":5" %}{"titulo":"{{ c.titulo }}","icone":"{% if c.icone %}{{ c.icone.url }}{% else %}{% endif %}"}{% if not forloop.last %}, {% endif %}{% endfor %}]' />
          <div class="flex-1">
            <p class="font-semibold text-gray-800">{{ post.autor.username }}</p>
            <p class="text-sm text-gray-500">@{{ post.autor.username }} ‚Ä¢ {{ post.created_at|timesince }} atr√°s</p>
            {% if post.autor == request.user %}
            <div class="flex gap-3 text-xs mt-2">
              <button type="button"
                onclick="openEditModal('{{ post.id }}', '{{ post.conteudo|escapejs }}', '{{ post.hashtags.all|join:', '|escapejs }}', '{% if post.imagem %}{{ post.imagem.url }}{% endif %}')"
                class="text-[#2682EA] hover:text-blue-700 font-medium flex items-center gap-1 transition-colors duration-200">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z">
                  </path>
                </svg>
                Editar
              </button>
              <button type="button" onclick="openDeleteModal('{{ post.id }}')"
                class="text-red-600 hover:text-red-800 font-medium flex items-center gap-1 transition-colors duration-200">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16">
                  </path>
                </svg>
                Excluir
              </button>
            </div>
            {% endif %}
          </div>
        </div>

        <p class="text-gray-700 mb-4 whitespace-pre-wrap text-lg leading-relaxed">{{ post.conteudo }}</p>

        {% if post.imagem %}
        <div class="mb-4 flex justify-center">
          <img src="{{ post.imagem.url }}" alt="Imagem do post" class="post-image">
        </div>
        {% endif %}

        <div class="flex flex-wrap gap-2 mb-4">
          {% for tag in post.hashtags.all %}
          <span class="hashtag">
            #{{ tag.nome }}
          </span>
          {% endfor %}
        </div>

        <!-- Intera√ß√µes -->
        <div class="flex gap-6 text-gray-500 text-sm border-t border-gray-100 pt-4">
          <button type="button" onclick="toggleComments('{{ post.id }}')"
            class="flex items-center gap-2 hover:text-[#2682EA] transition-colors duration-200">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z">
              </path>
            </svg>
            <span>{{ post.comentarios.count }}</span>
          </button>

          <!-- LIKE SYSTEM CORRIGIDO -->
          <form action="{% url 'like_post' post.id %}" method="post" class="like-form inline">
            {% csrf_token %}
            <button type="submit" class="flex items-center space-x-1 text-gray-600 hover:text-red-600">
              {% if user in post.likes.all %}
              <svg class="w-5 h-5 text-red-500" fill="currentColor" viewBox="0 0 24 24">
                <path d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5
          2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5
          2.09C13.09 3.81 14.76 3 16.5 3
          19.58 3 22 5.42 22 8.5c0 3.78-3.4
          6.86-8.55 11.54L12 21.35z" />
              </svg>
              {% else %}
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000
          6.364L12 20.364l7.682-7.682a4.5
          4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5
          4.5 0 00-6.364 0z" />
              </svg>
              {% endif %}
              <span>{{ post.likes.count }}</span>
            </button>
          </form>

        </div>

        <!-- √Årea de coment√°rios -->
        <div id="comments-{{ post.id }}" style="display:none;" class="mt-6 pt-4 border-t border-gray-100">
          <!-- Formul√°rio de coment√°rio -->
          <div class="mb-6">
            <form class="comment-form" data-post-id="{{ post.id }}">
              {% csrf_token %}

              <div class="emoji-picker-container mb-3">
                <button type="button" class="emoji-trigger" onclick="toggleEmojiPicker(this)">üòÄ</button>
                <div class="emoji-panel">
                  <div class="emoji-category">
                    <h4>Smileys</h4>
                    <div class="emoji-grid">
                      <button type="button" class="emoji-btn"
                        onclick="insertEmoji(this, 'comment-{{ post.id }}')">üòÄ</button>
                      <button type="button" class="emoji-btn"
                        onclick="insertEmoji(this, 'comment-{{ post.id }}')">üòÉ</button>
                      <button type="button" class="emoji-btn"
                        onclick="insertEmoji(this, 'comment-{{ post.id }}')">üòÑ</button>
                      <button type="button" class="emoji-btn"
                        onclick="insertEmoji(this, 'comment-{{ post.id }}')">üòÅ</button>
                      <button type="button" class="emoji-btn"
                        onclick="insertEmoji(this, 'comment-{{ post.id }}')">üòÜ</button>
                      <button type="button" class="emoji-btn"
                        onclick="insertEmoji(this, 'comment-{{ post.id }}')">üòÖ</button>
                      <button type="button" class="emoji-btn"
                        onclick="insertEmoji(this, 'comment-{{ post.id }}')">üòÇ</button>
                      <button type="button" class="emoji-btn"
                        onclick="insertEmoji(this, 'comment-{{ post.id }}')">ü§£</button>
                    </div>
                  </div>
                </div>
              </div>

              <textarea name="texto" id="comment-{{ post.id }}" rows="3" class="w-full form-input"
                placeholder="Escreva um coment√°rio..."></textarea>
              <button type="submit" class="btn-primary text-sm px-4 py-2 mt-2">
                Comentar
              </button>
            </form>
          </div>

          <!-- Lista de coment√°rios -->
          <div class="space-y-4">
            {% for comentario in post.comentarios.all %}
            {% if not comentario.parent %}
            <div class="comment bg-gray-50 rounded-xl p-4 border-l-4 border-[#2682EA]">
              <div class="flex items-center gap-2 mb-2">
                <img src="{{ comentario.autor.perfil.avatar.url }}"
                  class="w-6 h-6 rounded-full cursor-pointer border border-[#2682EA]" onclick="openProfile(this)"
                  data-name="{{ comentario.autor.username }}" data-xp="{{ comentario.autor.perfil.xp }}"
                  data-level="{{ comentario.autor.perfil.nivel }}"
                  data-bio="{{ comentario.autor.perfil.descricao|default:'Esse usu√°rio ainda n√£o escreveu uma bio.' }}"
                  data-avatar="{{ comentario.autor.perfil.avatar.url }}"
                  data-github="{{ comentario.autor.perfil.github|default:'' }}"
                  data-linkedin="{{ comentario.autor.perfil.linkedin|default:'' }}"
                  data-conquistas='[{% for c in comentario.autor.conquistas.all|slice:":5" %}{"titulo":"{{ c.titulo }}","icone":"{% if c.icone %}{{ c.icone.url }}{% else %}{% endif %}"}{% if not forloop.last %}, {% endif %}{% endfor %}]' />
                <p class="text-sm text-gray-800">
                  <b class="text-[#2682EA]">{{ comentario.autor.username }}</b>:
                  {{ comentario.texto }}
                </p>
              </div>

              <div class="flex items-center gap-4 text-xs">
                <!-- Like no coment√°rio -->
                <form action="{% url 'like_comment' comentario.id %}" method="post" class="like-form inline">
                  {% csrf_token %}
                  <button type="submit"
                    class="flex items-center gap-1 text-gray-500 hover:text-red-500 transition-colors duration-200 focus:outline-none">
                    {% if user in comentario.likes.all %}
                    <svg class="w-4 h-4 text-red-500" fill="currentColor" viewBox="0 0 24 24">
                      <path
                        d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z" />
                    </svg>
                    {% else %}
                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
                    </svg>
                    {% endif %}
                    <span>{{ comentario.likes.count }}</span>
                  </button>
                </form>

                <!-- Bot√£o para responder -->
                <button type="button" onclick="toggleReplyForm('{{ comentario.id }}')"
                  class="text-[#2682EA] hover:underline font-medium">
                  Responder
                </button>
              </div>

              <!-- Formul√°rio de resposta -->
              <div id="reply-form-{{ comentario.id }}" style="display:none;" class="mt-3 ml-4">
                <form class="reply-form" data-post-id="{{ post.id }}" data-parent-id="{{ comentario.id }}">
                  {% csrf_token %}

                  <div class="emoji-picker-container mb-2">
                    <button type="button" class="emoji-trigger text-sm" onclick="toggleEmojiPicker(this)">üòÄ</button>
                    <div class="emoji-panel">
                      <div class="emoji-category">
                        <h4>Smileys</h4>
                        <div class="emoji-grid">
                          <button type="button" class="emoji-btn"
                            onclick="insertEmoji(this, 'reply-{{ comentario.id }}')">üòÄ</button>
                          <button type="button" class="emoji-btn"
                            onclick="insertEmoji(this, 'reply-{{ comentario.id }}')">üòÉ</button>
                          <button type="button" class="emoji-btn"
                            onclick="insertEmoji(this, 'reply-{{ comentario.id }}')">üòÑ</button>
                          <button type="button" class="emoji-btn"
                            onclick="insertEmoji(this, 'reply-{{ comentario.id }}')">üòÅ</button>
                        </div>
                      </div>
                    </div>
                  </div>

                  <textarea name="texto" id="reply-{{ comentario.id }}" rows="2" class="w-full form-input text-sm"
                    placeholder="Responder a @{{ comentario.autor.username }}..."></textarea>
                  <button type="submit" class="btn-primary text-xs px-3 py-1.5 mt-1">
                    Responder
                  </button>
                </form>
              </div>

              <!-- Respostas -->
              {% for reply in comentario.replies.all %}
              <div class="ml-6 mt-3 bg-white border rounded-lg p-3">
                <div class="flex items-center gap-2 mb-1">
                  <img src="{{ reply.autor.perfil.avatar.url }}"
                    class="w-5 h-5 rounded-full cursor-pointer border border-[#2682EA]" onclick="openProfile(this)"
                    data-name="{{ reply.autor.username }}" data-xp="{{ reply.autor.perfil.xp }}"
                    data-level="{{ reply.autor.perfil.nivel }}"
                    data-bio="{{ reply.autor.perfil.descricao|default:'Esse usu√°rio ainda n√£o escreveu uma bio.' }}"
                    data-avatar="{{ reply.autor.perfil.avatar.url }}"
                    data-github="{{ reply.autor.perfil.github|default:'' }}"
                    data-linkedin="{{ reply.autor.perfil.linkedin|default:'' }}"
                    data-conquistas='[{% for c in reply.autor.conquistas.all|slice:":5" %}{"titulo":"{{ c.titulo }}","icone":"{% if c.icone %}{{ c.icone.url }}{% else %}{% endif %}"}{% if not forloop.last %},{% endif %}{% endfor %}]' />
                  <p class="text-xs text-gray-700">
                    <b class="text-[#2682EA]">{{ reply.autor.username }}</b>
                    {% if reply.mencionado %}
                    <span class="text-gray-500">‚Üí @{{ reply.mencionado.username }}</span>
                    {% endif %}
                    : {{ reply.texto }}
                  </p>
                </div>

                <form action="{% url 'like_comment' reply.id %}" method="post" class="like-form inline">
                  {% csrf_token %}
                  <button type="submit"
                    class="flex items-center gap-1 text-gray-400 hover:text-red-500 transition-colors duration-200 focus:outline-none text-xs mt-1">
                    {% if user in reply.likes.all %}
                    <svg class="w-3 h-3 text-red-500" fill="currentColor" viewBox="0 0 24 24">
                      <path
                        d="M12 21.35l-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z" />
                    </svg>
                    {% else %}
                    <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
                    </svg>
                    {% endif %}
                    <span>{{ reply.likes.count }}</span>
                  </button>
                </form>
              </div>
              {% endfor %}
            </div>
            {% endif %}
            {% empty %}
            <p class="text-gray-400 text-sm text-center py-4">Nenhum coment√°rio ainda. Seja o primeiro a comentar!</p>
            {% endfor %}
          </div>
        </div>
      </div>
      {% empty %}
      <div class="text-center py-12">
        <svg class="w-16 h-16 text-gray-300 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
            d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z">
          </path>
        </svg>
        <p class="text-gray-500 text-lg">Nenhum post encontrado.</p>
        <p class="text-gray-400 text-sm mt-1">Seja o primeiro a criar um post!</p>
      </div>
      {% endfor %}
    </div>


  </div>

  <!-- SIDEBAR DIREITA MODERNIZADA -->
  <div class="w-full md:w-80 flex-shrink-0 space-y-6">
    <!-- T√≥picos em alta -->
    <div class="sidebar-card p-4">
      <h3 class="font-semibold mb-3 text-gray-700 flex items-center gap-2">
        <svg class="w-5 h-5 text-[#2682EA]" fill="currentColor" viewBox="0 0 24 24">
          <path d="M16 6l2.29 2.29-4.88 4.88-4-4L2 16.59 3.41 18l6-6 4 4 6.3-6.29L22 12V6z" />
        </svg>
        T√≥picos em Alta
      </h3>

      <!-- üîπ container din√¢mico -->
      <ul id="top-hashtags" class="space-y-2 text-sm">
        {% for tag in trending_tags %}
        <li class="flex justify-between items-center py-2 border-b border-gray-100 last:border-0">
          <span class="text-[#2682EA] font-medium">#{{ tag.nome }}</span>
          <span class="bg-gray-100 text-gray-600 px-2 py-1 rounded-full text-xs">{{ tag.contador }} usos</span>
        </li>
        {% empty %}
        <li class="text-gray-500 text-sm text-center py-4">Nenhuma hashtag no per√≠odo</li>
        {% endfor %}
      </ul>
    </div>

    <!-- DEBUG TEMPOR√ÅRIO -->
    <div class="bg-yellow-100 p-2 rounded mb-2 text-xs">
      <strong>Debug:</strong> {{ trending_tags|length }} hashtags encontradas
    </div>
    <!-- Contribuidores destaque -->
    <div class="sidebar-card p-4">
      <h3 class="font-semibold mb-3 text-gray-700 flex items-center gap-2">
        <svg class="w-5 h-5 text-[#2682EA]" fill="currentColor" viewBox="0 0 24 24">
          <path
            d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z" />
        </svg>
        Contribuidores Destaque
      </h3>
      <ul class="space-y-2 text-sm">
        {% for user in top_users %}
        <li class="flex justify-between items-center py-2 border-b border-gray-100 last:border-0">
          <span class="flex items-center gap-2 cursor-pointer avatar group">

            <img src="{{ user.perfil.avatar.url }}"
              class="w-6 h-6 rounded-full group-hover:scale-110 transition-transform duration-200 cursor-pointer"
              onclick="openProfile(this)" data-name="{{ user.username }}" data-xp="{{ user.perfil.xp }}"
              data-level="{{ user.perfil.nivel }}"
              data-bio="{{ user.perfil.descricao|default:'Esse usu√°rio ainda n√£o escreveu uma bio.' }}"
              data-avatar="{{ user.perfil.avatar.url }}" data-github="{{ user.perfil.github|default:'' }}"
              data-linkedin="{{ user.perfil.linkedin|default:'' }}"
              data-conquistas='[{% for c in user.conquistas.all|slice:":5" %}{"titulo":"{{ c.titulo }}","icone":"{% if c.icone %}{{ c.icone.url }}{% else %}{% endif %}"}{% if not forloop.last %}, {% endif %}{% endfor %}]' />
            <span class="font-medium text-gray-700">{{ user.username }}</span>
          </span>
          <span
            class="bg-gradient-to-r from-[#2682EA] to-[#1a67c9] text-white px-2 py-1 rounded-full text-xs font-bold">{{user.perfil.xp}}
            XP</span>
        </li>
        {% endfor %}
      </ul>
    </div>

    <!-- A√ß√µes r√°pidas -->
    <div class="sidebar-card p-4">
      <h3 class="font-semibold mb-3 text-gray-700 flex items-center gap-2">
        <svg class="w-5 h-5 text-[#2682EA]" fill="currentColor" viewBox="0 0 24 24">
          <path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z" />
        </svg>
        A√ß√µes R√°pidas
      </h3>
      <div class="space-y-2">
        <button id="openPostModal"
          class="w-full btn-primary py-3 rounded-xl text-lg font-semibold transform hover:scale-105 transition-transform duration-300">
          Criar Post
        </button>
      </div>
    </div>
  </div>
</div>

<!-- ===== MODAIS MODERNIZADOS ===== -->

<!-- MODAL CRIAR POST - MODERNO E ATUALIZADO -->
<div id="postModal" class="hidden fixed inset-0 z-50">
  <div class="modal-overlay absolute inset-0" onclick="closePostModal()"></div>
  <div class="modal-content absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2">
    <!-- Cabe√ßalho com gradiente -->
    <div class="modal-gradient-header">
      <div class="flex items-center justify-between">
        <div class="flex items-center gap-3">
          <div class="w-10 h-10 bg-white/20 rounded-full flex items-center justify-center">
            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 24 24">
              <path d="M18.5 4l1.16 4.35-.96.26c-.45-.87-.91-1.74-1.44-2.18C16.73 6 16.11 6 15.5 6H13v10.5c0 .5 0 1 .33 1.25.34.25 1 .25 1.67.25v1H9v-1c.67 0 1.33 0 1.67-.25.33-.25.33-.75.33-1.25V6H8.5c-.61 0-1.23 0-1.76.43-.53.44-.99 1.31-1.44 2.18l-.96-.26L5.5 4h13z"/>
            </svg>
          </div>
          <div>
            <h2 class="text-xl font-bold">Criar Novo Post</h2>
            <p class="text-blue-100 text-sm">Compartilhe seu conhecimento com a comunidade</p>
          </div>
        </div>
        <button onclick="closePostModal()" class="text-white hover:bg-white/20 rounded-full p-2 transition-colors">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
          </svg>
        </button>
      </div>
    </div>

    <form action="{% url 'create_post' %}" method="post" enctype="multipart/form-data" class="modal-body bg-white">
      {% csrf_token %}

      <!-- √Årea do autor -->
      <div class="flex items-center gap-3 mb-6 p-4 bg-blue-50 rounded-xl">
        <img src="{{ user.perfil.avatar.url }}" class="w-10 h-10 rounded-full border-2 border-blue-200" alt="{{ user.username }}">
        <div>
          <p class="font-semibold text-blue-900">{{ user.username }}</p>
          <p class="text-sm text-blue-600">Publicando como membro da comunidade</p>
        </div>
      </div>

      <!-- √Årea de conte√∫do principal -->
      <div class="space-y-4">
        <!-- Campo de texto com contador -->
        <div class="relative">
          <textarea 
            name="conteudo" 
            id="postContent" 
            class="w-full form-input min-h-[120px] resize-none text-lg"
            placeholder="O que voc√™ est√° aprendendo ou gostaria de compartilhar hoje?"
            maxlength="1000"
            oninput="updateCharCount(this)"
          ></textarea>
          <div class="absolute bottom-3 right-3 text-sm text-gray-400">
            <span id="charCount">0</span>/1000
          </div>
        </div>

        <!-- Ferramentas de formata√ß√£o -->
        <div class="flex items-center gap-2 p-3 bg-gray-50 rounded-lg">
          <button type="button" class="tool-btn" onclick="formatText('bold')" title="Negrito">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 6h16M3 12h16m-7 6h7"/>
            </svg>
          </button>
          
          <button type="button" class="tool-btn" onclick="formatText('italic')" title="It√°lico">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 20l4-16m2 16l4-16M6 9h14M4 15h14"/>
            </svg>
          </button>

          <button type="button" class="tool-btn" onclick="formatText('code')" title="C√≥digo">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"/>
            </svg>
          </button>

          <div class="emoji-picker-container">
            <button type="button" class="tool-btn" onclick="toggleEmojiPicker(this)" title="Emoji">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.828 14.828a4 4 0 01-5.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
              </svg>
            </button>
            <div class="emoji-panel">
              <div class="emoji-category">
                <h4>Frequentes</h4>
                <div class="emoji-grid">
                  <button type="button" class="emoji-btn" onclick="insertEmoji(this, 'postContent')">üòä</button>
                  <button type="button" class="emoji-btn" onclick="insertEmoji(this, 'postContent')">üëç</button>
                  <button type="button" class="emoji-btn" onclick="insertEmoji(this, 'postContent')">‚ù§Ô∏è</button>
                  <button type="button" class="emoji-btn" onclick="insertEmoji(this, 'postContent')">üéâ</button>
                  <button type="button" class="emoji-btn" onclick="insertEmoji(this, 'postContent')">üî•</button>
                  <button type="button" class="emoji-btn" onclick="insertEmoji(this, 'postContent')">üí°</button>
                  <button type="button" class="emoji-btn" onclick="insertEmoji(this, 'postContent')">üöÄ</button>
                  <button type="button" class="emoji-btn" onclick="insertEmoji(this, 'postContent')">‚≠ê</button>
                </div>
              </div>
              <div class="emoji-category">
                <h4>Tecnologia</h4>
                <div class="emoji-grid">
                  <button type="button" class="emoji-btn" onclick="insertEmoji(this, 'postContent')">üíª</button>
                  <button type="button" class="emoji-btn" onclick="insertEmoji(this, 'postContent')">üêç</button>
                  <button type="button" class="emoji-btn" onclick="insertEmoji(this, 'postContent')">üîß</button>
                  <button type="button" class="emoji-btn" onclick="insertEmoji(this, 'postContent')">üì±</button>
                  <button type="button" class="emoji-btn" onclick="insertEmoji(this, 'postContent')">üåê</button>
                  <button type="button" class="emoji-btn" onclick="insertEmoji(this, 'postContent')">‚ö°</button>
                  <button type="button" class="emoji-btn" onclick="insertEmoji(this, 'postContent')">üîç</button>
                  <button type="button" class="emoji-btn" onclick="insertEmoji(this, 'postContent')">üíæ</button>
                </div>
              </div>
            </div>
          </div>

          <div class="flex-1"></div>

          <button type="button" class="text-sm text-blue-600 hover:text-blue-800 font-medium" onclick="clearPost()">
            Limpar
          </button>
        </div>

        <!-- Upload de imagem modernizado -->
        <div class="file-upload-section">
          <input type="file" name="imagem" id="postImage" accept="image/*" class="hidden" onchange="previewImage(this, 'postImagePreview')">
          
          <div class="file-upload-area" onclick="document.getElementById('postImage').click()" id="uploadArea">
            <div class="upload-content">
              <div class="upload-icon">
                <svg class="w-8 h-8 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                </svg>
              </div>
              <div class="upload-text">
                <p class="font-medium text-gray-700">Adicionar imagem</p>
                <p class="text-sm text-gray-500">Clique ou arraste uma imagem</p>
              </div>
            </div>
          </div>

          <div id="postImagePreview" class="file-upload-preview mt-3"></div>
        </div>

        <!-- Campo de hashtags com sugest√µes -->
        <div class="hashtags-section">
          <label class="block text-sm font-medium text-gray-700 mb-2 flex items-center gap-2">
            <svg class="w-4 h-4 text-blue-500" fill="currentColor" viewBox="0 0 24 24">
              <path d="M7.75 6h8.5c.14 0 .25.11.25.25v8.5c0 .14-.11.25-.25.25h-8.5c-.14 0-.25-.11-.25-.25v-8.5c0-.14.11-.25.25-.25z"/>
            </svg>
            Hashtags
          </label>
          <input 
            name="hashtags" 
            type="text" 
            class="w-full form-input" 
            placeholder="python, django, programa√ß√£o, aprendizado..."
            id="hashtagsInput"
          />
          <div class="suggested-tags mt-2">
            <p class="text-xs text-gray-500 mb-2">Sugest√µes populares:</p>
            <div class="flex flex-wrap gap-2">
              <button type="button" class="suggested-tag" onclick="addHashtag('python')">#python</button>
              <button type="button" class="suggested-tag" onclick="addHashtag('django')">#django</button>
              <button type="button" class="suggested-tag" onclick="addHashtag('programa√ß√£o')">#programa√ß√£o</button>
              <button type="button" class="suggested-tag" onclick="addHashtag('aprendizado')">#aprendizado</button>
              <button type="button" class="suggested-tag" onclick="addHashtag('duvida')">#d√∫vida</button>
              <button type="button" class="suggested-tag" onclick="addHashtag('ajuda')">#ajuda</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Rodap√© do modal -->
      <div class="modal-footer bg-gray-50 rounded-b-2xl">
        <div class="flex items-center justify-between w-full">
          <div class="flex items-center gap-2 text-sm text-gray-500">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m-6 4h12a2 2 0 002-2v-6a2 2 0 00-2-2H6a2 2 0 00-2 2v6a2 2 0 002 2zm10-10V7a4 4 0 00-8 0v4h8z"/>
            </svg>
            <span>Post p√∫blico - todos podem ver</span>
          </div>
          <div class="flex gap-3">
            <button type="button" onclick="closePostModal()" class="btn-secondary">
              Cancelar
            </button>
            <button type="submit" class="btn-primary publish-btn" id="publishButton" disabled>
              <span class="flex items-center gap-2">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
                </svg>
                Publicar
              </span>
            </button>
          </div>
        </div>
      </div>
    </form>
  </div>
</div>

<!-- MODAL EDITAR POST - MODERNO E ATUALIZADO -->
<div id="editModal" class="hidden fixed inset-0 z-50">
  <div class="modal-overlay absolute inset-0" onclick="closeEditModal()"></div>
  <div class="modal-content absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2">
    <!-- Cabe√ßalho com gradiente -->
    <div class="modal-gradient-header">
      <div class="flex items-center justify-between">
        <div class="flex items-center gap-3">
          <div class="w-10 h-10 bg-white/20 rounded-full flex items-center justify-center">
            <svg class="w-5 h-5 text-white" fill="currentColor" viewBox="0 0 24 24">
              <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/>
            </svg>
          </div>
          <div>
            <h2 class="text-xl font-bold">Editar Post</h2>
            <p class="text-blue-100 text-sm">Atualize o conte√∫do do seu post</p>
          </div>
        </div>
        <button onclick="closeEditModal()" class="text-white hover:bg-white/20 rounded-full p-2 transition-colors">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
          </svg>
        </button>
      </div>
    </div>

    <form id="editForm" method="POST" enctype="multipart/form-data" class="modal-body bg-white">
      {% csrf_token %}

      <!-- √Årea de conte√∫do principal -->
      <div class="space-y-4">
        <!-- Campo de texto com contador -->
        <div class="relative">
          <textarea 
            id="editContent" 
            name="conteudo" 
            class="w-full form-input min-h-[120px] resize-none text-lg"
            placeholder="O que voc√™ est√° aprendendo ou gostaria de compartilhar hoje?"
            maxlength="1000"
            oninput="updateEditCharCount(this)"
          ></textarea>
          <div class="absolute bottom-3 right-3 text-sm text-gray-400">
            <span id="editCharCount">0</span>/1000
          </div>
        </div>

        <!-- Ferramentas de formata√ß√£o -->
        <div class="flex items-center gap-2 p-3 bg-gray-50 rounded-lg">
          <button type="button" class="tool-btn" onclick="formatEditText('bold')" title="Negrito">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 6h16M3 12h16m-7 6h7"/>
            </svg>
          </button>
          
          <button type="button" class="tool-btn" onclick="formatEditText('italic')" title="It√°lico">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 20l4-16m2 16l4-16M6 9h14M4 15h14"/>
            </svg>
          </button>

          <button type="button" class="tool-btn" onclick="formatEditText('code')" title="C√≥digo">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"/>
            </svg>
          </button>

          <div class="emoji-picker-container">
            <button type="button" class="tool-btn" onclick="toggleEmojiPicker(this)" title="Emoji">
              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.828 14.828a4 4 0 01-5.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
              </svg>
            </button>
            <div class="emoji-panel">
              <div class="emoji-category">
                <h4>Frequentes</h4>
                <div class="emoji-grid">
                  <button type="button" class="emoji-btn" onclick="insertEmoji(this, 'editContent')">üòä</button>
                  <button type="button" class="emoji-btn" onclick="insertEmoji(this, 'editContent')">üëç</button>
                  <button type="button" class="emoji-btn" onclick="insertEmoji(this, 'editContent')">‚ù§Ô∏è</button>
                  <button type="button" class="emoji-btn" onclick="insertEmoji(this, 'editContent')">üéâ</button>
                  <button type="button" class="emoji-btn" onclick="insertEmoji(this, 'editContent')">üî•</button>
                </div>
              </div>
            </div>
          </div>

          <div class="flex-1"></div>
        </div>

        <!-- Upload de imagem modernizado -->
        <div class="file-upload-section">
          <input type="file" name="imagem" id="editImage" accept="image/*" class="hidden" onchange="previewImage(this, 'editImagePreview')">
          
          <div class="file-upload-area" onclick="document.getElementById('editImage').click()" id="editUploadArea">
            <div class="upload-content">
              <div class="upload-icon">
                <svg class="w-8 h-8 text-blue-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                </svg>
              </div>
              <div class="upload-text">
                <p class="font-medium text-gray-700">Alterar imagem</p>
                <p class="text-sm text-gray-500">Clique ou arraste uma nova imagem</p>
              </div>
            </div>
          </div>

          <div id="editImagePreview" class="file-upload-preview mt-3"></div>
        </div>

        <!-- Campo de hashtags com sugest√µes -->
        <div class="hashtags-section">
          <label class="block text-sm font-medium text-gray-700 mb-2 flex items-center gap-2">
            <svg class="w-4 h-4 text-blue-500" fill="currentColor" viewBox="0 0 24 24">
              <path d="M7.75 6h8.5c.14 0 .25.11.25.25v8.5c0 .14-.11.25-.25.25h-8.5c-.14 0-.25-.11-.25-.25v-8.5c0-.14.11-.25.25-.25z"/>
            </svg>
            Hashtags
          </label>
          <input 
            id="editHashtags" 
            name="hashtags" 
            type="text" 
            class="w-full form-input" 
            placeholder="python, django, programa√ß√£o, aprendizado..."
          />
          <div class="suggested-tags mt-2">
            <p class="text-xs text-gray-500 mb-2">Sugest√µes populares:</p>
            <div class="flex flex-wrap gap-2">
              <button type="button" class="suggested-tag" onclick="addEditHashtag('python')">#python</button>
              <button type="button" class="suggested-tag" onclick="addEditHashtag('django')">#django</button>
              <button type="button" class="suggested-tag" onclick="addEditHashtag('programa√ß√£o')">#programa√ß√£o</button>
              <button type="button" class="suggested-tag" onclick="addEditHashtag('atualiza√ß√£o')">#atualiza√ß√£o</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Rodap√© do modal -->
      <div class="modal-footer bg-gray-50 rounded-b-2xl">
        <div class="flex items-center justify-between w-full">
          <div class="flex items-center gap-2 text-sm text-gray-500">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
            </svg>
            <span>Editado agora</span>
          </div>
          <div class="flex gap-3">
            <button type="button" onclick="closeEditModal()" class="btn-secondary">
              Cancelar
            </button>
            <button type="submit" class="btn-primary">
              <span class="flex items-center gap-2">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                </svg>
                Salvar Altera√ß√µes
              </span>
            </button>
          </div>
        </div>
      </div>
    </form>
  </div>
</div>

<!-- MODAL CONFIRMAR EXCLUS√ÉO - MODERNO E ATUALIZADO -->
<div id="deleteModal" class="hidden fixed inset-0 z-50">
  <div class="modal-overlay absolute inset-0" onclick="closeDeleteModal()"></div>
  <div class="modal-content absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 max-w-md">
    <div class="confirmation-modal">
      <div class="confirmation-icon warning">
        <svg class="w-8 h-8" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.35 16.5c-.77.833.192 2.5 1.732 2.5z"/>
        </svg>
      </div>
      
      <h2 class="text-xl font-bold text-gray-800 mb-2">Confirmar Exclus√£o</h2>
      <p class="text-gray-600 mb-6">Tem certeza que deseja excluir este post? Esta a√ß√£o n√£o poder√° ser desfeita e todo o conte√∫do ser√° permanentemente removido.</p>
      
      <form id="deleteForm" method="POST">
        {% csrf_token %}
        <div class="flex justify-center gap-3">
          <button type="button" onclick="closeDeleteModal()" class="btn-secondary">
            Cancelar
          </button>
          <button type="submit" class="btn-primary bg-red-600 hover:bg-red-700 border-red-600">
            <span class="flex items-center gap-2">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
              </svg>
              Excluir Permanentemente
            </span>
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Modal de Perfil -->
<div id="profileModal" class="fixed inset-0 bg-black/50 flex items-center justify-center hidden z-50 backdrop-blur-sm">
  <div
    class="bg-white rounded-2xl w-[500px] max-w-[90vw] shadow-2xl overflow-hidden modal-enter animate-fadeInUp transform transition-all duration-300 scale-95">
    <!-- Cabe√ßalho com gradiente melhorado -->
    <div class="bg-gradient-to-br from-blue-600 to-blue-800 p-6 flex items-center gap-4 relative">
      <div class="relative">
        <div class="absolute -inset-1 bg-white/20 rounded-full blur-sm"></div>
        <img id="modal-avatar" src="" alt="avatar"
          class="w-16 h-16 rounded-full border-2 border-white shadow-md relative z-10">
      </div>
      <div>
        <h2 id="modal-name" class="text-lg font-semibold text-white"></h2>
        <p id="modal-details" class="text-sm text-blue-100"></p>
      </div>
      <button onclick="closeProfile()"
        class="absolute right-4 top-4 text-white hover:bg-white/20 rounded-full p-2 transition-colors shadow-sm">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor">
          <path fill-rule="evenodd"
            d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z"
            clip-rule="evenodd" />
        </svg>
      </button>
    </div>

    <!-- Conte√∫do do modal -->
    <div class="max-h-[70vh] overflow-y-auto">
      <!-- Bio -->
      <div id="modal-bio"
        class="bg-gradient-to-r from-blue-50 to-indigo-50 text-gray-700 p-4 m-6 rounded-xl shadow-inner text-sm italic border border-blue-100">
        Bio do usu√°rio aparecer√° aqui.
      </div>

      <!-- Stats com design de cart√£o melhorado -->
      <div class="grid grid-cols-2 gap-4 px-6 pb-6">
        <div
          class="bg-gradient-to-br from-blue-50 to-blue-100 p-4 rounded-xl shadow-sm border border-blue-100 text-center">
          <p id="modal-xp" class="text-blue-700 font-bold text-xl">0 XP</p>
          <p class="text-sm text-blue-600 mt-1">XP Total</p>
        </div>
        <div
          class="bg-gradient-to-br from-blue-50 to-blue-100 p-4 rounded-xl shadow-sm border border-blue-100 text-center">
          <p id="modal-level" class="text-blue-700 font-bold text-xl">N√≠vel 0</p>
          <p class="text-sm text-blue-600 mt-1">Progresso</p>
        </div>
      </div>

      <!-- Conquistas -->
      <div class="px-6 pb-6">
        <h3 class="text-sm font-semibold text-blue-700 mb-3 flex items-center">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2" viewBox="0 0 20 20" fill="currentColor">
            <path fill-rule="evenodd"
              d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z"
              clip-rule="evenodd" />
          </svg>
          Conquistas
        </h3>
        <div id="modal-conquistas" class="flex flex-wrap gap-2">
          <!-- preenchido via JS -->
        </div>
      </div>

      <!-- Redes sociais -->
      <div class="px-6 py-4 bg-gray-50">
        <h3 class="text-sm font-semibold text-blue-700 mb-3 flex items-center">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-2" viewBox="0 0 20 20" fill="currentColor">
            <path
              d="M13 6a3 3 0 11-6 0 3 3 0 016 0zM18 8a2 2 0 11-4 0 2 2 0 014 0zM14 15a4 4 0 00-8 0v3h8v-3zM6 8a2 2 0 11-4 0 2 2 0 014 0zM16 18v-3a5.972 5.972 0 00-.75-2.906A3.005 3.005 0 0119 15v3h-3zM4.75 12.094A5.973 5.973 0 004 15v3H1v-3a3 3 0 013.75-2.906z" />
          </svg>
          Redes Sociais
        </h3>

        <!-- GitHub -->
        <div class="mb-3">
          <button id="modal-github-btn"
            class="w-full text-center bg-gray-800 text-white px-3 py-3 rounded-lg text-sm font-medium hover:bg-gray-900 transition-all duration-300 shadow-md flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed">
            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
              <path
                d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z" />
            </svg>
            GitHub
          </button>
          <div id="github-message" class="hidden mt-1">
            <p class="text-xs text-gray-500 italic flex items-center gap-1">
              <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd"
                  d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z"
                  clip-rule="evenodd" />
              </svg>
              Este usu√°rio n√£o cadastrou um perfil do GitHub
            </p>
          </div>
        </div>

        <!-- LinkedIn -->
        <div>
          <button id="modal-linkedin-btn"
            class="w-full text-center bg-blue-600 text-white px-3 py-3 rounded-lg text-sm font-medium hover:bg-blue-700 transition-all duration-300 shadow-md flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed">
            <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 24 24">
              <path
                d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z" />
            </svg>
            LinkedIn
          </button>
          <div id="linkedin-message" class="hidden mt-1">
            <p class="text-xs text-gray-500 italic flex items-center gap-1">
              <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd"
                  d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z"
                  clip-rule="evenodd" />
              </svg>
              Este usu√°rio n√£o cadastrou um perfil do LinkedIn
            </p>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Toast de notifica√ß√£o -->
<div id="toast"
  class="fixed bottom-4 right-4 px-4 py-3 rounded-lg shadow-lg transform translate-y-16 opacity-0 transition-all duration-300 z-50">
  <div class="flex items-center gap-2">
    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
      <path fill-rule="evenodd"
        d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z"
        clip-rule="evenodd" />
    </svg>
    <span id="toast-message"></span>
  </div>
</div>

<!-- PAGINA√á√ÉO - ESTILO MODERNO -->
{% if is_paginated %}
<div class="pagination">
  <div class="pagination-info">
    Mostrando {{ page_obj.start_index }} a {{ page_obj.end_index }} de {{ page_obj.paginator.count }} posts
  </div>
  
  <div class="pagination-controls">
    {% if page_obj.has_previous %}
        <a href="?page={{ page_obj.previous_page_number }}" class="pagination-btn">
            <img src="{% static 'imagem/arrow_back_20dp_64748B_FILL0_wght400_GRAD0_opsz20.png' %}" alt="Anterior">
            Anterior
        </a>
    {% else %}
        <button class="pagination-btn" disabled>
            <img src="{% static 'imagem/arrow_back_20dp_64748B_FILL0_wght400_GRAD0_opsz20.png' %}" alt="Anterior">
            Anterior
        </button>
    {% endif %}
    
    <span class="text-blue-600 font-medium px-4 py-2">
        P√°gina {{ page_obj.number }} de {{ page_obj.paginator.num_pages }}
    </span>
    
    {% if page_obj.has_next %}
        <a href="?page={{ page_obj.next_page_number }}" class="pagination-btn">
            Pr√≥xima
            <img src="{% static 'imagem/arrow_forward_20dp_64748B_FILL0_wght400_GRAD0_opsz20.png' %}" alt="Pr√≥xima">
        </a>
    {% else %}
        <button class="pagination-btn" disabled>
            Pr√≥xima
            <img src="{% static 'imagem/arrow_forward_20dp_64748B_FILL0_wght400_GRAD0_opsz20.png' %}" alt="Pr√≥xima">
        </button>
    {% endif %}
  </div>
</div>
{% endif %}
{% endblock %}

{% block extra_js %}
<script>
  // ===== FUN√á√ïES B√ÅSICAS DE MODAL =====
  function openPostModal() {
    document.getElementById("postModal").classList.remove("hidden");
  }

  function closePostModal() {
    document.getElementById("postModal").classList.add("hidden");
    // Resetar formul√°rio
    document.getElementById("postContent").value = '';
    document.getElementById("hashtagsInput").value = '';
    document.getElementById("postImagePreview").innerHTML = '';
    document.getElementById("postImage").value = '';
    updateCharCount(document.getElementById("postContent"));
  }

  document.getElementById("openPostModal").addEventListener("click", openPostModal);

  let currentDeleteId = null;

  function openDeleteModal(postId) {
    currentDeleteId = postId;
    const form = document.getElementById("deleteForm");
    form.action = `/forum/${postId}/delete/`;
    document.getElementById("deleteModal").classList.remove("hidden");
  }

  function closeDeleteModal() {
    currentDeleteId = null;
    document.getElementById("deleteModal").classList.add("hidden");
  }

  let currentEditId = null;

  function openEditModal(postId, content, hashtags, imageUrl) {
    currentEditId = postId;
    document.getElementById("editContent").value = content;
    document.getElementById("editHashtags").value = hashtags;
    document.getElementById("editForm").action = `/forum/${postId}/edit/`;

    // Atualizar contador de caracteres
    updateEditCharCount(document.getElementById("editContent"));

    // Mostrar imagem atual se existir
    const editImagePreview = document.getElementById('editImagePreview');
    if (imageUrl && imageUrl !== 'None') {
      editImagePreview.innerHTML = `
        <div class="image-preview-container animate-fadeIn">
          <p class="text-sm text-gray-600 mb-1">Imagem atual:</p>
          <img src="${imageUrl}" class="image-preview">
          <button type="button" class="remove-image" onclick="removeEditImage()">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
            </svg>
          </button>
        </div>`;
    } else {
      editImagePreview.innerHTML = '<p class="text-sm text-gray-600">Nenhuma imagem atual</p>';
    }

    document.getElementById("editModal").classList.remove("hidden");
  }

  function closeEditModal() {
    currentEditId = null;
    document.getElementById("editModal").classList.add("hidden");
  }

  // ===== FUN√á√ïES ESPEC√çFICAS DO MODAL DE POST =====
  function updateCharCount(textarea) {
    const charCount = document.getElementById('charCount');
    const publishButton = document.getElementById('publishButton');
    const count = textarea.value.length;
    
    charCount.textContent = count;
    
    // Atualizar cor do contador
    if (count > 900) {
      charCount.classList.add('text-red-500');
      charCount.classList.remove('text-gray-400', 'text-yellow-500');
    } else if (count > 500) {
      charCount.classList.add('text-yellow-500');
      charCount.classList.remove('text-gray-400', 'text-red-500');
    } else {
      charCount.classList.add('text-gray-400');
      charCount.classList.remove('text-yellow-500', 'text-red-500');
    }
    
    // Habilitar/desabilitar bot√£o de publicar
    publishButton.disabled = count === 0;
  }

  function updateEditCharCount(textarea) {
    const charCount = document.getElementById('editCharCount');
    const count = textarea.value.length;
    
    charCount.textContent = count;
    
    // Atualizar cor do contador
    if (count > 900) {
      charCount.classList.add('text-red-500');
      charCount.classList.remove('text-gray-400', 'text-yellow-500');
    } else if (count > 500) {
      charCount.classList.add('text-yellow-500');
      charCount.classList.remove('text-gray-400', 'text-red-500');
    } else {
      charCount.classList.add('text-gray-400');
      charCount.classList.remove('text-yellow-500', 'text-red-500');
    }
  }

  function formatText(type) {
    const textarea = document.getElementById('postContent');
    formatTextInTextarea(textarea, type);
    updateCharCount(textarea);
  }

  function formatEditText(type) {
    const textarea = document.getElementById('editContent');
    formatTextInTextarea(textarea, type);
    updateEditCharCount(textarea);
  }

  function formatTextInTextarea(textarea, type) {
    const start = textarea.selectionStart;
    const end = textarea.selectionEnd;
    const selectedText = textarea.value.substring(start, end);
    
    let formattedText = '';
    
    switch(type) {
      case 'bold':
        formattedText = `**${selectedText}**`;
        break;
      case 'italic':
        formattedText = `_${selectedText}_`;
        break;
      case 'code':
        formattedText = `\`${selectedText}\``;
        break;
    }
    
    textarea.value = textarea.value.substring(0, start) + formattedText + textarea.value.substring(end);
    textarea.focus();
    textarea.setSelectionRange(start + formattedText.length, start + formattedText.length);
  }

  function addHashtag(tag) {
    const input = document.getElementById('hashtagsInput');
    addHashtagToInput(input, tag);
  }

  function addEditHashtag(tag) {
    const input = document.getElementById('editHashtags');
    addHashtagToInput(input, tag);
  }

  function addHashtagToInput(input, tag) {
    const currentValue = input.value.trim();
    const tags = currentValue ? currentValue.split(',') : [];
    
    // Remover espa√ßos e garantir que n√£o h√° duplicatas
    const cleanTags = tags.map(t => t.trim()).filter(t => t);
    
    if (!cleanTags.includes(tag)) {
      cleanTags.push(tag);
      input.value = cleanTags.join(', ');
    }
    
    input.focus();
  }

  function clearPost() {
    if (confirm('Tem certeza que deseja limpar o post? Todo o conte√∫do ser√° perdido.')) {
      document.getElementById('postContent').value = '';
      document.getElementById('hashtagsInput').value = '';
      document.getElementById('postImagePreview').innerHTML = '';
      document.getElementById('postImage').value = '';
      updateCharCount(document.getElementById('postContent'));
    }
  }

  function removeEditImage() {
    document.getElementById('editImagePreview').innerHTML = '<p class="text-sm text-gray-600">Nenhuma imagem atual</p>';
    document.getElementById('editImage').value = '';
  }

  // ===== FUN√á√ïES DE EMOJI PICKER =====
  function toggleEmojiPicker(button) {
    const panel = button.nextElementSibling;
    const isVisible = panel.style.display === 'block';

    // Fechar todos os outros pain√©is
    document.querySelectorAll('.emoji-panel').forEach(p => {
      if (p !== panel) p.style.display = 'none';
    });

    // Alternar o painel atual
    panel.style.display = isVisible ? 'none' : 'block';
  }

  function insertEmoji(emojiButton, targetId) {
    const emoji = emojiButton.textContent;
    const textarea = document.getElementById(targetId);
    const start = textarea.selectionStart;
    const end = textarea.selectionEnd;
    const text = textarea.value;

    textarea.value = text.substring(0, start) + emoji + text.substring(end);
    textarea.selectionStart = textarea.selectionEnd = start + emoji.length;
    textarea.focus();

    // Fechar o painel de emojis ap√≥s a inser√ß√£o
    emojiButton.closest('.emoji-panel').style.display = 'none';
    
    // Atualizar contador
    if (targetId === 'postContent') {
      updateCharCount(textarea);
    } else if (targetId === 'editContent') {
      updateEditCharCount(textarea);
    }
  }

  // ===== FUN√á√ÉO DE PREVIEW DE IMAGEM =====
  function previewImage(input, previewId) {
    const preview = document.getElementById(previewId);
    const file = input.files[0];

    if (file) {
      const reader = new FileReader();
      reader.onload = function (e) {
        preview.innerHTML = `
          <div class="image-preview-container animate-fadeIn">
            <img src="${e.target.result}" class="image-preview" alt="Preview">
            <button type="button" class="remove-image" onclick="removeImage('${previewId}', '${input.id}')">
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
              </svg>
            </button>
          </div>
        `;
      };
      reader.readAsDataURL(file);
    }
  }

  function removeImage(previewId, inputId) {
    document.getElementById(previewId).innerHTML = '';
    document.getElementById(inputId).value = '';
  }

  // ===== FUN√á√ïES DE UI =====
  function toggleComments(postId) {
    const commentsDiv = document.getElementById(`comments-${postId}`);
    commentsDiv.style.display = commentsDiv.style.display === "none" ? "block" : "none";
  }

  function toggleReplyForm(commentId) {
    const formDiv = document.getElementById(`reply-form-${commentId}`);
    document.querySelectorAll('[id^="reply-form-"]').forEach(form => {
      if (form.id !== `reply-form-${commentId}`) {
        form.style.display = "none";
      }
    });

    formDiv.style.display = formDiv.style.display === "none" ? "block" : "none";
    if (formDiv.style.display === "block") {
      const textarea = formDiv.querySelector('textarea');
      if (textarea) textarea.focus();
    }
  }

  // Fechar emoji picker ao clicar fora
  document.addEventListener('click', function (event) {
    if (!event.target.closest('.emoji-picker-container')) {
      document.querySelectorAll('.emoji-panel').forEach(panel => {
        panel.style.display = 'none';
      });
    }
  });

  // Drag and drop para upload de imagens
  document.addEventListener('DOMContentLoaded', function () {
    // Configurar drag and drop para criar post
    const uploadArea = document.getElementById('uploadArea');
    const fileInput = document.getElementById('postImage');
    
    if (uploadArea) {
      setupDragAndDrop(uploadArea, fileInput);
    }

    // Configurar drag and drop para editar post
    const editUploadArea = document.getElementById('editUploadArea');
    const editFileInput = document.getElementById('editImage');
    
    if (editUploadArea) {
      setupDragAndDrop(editUploadArea, editFileInput);
    }

    // Filtros de posts
    const filterButtons = document.querySelectorAll('.filter-btn');
    
    filterButtons.forEach(button => {
        button.addEventListener('click', function() {
            // Remover classe active de todos os bot√µes
            filterButtons.forEach(btn => btn.classList.remove('active'));
            
            // Adicionar classe active ao bot√£o clicado
            this.classList.add('active');
            
            const filter = this.getAttribute('data-filter');
            window.location.href = `?filter=${filter}`;
        });
    });
  });

  function setupDragAndDrop(uploadArea, fileInput) {
    ['dragover', 'dragenter'].forEach(event => {
      uploadArea.addEventListener(event, function(e) {
        e.preventDefault();
        uploadArea.classList.add('dragover');
      });
    });

    ['dragleave', 'dragend', 'drop'].forEach(event => {
      uploadArea.addEventListener(event, function(e) {
        e.preventDefault();
        uploadArea.classList.remove('dragover');
      });
    });

    uploadArea.addEventListener('drop', function(e) {
      e.preventDefault();
      const files = e.dataTransfer.files;
      if (files.length > 0) {
        fileInput.files = files;
        const event = new Event('change');
        fileInput.dispatchEvent(event);
      }
    });
  }

  // ===== LIKE SYSTEM SIMPLIFICADO =====
  document.addEventListener("submit", async function (e) {
    if (e.target.matches("form.like-form")) {
      e.preventDefault();

      const form = e.target;
      const url = form.action;
      const csrftoken = getCookie("csrftoken");
      const button = form.querySelector("button");
      const icon = form.querySelector("svg");
      button.disabled = true;

      try {
        const response = await fetch(url, {
          method: "POST",
          headers: {
            "X-CSRFToken": csrftoken,
            "X-Requested-With": "XMLHttpRequest",
          },
        });

        if (!response.ok) throw new Error("Erro no servidor");

        const data = await response.json();
        const span = form.querySelector("span");
        span.textContent = data.likes_count;

        // Alterna √≠cone e anima
        if (data.liked) {
          icon.classList.add("text-red-500");
          icon.setAttribute("fill", "currentColor");
          icon.setAttribute("stroke", "none");
        } else {
          icon.classList.remove("text-red-500");
          icon.setAttribute("fill", "none");
          icon.setAttribute("stroke", "currentColor");
        }

        // ‚ú® anima√ß√£o
        icon.classList.add("animate-heart");
        setTimeout(() => icon.classList.remove("animate-heart"), 400);
      } catch (err) {
        console.error(err);
      } finally {
        button.disabled = false;
      }
    }
  });

  // ===== COMMENT SYSTEM SIMPLIFICADO =====
  class CommentSystem {
    constructor() {
      this.init();
    }

    init() {
      this.setupEventListeners();
    }

    setupEventListeners() {
      document.addEventListener('submit', (e) => {
        if (e.target.classList.contains('comment-form')) {
          e.preventDefault();
          this.handleCommentSubmit(e.target);
        }

        if (e.target.classList.contains('reply-form')) {
          e.preventDefault();
          this.handleReplySubmit(e.target);
        }
      });
    }

    async handleCommentSubmit(form) {
      const postId = form.dataset.postId;
      const formData = new FormData(form);
      const textarea = form.querySelector('textarea');
      const commentText = textarea.value.trim();

      if (!commentText) return;

      const submitButton = form.querySelector('button[type="submit"]');
      const originalText = submitButton.textContent;
      submitButton.disabled = true;
      submitButton.textContent = 'Enviando...';

      const url = `/forum/${postId}/comment/`;

      try {
        const response = await fetch(url, {
          method: 'POST',
          credentials: 'same-origin',
          headers: {
            'X-Requested-With': 'XMLHttpRequest',
            'X-CSRFToken': getCookie('csrftoken'),
            'Accept': 'application/json'
          },
          body: formData
        });

        console.log('[comment] fetch ->', url, 'status:', response.status, 'redirected:', response.redirected);

        if (response.redirected) {
          console.warn('[comment] fetch foi redirecionado para:', response.url);
          alert('Sua sess√£o expirou. Fa√ßa login novamente.');
          return;
        }

        if (!response.ok) {
          const text = await response.text();
          console.error('[comment] resposta HTTP n√£o OK:', response.status, text);
          alert('Erro ao enviar coment√°rio (status ' + response.status + '). Veja console para detalhes.');
          return;
        }

        let data;
        try {
          data = await response.json();
        } catch (err) {
          const txt = await response.text();
          console.error('[comment] resposta n√£o √© JSON:', txt);
          alert('Erro ao processar resposta do servidor. Veja console.');
          return;
        }

        console.log('[comment] resposta JSON:', data);

        if (data && data.success) {
          this.addNewComment(form, postId, data);
          textarea.value = '';
        } else {
          console.error('[comment] data.success falso ou ausente:', data);
          alert('Erro do servidor ao criar coment√°rio. Veja console.');
        }

      } catch (error) {
        console.error('[comment] erro fetch:', error);
        alert('Erro de rede ao enviar coment√°rio. Tente novamente.');
      } finally {
        submitButton.disabled = false;
        submitButton.textContent = originalText;
      }
    }

    addNewComment(form, postId, data) {
      const commentsContainer = form.closest('#comments-' + postId).querySelector('.space-y-4');

      const newCommentHtml = `
    <div class="comment bg-gray-50 rounded-xl p-4 border-l-4 border-[#2682EA]">
      <div class="flex items-center mb-2">
        <img src="${data.avatar_url}?v=${Date.now()}"
             alt="${data.author}"
             class="w-8 h-8 rounded-full cursor-pointer mr-2 border border-gray-300 hover:ring-2 hover:ring-blue-300 transition"
             onclick="openProfile(this)"
             data-avatar="${data.avatar_url}"
             data-name="${data.author}"
             data-bio="${data.bio || ''}"
             data-xp="${data.xp || 0}"
             data-level="${data.level || 1}"
             data-github="${data.github || '#'}"
             data-linkedin="${data.linkedin || '#'}"
             data-conquistas='${JSON.stringify(data.conquistas || [])}'>
        <b class="text-[#2682EA]">${data.author}</b>
      </div>
      <p class="text-sm text-gray-800 mb-2">${data.text}</p>
      <div class="flex items-center gap-4 text-xs">
        <form action="/forum/comment/${data.comment_id}/like/" method="post" class="inline like-form">
          <input type="hidden" name="csrfmiddlewaretoken" value="${getCookie('csrftoken')}">
          <button type="submit" class="flex items-center gap-1 text-gray-500 hover:text-red-500 transition">
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                    d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682
                    a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318
                    a4.5 4.5 0 00-6.364 0z"/>
            </svg>
            <span>0</span>
          </button>
        </form>
        <button type="button" onclick="toggleReplyForm('${data.comment_id}')" 
                class="text-[#2682EA] hover:underline font-medium">
          Responder
        </button>
      </div>
      <div id="reply-form-${data.comment_id}" style="display:none;" class="mt-3 ml-4">
        <form class="reply-form" data-post-id="${postId}" data-parent-id="${data.comment_id}">
          <input type="hidden" name="csrfmiddlewaretoken" value="${getCookie('csrftoken')}">
          <textarea name="texto" rows="2" class="w-full form-input text-sm" placeholder="Responder..."></textarea>
          <button type="submit" class="btn-primary text-xs px-3 py-1.5 mt-1">Responder</button>
        </form>
      </div>
    </div>
  `;

      const emptyMessage = commentsContainer.querySelector('p.text-gray-400');
      if (emptyMessage) emptyMessage.remove();

      commentsContainer.insertAdjacentHTML('afterbegin', newCommentHtml);

      // üîπ Atualiza contador
      const commentCount = document.querySelector(`button[onclick="toggleComments('${postId}')"] span`);
      if (commentCount) {
        commentCount.textContent = parseInt(commentCount.textContent) + 1;
      }
    }

    async handleReplySubmit(form) {
      const postId = form.dataset.postId;
      const parentId = form.dataset.parentId;
      const formData = new FormData(form);
      const textarea = form.querySelector('textarea');
      const replyText = textarea.value.trim();

      if (!replyText) return;

      const submitButton = form.querySelector('button[type="submit"]');
      const originalText = submitButton.textContent;
      submitButton.disabled = true;
      submitButton.textContent = 'Enviando...';

      try {
        const response = await fetch(`/forum/${postId}/reply/${parentId}/`, {
          method: 'POST',
          headers: {
            'X-Requested-With': 'XMLHttpRequest',
            'X-CSRFToken': getCookie('csrftoken')
          },
          body: formData
        });

        if (!response.ok) throw new Error('Network error');

        const data = await response.json();

        if (data.success) {
          this.addNewReply(form, postId, data);
          textarea.value = '';
        } else {
          throw new Error('Server error');
        }
      } catch (error) {
        console.error('Reply error:', error);
        alert('Erro ao enviar resposta. Tente novamente.');
      } finally {
        submitButton.disabled = false;
        submitButton.textContent = originalText;
      }
    }

    addNewReply(form, postId, data) {
      const parentComment = form.closest('.comment');
      let repliesContainer = parentComment.querySelector('.ml-6');

      if (!repliesContainer) {
        repliesContainer = document.createElement('div');
        repliesContainer.className = 'ml-6 mt-3';
        parentComment.appendChild(repliesContainer);
      }

      const newReplyHtml = `
      <div class="bg-white border rounded-lg p-3 mb-2">
        <p class="text-xs text-gray-700">
          <b class="text-[#2682EA]">${data.author}</b> 
          <span class="text-gray-500">‚Üí @${data.mentioned}</span>
          : ${data.text}
        </p>
        <form action="/forum/comment/${data.reply_id}/like/" method="post" class="inline">
          <input type="hidden" name="csrfmiddlewaretoken" value="${getCookie('csrftoken')}">
          <button type="submit" class="flex items-center gap-1 text-gray-400 hover:text-red-500 transition-colors duration-200 focus:outline-none text-xs mt-1">
            <svg class="w-3 h-3" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
            </svg>
            <span>0</span>
          </button>
        </form>
      </div>
    `;

      repliesContainer.insertAdjacentHTML('beforeend', newReplyHtml);

      const commentCount = document.querySelector(`button[onclick="toggleComments('${postId}')"] span`);
      if (commentCount) {
        commentCount.textContent = parseInt(commentCount.textContent) + 1;
      }
    }
  }

  // ===== FUN√á√ïES DO MODAL DE PERFIL =====
  function openProfile(el) {
    const modal = document.getElementById("profileModal");
    if (!modal) {
      console.error("Modal de perfil n√£o encontrado!");
      return;
    }

    document.getElementById("modal-avatar").src = el.dataset.avatar;
    document.getElementById("modal-name").textContent = el.dataset.name;
    document.getElementById("modal-details").textContent = `N√≠vel ${el.dataset.level}`;
    document.getElementById("modal-bio").textContent = el.dataset.bio;
    document.getElementById("modal-xp").textContent = el.dataset.xp + " XP";
    document.getElementById("modal-level").textContent = "N√≠vel " + el.dataset.level;

    // Configurar os bot√µes de redes sociais
    const githubBtn = document.getElementById("modal-github-btn");
    const linkedinBtn = document.getElementById("modal-linkedin-btn");
    const githubMessage = document.getElementById("github-message");
    const linkedinMessage = document.getElementById("linkedin-message");

    const githubUrl = el.dataset.github || "";
    const linkedinUrl = el.dataset.linkedin || "";

    // GitHub
    if (githubUrl && githubUrl !== "#" && githubUrl !== "None") {
      githubBtn.disabled = false;
      githubBtn.classList.remove("opacity-50", "cursor-not-allowed");
      githubMessage.classList.add("hidden");
      githubBtn.onclick = function () {
        window.open(githubUrl, '_blank');
      };
    } else {
      githubBtn.disabled = true;
      githubBtn.classList.add("opacity-50", "cursor-not-allowed");
      githubMessage.classList.remove("hidden");
      githubBtn.onclick = function () {
        showToast("Este usu√°rio n√£o cadastrou um perfil do GitHub");
      };
    }

    // LinkedIn
    if (linkedinUrl && linkedinUrl !== "#" && linkedinUrl !== "None") {
      linkedinBtn.disabled = false;
      linkedinBtn.classList.remove("opacity-50", "cursor-not-allowed");
      linkedinMessage.classList.add("hidden");
      linkedinBtn.onclick = function () {
        window.open(linkedinUrl, '_blank');
      };
    } else {
      linkedinBtn.disabled = true;
      linkedinBtn.classList.add("opacity-50", "cursor-not-allowed");
      linkedinMessage.classList.remove("hidden");
      linkedinBtn.onclick = function () {
        showToast("Este usu√°rio n√£o cadastrou um perfil do LinkedIn");
      };
    }

    // Conquistas
    const conquistas = JSON.parse(el.dataset.conquistas || "[]");
    const conquistasDiv = document.getElementById("modal-conquistas");
    if (conquistasDiv) {
      conquistasDiv.innerHTML = "";
      if (conquistas.length === 0) {
        conquistasDiv.innerHTML = `<p class="text-gray-400 text-sm italic">Nenhuma conquista desbloqueada.</p>`;
      } else {
        conquistas.forEach(c => {
          conquistasDiv.innerHTML += `
          <div class="flex items-center gap-2 bg-gradient-to-r from-blue-50 to-indigo-50 px-3 py-2 rounded-lg text-xs shadow-sm hover:shadow-md transition-all duration-300 border border-blue-100">
            ${c.icone ? `<img src="${c.icone}" class="w-4 h-4"/>` : "üèÜ"} 
            <span class="font-medium">${c.titulo}</span>
          </div>`;
        });
      }
    }

    modal.classList.remove("hidden");

    // Pequeno atraso para a anima√ß√£o de entrada
    setTimeout(() => {
      const modalEnter = modal.querySelector('.modal-enter');
      if (modalEnter) {
        modalEnter.classList.remove('scale-95');
        modalEnter.classList.add('scale-100');
      }
    }, 10);
  }

  function closeProfile() {
    const modal = document.getElementById("profileModal");
    if (!modal) return;

    const modalEnter = modal.querySelector('.modal-enter');
    if (modalEnter) {
      modalEnter.classList.remove('scale-100');
      modalEnter.classList.add('scale-95');
    }

    setTimeout(() => {
      modal.classList.add("hidden");
    }, 200);
  }

  // Fun√ß√£o para mostrar toast de notifica√ß√£o
  function showToast(message) {
    const toast = document.getElementById("toast");
    if (!toast) {
      // Criar toast dinamicamente se n√£o existir
      const toastDiv = document.createElement('div');
      toastDiv.id = 'toast';
      toastDiv.className = 'fixed bottom-4 right-4 px-4 py-3 rounded-lg shadow-lg transform translate-y-16 opacity-0 transition-all duration-300 z-50';
      toastDiv.innerHTML = `
      <div class="flex items-center gap-2">
        <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
          <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"/>
        </svg>
        <span id="toast-message">${message}</span>
      </div>
    `;
      document.body.appendChild(toastDiv);
    }

    const toastMessage = document.getElementById("toast-message");
    if (toastMessage) {
      toastMessage.textContent = message;
    }

    // Mostrar toast
    toast.classList.remove("translate-y-16", "opacity-0");
    toast.classList.add("translate-y-0", "opacity-100");

    // Esconder toast ap√≥s 3 segundos
    setTimeout(() => {
      toast.classList.remove("translate-y-0", "opacity-100");
      toast.classList.add("translate-y-16", "opacity-0");
    }, 3000);
  }

  // Fechar modal ao clicar fora
  document.addEventListener('DOMContentLoaded', function () {
    const modal = document.getElementById("profileModal");
    if (modal) {
      modal.addEventListener("click", function (e) {
        if (e.target === this) closeProfile();
      });
    }

    // Fechar modais com ESC
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape') {
        closePostModal();
        closeEditModal();
        closeDeleteModal();
        closeProfile();
      }
    });
  });

  // ===== FUN√á√ÉO CSRF =====
  function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== "") {
      const cookies = document.cookie.split(";");
      for (let cookie of cookies) {
        cookie = cookie.trim();
        if (cookie.substring(0, name.length + 1) === name + "=") {
          cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
          break;
        }
      }
    }
    return cookieValue;
  }

  // ===== INITIALIZATION =====
  document.addEventListener('DOMContentLoaded', function () {
    new CommentSystem();
    console.log('Forum system initialized successfully');

    // Inicializar contador de caracteres
    const postContent = document.getElementById('postContent');
    if (postContent) {
      updateCharCount(postContent);
    }
  });

  // ===== Atualizar T√≥picos em Alta =====
  async function atualizarTopicosEmAlta() {
    try {
      const response = await fetch("{% url 'top_hashtags_json' %}");
      if (!response.ok) throw new Error("Erro ao buscar hashtags");

      const data = await response.json();
      const container = document.getElementById("top-hashtags");

      if (!container) return;

      if (data.hashtags.length === 0) {
        container.innerHTML = '<p class="text-gray-400 text-sm">Nenhuma hashtag dispon√≠vel</p>';
        return;
      }

      container.innerHTML = data.hashtags
        .map(
          (h) => `
          <div class="flex items-center justify-between bg-blue-50 text-blue-800 px-3 py-1.5 rounded-lg text-sm font-medium shadow-sm mb-2">
            <span>#${h.nome}</span>
            <span class="text-xs text-gray-500">${h.contador}</span>
          </div>`
        )
        .join("");
    } catch (error) {
      console.error("Erro ao atualizar t√≥picos:", error);
    }
  }

  // Atualiza automaticamente quando cria novo post
  document.addEventListener("DOMContentLoaded", () => {
    const formPost = document.querySelector('#postModal form');
    if (formPost) {
      formPost.addEventListener("submit", async (e) => {
        setTimeout(atualizarTopicosEmAlta, 1000);
      });
    }
  });

  // Atualiza periodicamente (a cada 30s)
  setInterval(atualizarTopicosEmAlta, 30000);
</script>
{% endblock %}