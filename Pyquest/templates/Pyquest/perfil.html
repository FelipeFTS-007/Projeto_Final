{% extends "base.html" %}

{% load static %}

{% block title %}Perfil - PyQuest{% endblock %}

{% block extra_css %}
<style>
  /* Vari√°veis CSS para consist√™ncia */
  :root {
    --primary-blue: #2682EA;
    --blue-100: #dbeafe;
    --blue-200: #bfdbfe;
    --blue-300: #93c5fd;
    --blue-600: #2563eb;
    --blue-800: #1e40af;
    --gray-100: #f3f4f6;
    --gray-200: #e5e7eb;
    --gray-400: #9ca3af;
    --gray-500: #6b7280;
    --gray-700: #374151;
    --success: #10b981;
    --warning: #f59e0b;
    --danger: #ef4444;
  }

  /* Header do Perfil - Layout Centralizado */
  .profile-header {
    background: linear-gradient(135deg, var(--primary-blue) 0%, #1e3a8a 100%);
    color: white;
    border-radius: 1.5rem;
    box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
    padding: 2.5rem 1.5rem;
    position: relative;
    overflow: hidden;
    text-align: center;
  }

  .profile-header::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.05'%3E%3Cpath d='M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
    opacity: 0.3;
  }

  /* Container do Avatar Centralizado - AUMENTADO */
  .avatar-section {
    display: flex;
    flex-direction: column;
    align-items: center;
    margin-bottom: 2.5rem;
  }

  /* Avatar modernizado - AUMENTADO */
  .avatar-container {
    position: relative;
    display: inline-block;
    border-radius: 50%;
    padding: 6px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    box-shadow: 0 8px 15px -3px rgba(0, 0, 0, 0.2), 0 4px 6px -2px rgba(0, 0, 0, 0.1);
    margin-bottom: 1.5rem;
  }

  .avatar {
    width: 8rem; /* Aumentado de 6rem para 8rem */
    height: 8rem; /* Aumentado de 6rem para 8rem */
    border-radius: 50%;
    border: 4px solid white; /* Borda aumentada */
    background: white;
    overflow: hidden;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .avatar img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .avatar-upload {
    position: relative;
    cursor: pointer;
    transition: all 0.3s ease;
  }

  .avatar-upload:hover {
    transform: translateY(-3px);
    box-shadow: 0 12px 20px -5px rgba(0, 0, 0, 0.3);
  }

  .avatar-overlay {
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(38, 130, 234, 0.8);
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    transition: opacity 0.3s ease;
  }

  .avatar-upload:hover .avatar-overlay {
    opacity: 1;
  }

  /* Informa√ß√µes do usu√°rio centralizadas */
  .user-info {
    text-align: center;
  }

  .username {
    font-size: 2.25rem; /* Aumentado ligeiramente */
    font-weight: 700;
    margin-bottom: 0.75rem;
  }

  /* Barra de progresso de n√≠vel centralizada */
  .level-container {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.75rem;
    margin-top: 0.5rem;
    flex-wrap: wrap;
  }

  .level-badge {
    background: rgba(255, 255, 255, 0.2);
    padding: 0.35rem 1rem; /* Aumentado */
    border-radius: 9999px;
    font-size: 0.9rem; /* Aumentado */
    font-weight: 600;
    backdrop-filter: blur(10px);
  }

  .progress-bar-container {
    width: 14rem; /* Aumentado */
    height: 0.6rem; /* Aumentado */
    background: rgba(255, 255, 255, 0.2);
    border-radius: 9999px;
    overflow: hidden;
  }

  .progress-bar-fill {
    height: 100%;
    background: linear-gradient(90deg, #fbbf24, #f59e0b);
    border-radius: 9999px;
    transition: width 0.5s ease;
    position: relative;
    overflow: hidden;
  }

  .progress-bar-fill::after {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    bottom: 0;
    width: 100%;
    background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
    animation: shimmer 2s infinite;
  }

  .progress-percent {
    font-size: 0.85rem; /* Aumentado */
    min-width: 3rem; /* Aumentado */
    text-align: center;
  }

  /* Estat√≠sticas centralizadas abaixo do avatar */
  .stats-section {
    display: flex;
    justify-content: center;
    gap: 2rem; /* Aumentado o espa√ßamento */
    flex-wrap: wrap;
  }

  .stat-card {
    background: rgba(255, 255, 255, 0.15);
    backdrop-filter: blur(10px);
    border-radius: 1.2rem; /* Aumentado */
    padding: 1.75rem 1.5rem; /* Aumentado */
    text-align: center;
    min-width: 9rem; /* Aumentado */
    box-shadow: 0 6px 12px -2px rgba(0, 0, 0, 0.15);
    border: 1px solid rgba(255, 255, 255, 0.25);
    transition: all 0.3s ease;
  }

  .stat-card:hover {
    transform: translateY(-6px);
    background: rgba(255, 255, 255, 0.25);
    box-shadow: 0 12px 20px -5px rgba(0, 0, 0, 0.2);
  }

  .stat-value {
    font-size: 1.7rem; /* Aumentado */
    font-weight: 700;
    margin-bottom: 0.35rem;
  }

  .stat-label {
    font-size: 0.9rem; /* Aumentado */
    opacity: 0.9;
    font-weight: 400;
  }

  /* Bot√£o de edi√ß√£o no canto */
  .edit-profile-btn {
    position: absolute;
    top: 1.5rem; /* Ajustado */
    right: 1.5rem; /* Ajustado */
    background: rgba(255, 255, 255, 0.9);
    color: var(--primary-blue);
    border: none;
    padding: 0.6rem 1.2rem; /* Aumentado */
    border-radius: 0.75rem;
    font-weight: 600;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    transition: all 0.3s ease;
    cursor: pointer;
    backdrop-filter: blur(10px);
    font-size: 0.95rem; /* Aumentado */
  }

  .edit-profile-btn:hover {
    background: white;
    transform: translateY(-2px);
    box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
  }

  /* Anima√ß√µes */
  @keyframes shimmer {
    0% { transform: translateX(-100%); }
    100% { transform: translateX(100%); }
  }

  @keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
  }

  @keyframes slideInUp {
    from {
      transform: translateY(20px);
      opacity: 0;
    }
    to {
      transform: translateY(0);
      opacity: 1;
    }
  }

  .animate-fadeIn {
    animation: fadeIn 0.5s ease-out;
  }

  .animate-slideInUp {
    animation: slideInUp 0.5s ease-out;
  }

  /* MODAL DE EDI√á√ÉO - CAMPOS COM BORDAS VIS√çVEIS */
  .form-input, .form-textarea, .form-select {
    width: 100%;
    padding: 0.85rem; /* Aumentado */
    border: 2px solid #d1d5db; /* Borda mais espessa e vis√≠vel */
    border-radius: 0.75rem; /* Cantos mais arredondados */
    font-size: 0.9rem;
    transition: all 0.3s ease;
    background-color: white;
    color: var(--gray-700);
  }

  .form-input:focus, .form-textarea:focus, .form-select:focus {
    outline: none;
    border-color: var(--primary-blue);
    box-shadow: 0 0 0 3px rgba(38, 130, 234, 0.15); /* Sombra mais suave */
    background-color: #fafafa;
  }

  .form-input:disabled {
    background-color: #f3f4f6;
    border-color: #e5e7eb;
    color: #6b7280;
    cursor: not-allowed;
  }

  .form-textarea {
    resize: vertical;
    min-height: 6rem; /* Aumentado */
    line-height: 1.5;
  }

  /* Avatar preview no modal - AUMENTADO */
  .avatar-preview {
    width: 8rem; /* Aumentado de 6rem para 8rem */
    height: 8rem; /* Aumentado de 6rem para 8rem */
    border-radius: 50%;
    border: 3px solid var(--blue-300); /* Borda mais vis√≠vel */
    overflow: hidden;
    margin: 0 auto 1.5rem; /* Aumentado */
    position: relative;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
  }

  .avatar-preview img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .avatar-upload-btn {
    position: absolute;
    bottom: 0.5rem;
    right: 0.5rem;
    background: var(--primary-blue);
    width: 2.5rem; /* Aumentado */
    height: 2.5rem; /* Aumentado */
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    box-shadow: 0 3px 6px rgba(0, 0, 0, 0.15);
    transition: all 0.3s ease;
    border: 2px solid white;
  }

  .avatar-upload-btn:hover {
    background: #1e70ea;
    transform: scale(1.1);
    box-shadow: 0 5px 10px rgba(0, 0, 0, 0.2);
  }

  .avatar-upload-btn svg {
    width: 1.2rem; /* Aumentado */
    height: 1.2rem; /* Aumentado */
    color: white;
  }

  /* Labels dos formul√°rios mais destacados */
  .form-label {
    display: block;
    font-size: 0.9rem;
    font-weight: 600;
    margin-bottom: 0.6rem;
    color: var(--gray-700);
  }

  /* Se√ß√£o "Sobre o Usu√°rio" modernizada */
  .about-section {
    background: white;
    border-radius: 1.5rem;
    padding: 1.75rem; /* Aumentado */
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    margin-top: 2rem; /* Aumentado */
    border-left: 4px solid var(--primary-blue);
  }

  .section-title {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 1.3rem; /* Aumentado */
    font-weight: 700;
    margin-bottom: 1.2rem; /* Aumentado */
    color: var(--gray-700);
  }

  .section-title img {
    width: 1.75rem; /* Aumentado */
    height: 1.75rem; /* Aumentado */
  }

  /* O restante do CSS permanece igual... */

  /* Conquistas - Design modernizado */
  .achievements-section {
    margin-top: 2.5rem; /* Aumentado */
  }

  .section-header {
    display: flex;
    flex-direction: column;
    gap: 1rem;
    margin-bottom: 1.5rem;
  }

  @media (min-width: 640px) {
    .section-header {
      flex-direction: row;
      justify-content: space-between;
      align-items: flex-end;
    }
  }

  .achievements-title {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--gray-700);
  }

  .achievements-title img {
    width: 2rem;
    height: 2rem;
  }

  .achievements-counter {
    background: var(--blue-100);
    color: var(--blue-800);
    padding: 0.5rem 1rem;
    border-radius: 0.75rem;
    font-size: 0.875rem;
    font-weight: 600;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
  }

  .filters-container {
    display: flex;
    gap: 0.75rem;
    align-items: center;
    flex-wrap: wrap;
  }

  .filter-select {
    border: 2px solid var(--gray-300); /* Borda mais vis√≠vel */
    border-radius: 0.5rem;
    padding: 0.6rem; /* Aumentado */
    font-size: 0.875rem;
    background: white;
    color: var(--gray-700);
    transition: all 0.2s ease;
    cursor: pointer;
  }

  .filter-select:focus {
    outline: none;
    border-color: var(--primary-blue);
    box-shadow: 0 0 0 3px rgba(38, 130, 234, 0.1);
  }

  /* Grid de conquistas modernizado */
  .achievements-grid {
    display: grid;
    grid-template-columns: repeat(1, 1fr);
    gap: 1.5rem;
    margin-bottom: 2rem;
  }

  @media (min-width: 640px) {
    .achievements-grid {
      grid-template-columns: repeat(2, 1fr);
    }
  }

  @media (min-width: 768px) {
    .achievements-grid {
      grid-template-columns: repeat(3, 1fr);
    }
  }

  @media (min-width: 1024px) {
    .achievements-grid {
      grid-template-columns: repeat(4, 1fr);
    }
  }

  .achievement-card {
    background: white;
    border-radius: 1rem;
    padding: 1.5rem;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
    cursor: pointer;
  }

  .achievement-card::before {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    border-radius: 1rem;
    padding: 2px;
    background: linear-gradient(135deg, var(--primary-blue), #8b5cf6, #f59e0b);
    mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
    mask-composite: subtract;
    opacity: 0;
    transition: opacity 0.3s ease;
  }

  .achievement-card:hover::before {
    opacity: 1;
  }

  .achievement-card:hover {
    transform: translateY(-5px);
    box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
  }

  .achievement-unlocked {
    border-left: 4px solid var(--success);
  }

  .achievement-locked {
    filter: grayscale(0.7);
    opacity: 0.8;
  }

  .achievement-icon {
    width: 4rem;
    height: 4rem;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 0 auto 1rem;
    font-size: 1.5rem;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
    position: relative;
    overflow: hidden;
  }

  .modal-body .achievement-icon {
  width: 6rem; /* Aumentado para melhor visualiza√ß√£o */
  height: 6rem; /* Aumentado para melhor visualiza√ß√£o */
  display: flex;
  align-items: center;
  justify-content: center;
  margin: 0 auto 1rem;
  font-size: 1.5rem;
  box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
  position: relative;
  overflow: hidden;
}

/* A imagem dentro do √≠cone no modal deve conter sem cortes */
.modal-body .achievement-icon img {
  width: 70%; /* Reduzido para garantir que caiba completo */
  height: 70%; /* Reduzido para garantir que caiba completo */
  object-fit: contain; /* Alterado de 'cover' para 'contain' */
}

  .achievement-icon::after {
    content: "";
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(135deg, rgba(255, 255, 255, 0.3), transparent);
    border-radius: 50%;
  }

  .achievement-title {
    font-size: 1.125rem;
    font-weight: 700;
    text-align: center;
    margin-bottom: 0.5rem;
  }

  .achievement-description {
    font-size: 0.875rem;
    text-align: center;
    color: var(--gray-500);
    margin-bottom: 1rem;
  }

  .achievement-badges {
    display: flex;
    gap: 0.5rem;
    justify-content: center;
    flex-wrap: wrap;
    margin-bottom: 1rem;
  }

  /* Cores de borda lateral baseadas na raridade */
.achievement-card.raridade-comum {
    border-left: 4px solid #3b82f6;
}

.achievement-card.raridade-rara {
    border-left: 4px solid #10b981;
}

.achievement-card.raridade-epica {
    border-left: 4px solid #8b5cf6;
}

.achievement-card.raridade-lendaria {
    border-left: 4px solid #f59e0b;
}

/* Efeitos hover baseados na raridade */
.achievement-card.raridade-comum:hover {
    box-shadow: 0 20px 25px -5px rgba(59, 130, 246, 0.3), 0 10px 10px -5px rgba(59, 130, 246, 0.2);
    border-left: 6px solid #3b82f6;
    transform: translateY(-8px) scale(1.02);
}

.achievement-card.raridade-rara:hover {
    box-shadow: 0 20px 25px -5px rgba(16, 185, 129, 0.3), 0 10px 10px -5px rgba(16, 185, 129, 0.2);
    border-left: 6px solid #10b981;
    transform: translateY(-8px) scale(1.02);
}

.achievement-card.raridade-epica:hover {
    box-shadow: 0 20px 25px -5px rgba(139, 92, 246, 0.3), 0 10px 10px -5px rgba(139, 92, 246, 0.2);
    border-left: 6px solid #8b5cf6;
    transform: translateY(-8px) scale(1.02);
}

.achievement-card.raridade-lendaria:hover {
    box-shadow: 0 20px 25px -5px rgba(245, 158, 11, 0.3), 0 10px 10px -5px rgba(245, 158, 11, 0.2);
    border-left: 6px solid #f59e0b;
    transform: translateY(-8px) scale(1.02);
}

/* Brilho sutil no border gradient no hover */
.achievement-card.raridade-comum:hover::before {
    opacity: 1;
    background: linear-gradient(135deg, #3b82f6, #60a5fa, #3b82f6);
}

.achievement-card.raridade-rara:hover::before {
    opacity: 1;
    background: linear-gradient(135deg, #10b981, #34d399, #10b981);
}

.achievement-card.raridade-epica:hover::before {
    opacity: 1;
    background: linear-gradient(135deg, #8b5cf6, #a78bfa, #8b5cf6);
}

.achievement-card.raridade-lendaria:hover::before {
    opacity: 1;
    background: linear-gradient(135deg, #f59e0b, #fbbf24, #f59e0b);
}

/* Transi√ß√µes suaves */
.achievement-card {
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
}

.achievement-card::before {
    transition: opacity 0.4s ease, background 0.4s ease;
}

/* Efeito de brilho pulsante sutil para conquistas desbloqueadas no hover */
.achievement-unlocked.raridade-comum:hover .achievement-icon {
    box-shadow: 0 0 20px rgba(59, 130, 246, 0.5);
}

.achievement-unlocked.raridade-rara:hover .achievement-icon {
    box-shadow: 0 0 20px rgba(16, 185, 129, 0.5);
}

.achievement-unlocked.raridade-epica:hover .achievement-icon {
    box-shadow: 0 0 20px rgba(139, 92, 246, 0.5);
}

.achievement-unlocked.raridade-lendaria:hover .achievement-icon {
    box-shadow: 0 0 20px rgba(245, 158, 11, 0.5);
}

.achievement-icon {
    transition: box-shadow 0.3s ease;
}


/* Efeito nos badges durante o hover */
.achievement-card:hover .badge {
    transform: scale(1.05);
}

.badge {
    transition: transform 0.3s ease;
}

/* Cores espec√≠ficas para os badges de categoria no hover */
.achievement-card.raridade-comum:hover .badge-categoria {
    background: rgba(59, 130, 246, 0.15);
    color: #1d4ed8;
}

.achievement-card.raridade-rara:hover .badge-categoria {
    background: rgba(16, 185, 129, 0.15);
    color: #047857;
}

.achievement-card.raridade-epica:hover .badge-categoria {
    background: rgba(139, 92, 246, 0.15);
    color: #7c3aed;
}

.achievement-card.raridade-lendaria:hover .badge-categoria {
    background: rgba(245, 158, 11, 0.15);
    color: #b45309;
}

/* Cores de borda para o modal baseadas na raridade */
.modal-header.raridade-comum {
    background: linear-gradient(135deg, #3b82f6, #2563eb);
}

.modal-header.raridade-rara {
    background: linear-gradient(135deg, #10b981, #059669);
}

.modal-header.raridade-epica {
    background: linear-gradient(135deg, #8b5cf6, #7c3aed);
}

.modal-header.raridade-lendaria {
    background: linear-gradient(135deg, #f59e0b, #d97706);
}

  .badge {
    padding: 0.25rem 0.5rem;
    border-radius: 9999px;
    font-size: 0.75rem;
    font-weight: 600;
  }

  .badge-rarity {
    background: rgba(59, 130, 246, 0.1);
    color: rgb(59, 130, 246);
  }

  .badge-category {
    background: rgba(16, 185, 129, 0.1);
    color: rgb(16, 185, 129);
  }

  .achievement-progress {
    width: 100%;
  }

  .progress-bar {
    width: 100%;
    height: 0.5rem;
    background: var(--gray-200);
    border-radius: 9999px;
    overflow: hidden;
    margin-bottom: 0.5rem;
  }

  .progress-fill {
    height: 100%;
    border-radius: 9999px;
    transition: width 0.5s ease;
    background: linear-gradient(90deg, var(--success), #34d399);
  }

  .progress-text {
    font-size: 0.75rem;
    color: var(--gray-500);
    text-align: center;
  }

  /* Se√ß√µes de conquistas desbloqueadas e bloqueadas */
  .achievements-section-title {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.75rem 1rem;
    border-radius: 0.75rem;
    margin: 2rem 0 1rem;
    font-weight: 600;
  }

  .unlocked-title {
    background: linear-gradient(135deg, var(--blue-100), #dbeafe);
    color: var(--blue-800);
  }

  .locked-title {
    background: var(--gray-100);
    color: var(--gray-600);
  }

  /* Pagina√ß√£o moderna */
  .pagination {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding-top: 1.5rem;
    border-top: 1px solid var(--gray-200);
    margin-top: 2rem;
  }

  .pagination-info {
    font-size: 0.875rem;
    color: var(--gray-500);
  }

  .pagination-controls {
    display: flex;
    align-items: center;
    gap: 1rem;
  }

  .pagination-btn {
    background: var(--blue-100);
    color: var(--blue-600);
    padding: 0.5rem 1rem;
    border-radius: 0.5rem;
    font-weight: 600;
    transition: all 0.2s ease;
    text-decoration: none;
    display: flex;
    align-items: center;
  }

  .pagination-btn:hover {
    background: var(--blue-200);
    transform: translateY(-1px);
  }

  .pagination-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
    transform: none;
  }

  .pagination-current {
    font-weight: 600;
    color: var(--blue-800);
  }

  .pagination-progress {
    width: 100%;
    max-width: 16rem;
    height: 0.375rem;
    background: var(--gray-200);
    border-radius: 9999px;
    overflow: hidden;
    margin: 1rem auto 0;
  }

  .pagination-progress-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--primary-blue), #8b5cf6);
    border-radius: 9999px;
    transition: width 0.5s ease;
  }

  /* Modais modernizados */
  .modal {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 50;
    padding: 1rem;
    background: rgba(0, 0, 0, 0.5);
    backdrop-filter: blur(4px);
    transition: opacity 0.3s ease, visibility 0.3s ease;
  }

  .modal-hidden {
    opacity: 0;
    visibility: hidden;
  }

  .modal-visible {
    opacity: 1;
    visibility: visible;
  }

  .modal-content {
    background: white;
    border-radius: 1.5rem;
    box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
    width: 100%;
    max-width: 28rem;
    overflow: hidden;
    transform: scale(0.9);
    transition: transform 0.3s ease;
  }

  .modal-visible .modal-content {
    transform: scale(1);
  }

  .modal-header {
    background: linear-gradient(135deg, var(--primary-blue), #1e40af);
    color: white;
    padding: 1.5rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .modal-title {
    font-size: 1.25rem;
    font-weight: 700;
  }

  .modal-close {
    background: none;
    border: none;
    color: white;
    font-size: 1.25rem;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    width: 2rem;
    height: 2rem;
    border-radius: 0.375rem;
    transition: background 0.2s ease;
  }

  .modal-close:hover {
    background: rgba(255, 255, 255, 0.1);
  }

  .modal-body {
    padding: 1.75rem; /* Aumentado */
  }

  .modal-footer {
    padding: 1.25rem 1.5rem; /* Aumentado */
    background: var(--gray-100);
    display: flex;
    justify-content: flex-end;
    gap: 0.75rem;
  }

  .btn {
    padding: 0.6rem 1.2rem; /* Aumentado */
    border-radius: 0.5rem;
    font-weight: 600;
    transition: all 0.2s ease;
    cursor: pointer;
    border: none;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    font-size: 0.9rem; /* Aumentado */
  }

  .btn-secondary {
    background: white;
    color: var(--gray-700);
    border: 2px solid var(--gray-300); /* Borda mais vis√≠vel */
  }

  .btn-secondary:hover {
    background: var(--gray-50);
    border-color: var(--gray-400);
  }

  .btn-primary {
    background: var(--primary-blue);
    color: white;
    border: 2px solid var(--primary-blue); /* Borda consistente */
  }

  .btn-primary:hover {
    background: #1e70ea;
    border-color: #1e70ea;
  }

  /* Formul√°rios modernizados */
  .form-group {
    margin-bottom: 1.5rem;
  }

  /* Cores para raridades */
  .rarity-comum { background: linear-gradient(135deg, #3b82f6, #60a5fa); color: white; }
  .rarity-rara { background: linear-gradient(135deg, #10b981, #34d399); color: white; }
  .rarity-epica { background: linear-gradient(135deg, #8b5cf6, #a78bfa); color: white; }
  .rarity-lendaria { background: linear-gradient(135deg, #f59e0b, #fbbf24); color: white; }

  .text-comum { color: #3b82f6; }
  .text-rara { color: #10b981; }
  .text-epica { color: #8b5cf6; }
  .text-lendaria { color: #f59e0b; }

  .badge-comum { background: rgba(59, 130, 246, 0.1); color: #3b82f6; }
  .badge-rara { background: rgba(16, 185, 129, 0.1); color: #10b981; }
  .badge-epica { background: rgba(139, 92, 246, 0.1); color: #8b5cf6; }
  .badge-lendaria { background: rgba(245, 158, 11, 0.1); color: #f59e0b; }

  /* Anima√ß√µes de entrada para elementos */
  .animate-stagger > * {
    opacity: 0;
    animation: fadeIn 0.5s ease-out forwards;
  }

  .animate-stagger > *:nth-child(1) { animation-delay: 0.1s; }
  .animate-stagger > *:nth-child(2) { animation-delay: 0.2s; }
  .animate-stagger > *:nth-child(3) { animation-delay: 0.3s; }
  .animate-stagger > *:nth-child(4) { animation-delay: 0.4s; }
  .animate-stagger > *:nth-child(5) { animation-delay: 0.5s; }
  .animate-stagger > *:nth-child(6) { animation-delay: 0.6s; }
  .animate-stagger > *:nth-child(7) { animation-delay: 0.7s; }
  .animate-stagger > *:nth-child(8) { animation-delay: 0.8s; }
</style>
{% endblock %}

{% block content %}
<!-- Header do Perfil - Layout Centralizado -->
<div class="profile-header animate-fadeIn">
  <!-- Bot√£o de Edi√ß√£o no canto -->
  <button id="edit-profile-btn" class="edit-profile-btn">
    <img src="{% static 'imagem/person_edit_100dp_000000_FILL0_wght400_GRAD0_opsz48.png' %}" alt="editar" class="w-5 h-5" />
    <span>Editar</span>
  </button>

  <!-- Se√ß√£o do Avatar Centralizada - AUMENTADA -->
  <div class="avatar-section">
    <div class="avatar-upload" id="avatar-container">
      <div class="avatar-container">
        <div class="avatar">
          <img id="avatar-display" src="{{ perfil.avatar.url }}?{% now 'U' %}" alt="Avatar">
        </div>
        <div class="avatar-overlay">
          <i class="fas fa-camera text-white text-2xl"></i> <!-- √çcone aumentado -->
        </div>
      </div>
    </div>
    
    <div class="user-info">
      <h2 class="username" id="username-header">{{ request.user.username }}</h2>
      
      <div class="level-container">
        <span class="level-badge">N√≠vel {{ perfil.nivel }}</span>
        <div class="progress-bar-container">
          <div class="progress-bar-fill" style="width: {{ progresso_xp }}%"></div>
        </div>
        <span class="progress-percent">{{ progresso_xp|floatformat:0 }}%</span>
      </div>
    </div>
  </div>

  <!-- Estat√≠sticas Centralizadas Abaixo -->
<div class="stats-section">
  <div class="stat-card">
    <div class="stat-value">{{ perfil.xp }}</div>
    <div class="stat-label">XP Total</div>
  </div>
  <div class="stat-card">
    <div class="stat-value">{{ licoes }}</div>  <!-- CORRE√á√ÉO AQUI -->
    <div class="stat-label">Li√ß√µes</div>
  </div>
  <div class="stat-card">
    <div class="stat-value">{{ desbloq_count }}</div>
    <div class="stat-label">Conquistas</div>
  </div>
</div>
</div>



<!-- Sobre o Usu√°rio Modernizado -->
<div class="about-section animate-slideInUp">
  <h3 class="section-title">
    <img src="{% static 'imagem/info_24dp_2682EA_FILL0_wght400_GRAD0_opsz24.png' %}" alt="informa√ß√£o" />
    Sobre o Usu√°rio
  </h3>
  <p class="text-gray-700" id="user-description">{{ perfil.descricao }}</p>
</div>

<hr class="my-8 border-t-2 border-blue-200" />

<!-- Container principal das conquistas -->
<div id="conquistas-container" class="achievements-section">
  <!-- Cabe√ßalho da se√ß√£o de conquistas -->
  <div class="section-header">
    <div>
      <h3 class="achievements-title">
        <img src="{% static 'imagem/license_40dp_2682EA_FILL0_wght400_GRAD0_opsz40.png' %}" alt="conquistas" />
        Conquistas
      </h3>
      <div class="achievements-counter">
        <span id="contador-conquistas">{{ desbloq_count }} de {{ total_conquistas }} conquistas</span>
      </div>
    </div>

    <!-- Filtros -->
    <div class="filters-container">
      <img src="{% static 'imagem/filter_icon_136624.png' %}" alt="Filtro" class="w-5 h-5" />
      <form method="get" id="filtroForm" class="flex gap-2">
        {% if request.GET.page %}
        <input type="hidden" name="page" value="{{ request.GET.page }}">
        {% endif %}

        <select name="raridade" id="raridadeSelect" class="filter-select">
          <option value="todas" {% if request.GET.raridade == 'todas' or not request.GET.raridade %}selected{% endif %}>Todas as Raridades</option>
          <option value="comum" {% if request.GET.raridade == 'comum' %}selected{% endif %}>Comum</option>
          <option value="rara" {% if request.GET.raridade == 'rara' %}selected{% endif %}>Rara</option>
          <option value="epica" {% if request.GET.raridade == 'epica' %}selected{% endif %}>√âpico</option>
          <option value="lendaria" {% if request.GET.raridade == 'lendaria' %}selected{% endif %}>Lend√°rio</option>
        </select>

        <select name="categoria" id="categoriaSelect" class="filter-select">
          <option value="todas" {% if request.GET.categoria == 'todas' or not request.GET.categoria %}selected{% endif %}>Todas as Categorias</option>
          <option value="progresso" {% if request.GET.categoria == 'progresso' %}selected{% endif %}>Progresso</option>
          <option value="habilidade" {% if request.GET.categoria == 'habilidade' %}selected{% endif %}>Habilidade</option>
          <option value="precisao" {% if request.GET.categoria == 'precisao' %}selected{% endif %}>Precis√£o</option>
          <option value="dominio" {% if request.GET.categoria == 'dominio' %}selected{% endif %}>Dom√≠nio</option>
          <option value="especial" {% if request.GET.categoria == 'especial' %}selected{% endif %}>Especial</option>
        </select>
        
        <button type="submit" style="display: none;"></button>
      </form>
    </div>
  </div>

  <!-- Conquistas Desbloqueadas -->
  <div class="my-6">
    <div class="achievements-section-title unlocked-title">
      <img src="{% static 'imagem/diamond_shine_100dp_2682EA_FILL0_wght400_GRAD0_opsz48.png' %}" alt="diamante" class="w-6 h-6" />
      Desbloqueadas (<span id="contador-desbloqueadas">{{ conquistas_desbloqueadas|length }}</span>)
    </div>
  </div>

  <!-- Grid de Conquistas Desbloqueadas -->
  <div class="achievements-grid animate-stagger">
    {% for conquista_data in conquistas_desbloqueadas %}
    <div class="achievement-card achievement-unlocked raridade-{{ conquista_data.conquista.raridade }}"
        data-titulo="{{ conquista_data.conquista.titulo }}"
        data-descricao="{{ conquista_data.conquista.descricao }}" 
        data-raridade="{{ conquista_data.conquista.raridade }}"
        data-categoria="{{ conquista_data.conquista.categoria }}" 
        data-icone="{% if conquista_data.conquista.icone %}{{ conquista_data.conquista.icone.url }}{% endif %}"
        data-progresso="100"
        data-objetivo="{{ conquista_data.conquista.valor_requerido }} {{ conquista_data.conquista.get_tipo_evento_display }}"
        onclick="abrirConquista(this)">
      <div class="achievement-icon rarity-{{ conquista_data.conquista.raridade }}">
        {% if conquista_data.conquista.icone %}
        <img src="{{ conquista_data.conquista.icone.url }}" alt="{{ conquista_data.conquista.titulo }}" class="w-10 h-10 object-contain">
        {% else %}
        <i class="fas fa-award"></i>
        {% endif %}
      </div>
      <h3 class="achievement-title text-{{ conquista_data.conquista.raridade }}">{{ conquista_data.conquista.titulo }}</h3>
      <p class="achievement-description">{{ conquista_data.conquista.descricao }}</p>
      <div class="achievement-badges">
        <span class="badge badge-{{ conquista_data.conquista.raridade }}">{{ conquista_data.conquista.get_raridade_display }}</span>
        <span class="badge badge-{{ conquista_data.conquista.categoria }}">{{ conquista_data.conquista.get_categoria_display }}</span>
      </div>
      <div class="achievement-progress">
        <div class="progress-bar">
          <div class="progress-fill" style="width: 100%"></div>
        </div>
        <div class="progress-text">‚úÖ Conclu√≠do</div>
      </div>
    </div>
    {% empty %}
    <div class="col-span-full flex items-center justify-center py-8">
      <p class="text-gray-500 text-center">Nenhuma conquista desbloqueada ainda.</p>
    </div>
    {% endfor %}
  </div>

  <!-- Conquistas Bloqueadas -->
  <div class="my-6">
    <div class="achievements-section-title locked-title">
      <img src="{% static 'imagem/lock_100dp_000000_FILL0_wght400_GRAD0_opsz48.png' %}" alt="bloqueadas" class="w-6 h-6" />
      Bloqueadas (<span id="contador-bloqueadas">{{ conquistas_bloqueadas|length }}</span>)
    </div>
  </div>

  <div class="achievements-grid animate-stagger">
    {% for conquista_data in conquistas_bloqueadas %}
    <div class="achievement-card achievement-locked raridade-{{ conquista_data.conquista.raridade }}"
        data-titulo="{{ conquista_data.conquista.titulo }}"
        data-descricao="{{ conquista_data.conquista.descricao }}" 
        data-raridade="{{ conquista_data.conquista.raridade }}"
        data-categoria="{{ conquista_data.conquista.categoria }}" 
        data-icone="{% if conquista_data.conquista.icone %}{{ conquista_data.conquista.icone.url }}{% endif %}"
        data-progresso="{{ conquista_data.progresso.percentual }}"
        data-objetivo="{{ conquista_data.conquista.valor_requerido }} {{ conquista_data.conquista.get_tipo_evento_display }}"
        onclick="abrirConquista(this)">
      <div class="achievement-icon rarity-{{ conquista_data.conquista.raridade }}">
        {% if conquista_data.conquista.icone %}
        <img src="{{ conquista_data.conquista.icone.url }}" alt="{{ conquista_data.conquista.titulo }}" class="w-10 h-10 object-contain">
        {% else %}
        <i class="fas fa-award"></i>
        {% endif %}
      </div>
      <h3 class="achievement-title text-gray-500">{{ conquista_data.conquista.titulo }}</h3>
      <p class="achievement-description">{{ conquista_data.conquista.descricao }}</p>
      <div class="achievement-badges">
        <span class="badge badge-{{ conquista_data.conquista.raridade }}">{{ conquista_data.conquista.get_raridade_display }}</span>
        <span class="badge badge-{{ conquista_data.conquista.categoria }}">{{ conquista_data.conquista.get_categoria_display }}</span>
      </div>
      <div class="achievement-progress">
        <div class="progress-bar">
          <div class="progress-fill" style="width: {{ conquista_data.progresso.percentual }}%"></div>
        </div>
        <div class="progress-text">{{ conquista_data.progresso.progresso_atual }}/{{ conquista_data.progresso.meta }} ({{ conquista_data.progresso.percentual }}%)</div>
      </div>
    </div>
    {% empty %}
    <div class="col-span-full">
      <p class="text-gray-400 text-center py-4">Nenhuma conquista bloqueada.</p>
    </div>
    {% endfor %}
  </div>

  <!-- Pagina√ß√£o -->
  {% if page_obj.paginator.num_pages > 1 %}
  <div class="pagination">
    <div class="pagination-info">
      Mostrando {{ page_obj.start_index }}-{{ page_obj.end_index }} de {{ page_obj.paginator.count }} conquistas
    </div>

    <div class="pagination-controls">
      {% if page_obj.has_previous %}
      <a href="?page={{ page_obj.previous_page_number }}{% for key, value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}#conquistas-container"
        class="pagination-btn">
        ‚Üê
      </a>
      {% else %}
      <span class="pagination-btn" disabled>‚Üê</span>
      {% endif %}

      <span class="pagination-current">
        P√°gina {{ page_obj.number }} de {{ page_obj.paginator.num_pages }}
      </span>

      {% if page_obj.has_next %}
      <a href="?page={{ page_obj.next_page_number }}{% for key, value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}#conquistas-container"
        class="pagination-btn">
        ‚Üí
      </a>
      {% else %}
      <span class="pagination-btn" disabled>‚Üí</span>
      {% endif %}
    </div>
  </div>

  <!-- Indicador de progresso da pagina√ß√£o -->
  <div class="pagination-progress">
    <div class="pagination-progress-fill" style="width: {% widthratio page_obj.number page_obj.paginator.num_pages 100 %}%"></div>
  </div>
  {% endif %}
</div>

<!-- Modal Conquista -->
<div id="modal-conquista" class="modal modal-hidden">
  <div class="modal-content">
    <div class="modal-header">
      <h3 id="conquista-titulo" class="modal-title">T√≠tulo da Conquista</h3>
      <button type="button" onclick="fecharConquista()" class="modal-close">
        <i class="fas fa-times"></i>
      </button>
    </div>
    <div class="modal-body">
      <div class="flex flex-col items-center text-center">
        <div id="conquista-icone" class="achievement-icon rarity-comum mb-4">üèÜ</div>
        <p id="conquista-descricao" class="text-gray-700 mb-4">Descri√ß√£o da conquista...</p>
        <p id="conquista-objetivo" class="text-sm text-blue-600 italic mb-4">
          Objetivo da conquista aparecer√° aqui...
        </p>
        <div class="achievement-badges mb-6">
          <span id="conquista-raridade" class="badge badge-comum">Raridade</span>
          <span id="conquista-categoria" class="badge badge-categoria">Categoria</span>
        </div>
        <div class="w-full">
          <div class="flex justify-between text-sm mb-1">
            <span class="text-gray-600">Progresso</span>
            <span id="conquista-progresso-text" class="text-gray-800 font-semibold">0%</span>
          </div>
          <div class="progress-bar">
            <div id="conquista-progresso" class="progress-fill" style="width: 0%"></div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Modal de Edi√ß√£o de Perfil - CAMPOS COM BORDAS VIS√çVEIS -->
<div id="edit-profile-modal" class="modal modal-hidden">
  <div class="modal-content">
    <form method="POST" enctype="multipart/form-data" id="profile-form">
      {% csrf_token %}
      <div class="modal-header">
        <h3 class="modal-title">Editar Perfil</h3>
        <button type="button" id="close-modal" class="modal-close">
          <i class="fas fa-times"></i>
        </button>
      </div>

      <div class="modal-body">
        <div class="flex flex-col items-center mb-6">
          <div class="avatar-preview" id="avatar-preview">
            {% if perfil.avatar %}
            <img src="{{ perfil.avatar.url }}?{% now 'U' %}" alt="Avatar">
            {% else %}
            <img src="{% static 'default-avatar.png' %}?{% now 'U' %}" alt="Avatar">
            {% endif %}
            <div id="btnUploadFoto" class="avatar-upload-btn">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7h4l2-3h6l2 3h4v13H3V7z" />
                <circle cx="12" cy="13" r="3" stroke="currentColor" stroke-width="2" fill="none" />
              </svg>
            </div>
          </div>
          <p class="text-sm text-gray-600">Clique na c√¢mera para alterar sua foto</p>
          <input type="file" name="avatar" id="uploadFoto" accept="image/*" class="hidden">
        </div>

        <div class="form-group">
          <label for="username" class="form-label">Nome de usu√°rio</label>
          <input type="text" id="username" value="{{ user.username }}" disabled class="form-input">
        </div>

        <div class="form-group">
          <label for="description" class="form-label">Descri√ß√£o do perfil</label>
          <textarea name="descricao" id="description" rows="3" class="form-textarea">{{ perfil.descricao }}</textarea>
        </div>

        <h2 class="text-blue-800 font-bold text-center my-4">Compartilhe suas Redes</h2>

        <div class="form-group">
          <label for="github" class="form-label">GitHub</label>
          <input type="url" name="github" id="github" value="{{ perfil.github|default:'' }}" class="form-input"
            placeholder="https://github.com/seuusuario"
            pattern="https?:\/\/(www\.)?github\.com\/[a-zA-Z0-9_-]+\/?"
            title="Digite uma URL v√°lida do GitHub (ex: https://github.com/seuusuario)">
        </div>

        <div class="form-group">
          <label for="linkedin" class="form-label">LinkedIn</label>
          <input type="url" name="linkedin" id="linkedin" value="{{ perfil.linkedin|default:'' }}" class="form-input"
            placeholder="https://linkedin.com/in/seunome"
            pattern="https?:\/\/(www\.)?linkedin\.com\/in\/[a-zA-Z0-9-]+\/?"
            title="Digite uma URL v√°lida do LinkedIn (ex: https://linkedin.com/in/seunome)">
        </div>
      </div>

      <div class="modal-footer">
        <button type="button" id="cancel-edit" class="btn btn-secondary">Cancelar</button>
        <button type="submit" class="btn btn-primary">Salvar Altera√ß√µes</button>
      </div>
    </form>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
  document.addEventListener('DOMContentLoaded', function () {
    // Salvar posi√ß√£o do scroll antes de submeter formul√°rios
    let scrollPosition = 0;
    
    // Salvar posi√ß√£o quando clicar em links de pagina√ß√£o
    document.querySelectorAll('a[href*="page="]').forEach(link => {
      link.addEventListener('click', function() {
        sessionStorage.setItem('conquistasScrollPosition', window.scrollY);
      });
    });
    
    // Restaurar posi√ß√£o do scroll ap√≥s carregar a p√°gina
    const savedPosition = sessionStorage.getItem('conquistasScrollPosition');
    if (savedPosition) {
      setTimeout(() => {
        window.scrollTo(0, parseInt(savedPosition));
        sessionStorage.removeItem('conquistasScrollPosition');
      }, 100);
    }

    // Setar valores dos selects
    const urlParams = new URLSearchParams(window.location.search);
    const raridade = urlParams.get('raridade') || 'todas';
    const categoria = urlParams.get('categoria') || 'todas';

    document.getElementById('raridadeSelect').value = raridade;
    document.getElementById('categoriaSelect').value = categoria;

    // Submeter form quando select mudar
    document.getElementById('raridadeSelect').addEventListener('change', function () {
      sessionStorage.setItem('conquistasScrollPosition', window.scrollY);
      submitFiltros();
    });

    document.getElementById('categoriaSelect').addEventListener('change', function () {
      sessionStorage.setItem('conquistasScrollPosition', window.scrollY);
      submitFiltros();
    });

    // Fun√ß√£o para submeter filtros mantendo outros par√¢metros
    function submitFiltros() {
      const form = document.getElementById('filtroForm');
      const urlParams = new URLSearchParams(window.location.search);
      
      // Manter p√°gina se existir
      const page = urlParams.get('page');
      if (page) {
        if (!form.querySelector('input[name="page"]')) {
          const hiddenInput = document.createElement('input');
          hiddenInput.type = 'hidden';
          hiddenInput.name = 'page';
          hiddenInput.value = page;
          form.appendChild(hiddenInput);
        }
      }
      
      // Adicionar √¢ncora para voltar √† posi√ß√£o
      if (!form.querySelector('input[name="anchor"]')) {
        const anchorInput = document.createElement('input');
        anchorInput.type = 'hidden';
        anchorInput.name = 'anchor';
        anchorInput.value = 'conquistas-container';
        form.appendChild(anchorInput);
      }
      
      form.submit();
    }

    // Garantir que pagina√ß√£o mantenha filtros
    const paginationLinks = document.querySelectorAll('a[href*="page="]');
    
    paginationLinks.forEach(link => {
      const url = new URL(link.href, window.location.origin);
      const params = new URLSearchParams(url.search);
      
      // Manter raridade
      if (raridade !== 'todas') {
        params.set('raridade', raridade);
      }
      
      // Manter categoria  
      if (categoria !== 'todas') {
        params.set('categoria', categoria);
      }
      
      // Adicionar √¢ncora
      params.set('anchor', 'conquistas-container');
      
      // Atualizar href
      url.search = params.toString();
      link.href = url.toString();
    });
    
    // Rolar para √¢ncora se especificado na URL
    if (window.location.hash === '#conquistas-container' || urlParams.get('anchor') === 'conquistas-container') {
      setTimeout(() => {
        const element = document.getElementById('conquistas-container');
        if (element) {
          const offsetTop = element.getBoundingClientRect().top + window.pageYOffset - 100;
          window.scrollTo({ top: offsetTop, behavior: 'smooth' });
        }
      }, 100);
    }
  });

  function abrirConquista(el) {
  document.getElementById("conquista-titulo").textContent = el.dataset.titulo;
  document.getElementById("conquista-descricao").textContent = el.dataset.descricao;
  document.getElementById("conquista-objetivo").textContent = "Objetivo: " + el.dataset.objetivo;

  const iconeDiv = document.getElementById("conquista-icone");
  const modalHeader = document.querySelector('#modal-conquista .modal-header');
  
  // Limpar classes de raridade anteriores
  iconeDiv.className = 'achievement-icon';
  modalHeader.className = 'modal-header';
  
  // Aplicar classes de raridade
  iconeDiv.classList.add(`rarity-${el.dataset.raridade}`);
  modalHeader.classList.add(`raridade-${el.dataset.raridade}`);
  
  if (el.dataset.icone && el.dataset.icone !== "None") {
    iconeDiv.innerHTML = `<img src="${el.dataset.icone}" alt="${el.dataset.titulo}">`;
  } else {
    iconeDiv.innerHTML = "üèÜ";
  }

  const raridadeEl = document.getElementById("conquista-raridade");
  raridadeEl.textContent = el.dataset.raridade.charAt(0).toUpperCase() + el.dataset.raridade.slice(1);
  raridadeEl.className = `badge badge-${el.dataset.raridade}`;

  const categoriaEl = document.getElementById("conquista-categoria");
  categoriaEl.textContent = el.dataset.categoria.charAt(0).toUpperCase() + el.dataset.categoria.slice(1);
  categoriaEl.className = `badge badge-${el.dataset.categoria}`;

  const progresso = parseInt(el.dataset.progresso) || 0;
  document.getElementById("conquista-progresso").style.width = progresso + "%";
  document.getElementById("conquista-progresso-text").textContent = progresso + "%";

  const modal = document.getElementById("modal-conquista");
  modal.classList.remove("modal-hidden");
  modal.classList.add("modal-visible");
}

  function fecharConquista() {
    const modal = document.getElementById("modal-conquista");
    modal.classList.remove("modal-visible");
    modal.classList.add("modal-hidden");
  }

  document.getElementById("modal-conquista").addEventListener("click", function (e) {
    if (e.target === this) fecharConquista();
  });

  // Modal de edi√ß√£o de perfil
  const editProfileBtn = document.getElementById('edit-profile-btn');
  const modal = document.getElementById('edit-profile-modal');
  const closeModalBtn = document.getElementById('close-modal');
  const cancelEditBtn = document.getElementById('cancel-edit');
  const btnUploadFoto = document.getElementById('btnUploadFoto');
  const uploadFoto = document.getElementById('uploadFoto');
  const profileForm = document.getElementById('profile-form');

  function openModal() {
    modal.classList.remove('modal-hidden');
    modal.classList.add('modal-visible');
  }

  function closeModal() {
    modal.classList.remove('modal-visible');
    modal.classList.add('modal-hidden');
  }

  editProfileBtn.addEventListener('click', openModal);
  closeModalBtn.addEventListener('click', closeModal);
  cancelEditBtn.addEventListener('click', closeModal);

  modal.addEventListener('click', (e) => {
    if (e.target === modal) closeModal();
  });

  btnUploadFoto.addEventListener('click', () => uploadFoto.click());

  // Preview do avatar
  document.getElementById('uploadFoto').addEventListener('change', function (e) {
    const file = e.target.files[0];
    if (file) {
      const reader = new FileReader();

      reader.onload = function (e) {
        // Atualiza a preview no modal
        const preview = document.querySelector('#avatar-preview img');
        if (preview) {
          preview.src = e.target.result;
        }

        // Atualiza tamb√©m a imagem principal
        const mainAvatar = document.getElementById('avatar-display');
        if (mainAvatar) {
          mainAvatar.src = e.target.result;
        }
      }

      reader.readAsDataURL(file);
    }
  });

  // VALIDA√á√ÉO MELHORADA PARA URLs
  profileForm.addEventListener('submit', function (e) {
    e.preventDefault();
    
    const github = document.getElementById('github').value.trim();
    const linkedin = document.getElementById('linkedin').value.trim();
    
    let isValid = true;
    let errorMessage = '';

    // Valida√ß√£o espec√≠fica para GitHub
    if (github) {
      const githubRegex = /^https?:\/\/(www\.)?github\.com\/[a-zA-Z0-9_-]+\/?$/;
      if (!githubRegex.test(github)) {
        isValid = false;
        errorMessage = '‚ùå URL do GitHub inv√°lida! Deve seguir o formato: https://github.com/seuusuario';
      }
    }

    // Valida√ß√£o espec√≠fica para LinkedIn
    if (linkedin) {
      const linkedinRegex = /^https?:\/\/(www\.)?linkedin\.com\/in\/[a-zA-Z0-9-]+\/?$/;
      if (!linkedinRegex.test(linkedin)) {
        isValid = false;
        errorMessage = errorMessage ? errorMessage + '\n\n‚ùå URL do LinkedIn inv√°lida! Deve seguir o formato: https://linkedin.com/in/seunome' 
                                   : '‚ùå URL do LinkedIn inv√°lida! Deve seguir o formato: https://linkedin.com/in/seunome';
      }
    }

    if (!isValid) {
      alert(errorMessage);
      return;
    }

    // Se passou na valida√ß√£o, adicionar campo hidden para manter scroll no topo
    const scrollTopInput = document.createElement('input');
    scrollTopInput.type = 'hidden';
    scrollTopInput.name = 'scroll_top';
    scrollTopInput.value = 'true';
    profileForm.appendChild(scrollTopInput);

    // Submeter o formul√°rio
    profileForm.submit();
  });


</script>
{% endblock %}