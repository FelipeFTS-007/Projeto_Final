{% extends "base.html" %}
{% load static %}

{% block title %}Tarefas - {{ modulo.titulo }}{% endblock %}

{% block extra_css %}
<style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
    
    /* Vari√°veis de cores para consist√™ncia */
    :root {
        --primary-blue: #3B82F6;
        --primary-dark-blue: #1E40AF;
        --light-blue: #EFF6FF;
        --text-blue: #1E40AF;
        --light-bg: #F8FAFC;
        --primary-green: #10B981;
        --dark-green: #059669;
        --light-green: #ECFDF5;
    }
    
    /* Anima√ß√µes globais */
    @keyframes fadeIn {
        from { opacity: 0; transform: translateY(10px); }
        to { opacity: 1; transform: translateY(0); }
    }
    
    @keyframes float {
        0% { transform: translateY(0px); }
        50% { transform: translateY(-8px); }
        100% { transform: translateY(0px); }
    }
    
    /* Cabe√ßalho modernizado - MELHOR DISTRIBUI√á√ÉO */
    .page-header {
        background: linear-gradient(135deg, #3B82F6 0%, #1E40AF 100%);
        border-radius: 1.5rem;
        padding: 2rem;
        margin-bottom: 1.5rem;
        position: relative;
        overflow: hidden;
        box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
    }
    
    .page-header::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23ffffff' fill-opacity='0.1'%3E%3Ccircle cx='30' cy='30' r='2'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E");
        animation: float 6s ease-in-out infinite;
    }
    
    .header-content {
        position: relative;
        z-index: 2;
    }
    
    .page-title {
        font-size: 2.25rem;
        font-weight: 800;
        color: white;
        margin-bottom: 0.5rem;
        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        background: linear-gradient(135deg, #fff 0%, #f0f4ff 100%);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        line-height: 1.2;
    }
    
    .page-subtitle {
        font-size: 1.125rem;
        color: rgba(255, 255, 255, 0.9);
        margin-bottom: 0;
        font-weight: 400;
        max-width: 100%;
        line-height: 1.5;
    }
    
    /* MELHOR DISTRIBUI√á√ÉO DO HEADER */
    .header-main {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        gap: 2rem;
    }
    
    .header-text {
        flex: 1;
        min-width: 0; /* Permite que o texto quebre corretamente */
    }
    
    .header-progress {
        flex-shrink: 0;
        text-align: right;
        display: flex;
        align-items: center;
        height: 100%;
    }
    
    /* CORRE√á√ÉO: Progress badge no header - MAIOR E MAIS VIS√çVEL, MELHOR CENTRALIZADO */
    .progress-badge {
        background: rgba(255, 255, 255, 0.25);
        color: white;
        padding: 0.75rem 1.5rem;
        border-radius: 9999px;
        font-weight: 700;
        font-size: 1.1rem;
        backdrop-filter: blur(10px);
        border: 2px solid rgba(255, 255, 255, 0.4);
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        min-width: 120px;
        text-align: center;
        display: flex;
        align-items: center;
        justify-content: center;
        height: fit-content;
        margin-top: 1rem; /* CORRE√á√ÉO: Mais espa√ßo no topo para melhor centraliza√ß√£o */
    }
    
    /* CORRE√á√ÉO: √çcone do foguete maior */
    .module-icon {
        width: 5rem;
        height: 5rem;
        filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.2));
    }
    
    .floating-element {
        animation: float 4s ease-in-out infinite;
    }
    
    /* CORRE√á√ÉO: Cards de progresso resumo - MAIS COMPACTOS */
    .stats-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
        gap: 1rem;
        margin-bottom: 1.5rem;
    }
    
    .stat-card {
        border-radius: 1rem;
        padding: 1rem; /* CORRE√á√ÉO: Menos padding para cards mais compactos */
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        transition: all 0.3s ease;
        display: flex;
        flex-direction: column;
        align-items: center;
        text-align: center;
        position: relative;
        overflow: hidden;
    }
    
    .stat-card::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 4px;
        background: linear-gradient(90deg, var(--card-color-1, #3B82F6), var(--card-color-2, #1E40AF));
    }
    
    .stat-card:hover {
        transform: translateY(-3px);
        box-shadow: 0 8px 12px -3px rgba(0, 0, 0, 0.1);
    }
    
    .stat-icon {
        width: 2.25rem; /* CORRE√á√ÉO: √çcone menor */
        height: 2.25rem;
        margin-bottom: 0.5rem; /* CORRE√á√ÉO: Menos espa√ßo */
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 0.75rem;
        background: rgba(255, 255, 255, 0.2);
    }
    
    .stat-number {
        font-size: 1.5rem; /* CORRE√á√ÉO: Texto menor */
        font-weight: 700;
        color: white;
        margin-bottom: 0.25rem;
        text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
    }
    
    .stat-label {
        font-size: 0.75rem; /* CORRE√á√ÉO: Texto menor */
        color: rgba(255, 255, 255, 0.9);
        font-weight: 500;
    }
    
    /* CORRE√á√ÉO: XP em verde para pr√°tica */
    .stat-xp {
        margin-top: 0.25rem;
        font-size: 0.7rem;
        color: rgba(255, 255, 255, 0.9);
    }
    
    /* Cores espec√≠ficas para cada card de estat√≠stica */
    .stat-card-teoria {
        background: linear-gradient(135deg, #3B82F6 0%, #1E40AF 100%);
        --card-color-1: #3B82F6;
        --card-color-2: #1E40AF;
    }
    
    .stat-card-pratica {
        background: linear-gradient(135deg, #10B981 0%, #059669 100%);
        --card-color-1: #10B981;
        --card-color-2: #059669;
    }
    
    /* CORRE√á√ÉO: Abas Teoria / Pr√°tica - ESTILO INVERTIDO */
    .tab-container {
        display: flex;
        border-radius: 1rem;
        background: var(--light-blue);
        padding: 0.5rem;
        margin-bottom: 1.5rem;
        box-shadow: 0 4px 8px -1px rgba(0, 0, 0, 0.1);
        border: 2px solid #E2E8F0;
        gap: 0.5rem;
    }
    
    .tab-btn {
        flex: 1;
        padding: 0.75rem 1.25rem;
        font-weight: 600;
        border-radius: 0.75rem;
        transition: all 0.3s ease;
        text-align: center;
        cursor: pointer;
        font-size: 0.95rem;
        position: relative;
        overflow: hidden;
    }
    
    /* CORRE√á√ÉO: Estilo invertido - aba ativa SEM fundo, inativa COM fundo */
    .tab-active {
        background: white;
        color: var(--primary-blue);
        box-shadow: 0 2px 6px rgba(59, 130, 246, 0.2);
        border: 2px solid var(--primary-blue);
        transform: translateY(-1px);
    }
    
    .tab-inactive {
        background: rgba(59, 130, 246, 0.1);
        color: #64748B;
        border: 2px solid transparent;
    }
    
    .tab-inactive:hover {
        background: rgba(59, 130, 246, 0.2);
        color: var(--primary-blue);
        transform: translateY(-1px);
    }
    
    /* CORRE√á√ÉO: Estilo espec√≠fico para a aba de pr√°tica quando ativa */
    .tab-pratica-active {
        background: white;
        color: var(--primary-green);
        box-shadow: 0 2px 6px rgba(16, 185, 129, 0.2);
        border: 2px solid var(--primary-green);
        transform: translateY(-1px);
    }
    
    .tab-pratica-inactive {
        background: rgba(16, 185, 129, 0.1);
        color: #64748B;
        border: 2px solid transparent;
    }
    
    .tab-pratica-inactive:hover {
        background: rgba(16, 185, 129, 0.2);
        color: var(--primary-green);
        transform: translateY(-1px);
    }
    
    /* Dica de aprendizado - MAIS COMPACTA */
    .learning-tip {
        background: linear-gradient(135deg, var(--light-blue) 0%, #EDF2FF 100%);
        border: 2px solid #3B82F6;
        border-radius: 0.75rem;
        padding: 1rem;
        margin-bottom: 1.5rem;
        display: flex;
        align-items: flex-start;
        gap: 0.75rem;
        box-shadow: 0 2px 8px rgba(59, 130, 246, 0.1);
    }
    
    .tip-icon {
        width: 1.25rem;
        height: 1.25rem;
        flex-shrink: 0;
    }
    
    .tip-text {
        color: var(--text-blue);
        font-size: 0.85rem;
        line-height: 1.4;
        margin: 0;
    }
    
    /* Cart√µes de aulas - MAIS COMPACTOS E MELHOR DELINEADOS */
    .lesson-card {
        background: white;
        border-radius: 1rem;
        box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
        overflow: hidden;
        transition: all 0.3s ease;
        position: relative;
        animation: fadeIn 0.5s ease forwards;
        opacity: 0;
        transform: translateY(10px);
        border: 2px solid #E2E8F0;
        margin-bottom: 1rem;
        padding: 1.25rem;
    }
    
    .lesson-card:hover {
        transform: translateY(-5px);
        box-shadow: 0 12px 20px -5px rgba(59, 130, 246, 0.2), 0 4px 8px -2px rgba(59, 130, 246, 0.1);
        border-color: #3B82F6;
    }
    
    .lesson-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 0.75rem;
    }
    
    .lesson-icon-container {
        display: flex;
        align-items: center;
        gap: 0.75rem;
    }
    
    .lesson-icon {
        width: 2.5rem;
        height: 2.5rem;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 0.75rem;
        background: var(--light-blue);
        flex-shrink: 0;
    }
    
    .lesson-title {
        font-size: 1.1rem;
        font-weight: 700;
        color: var(--text-blue);
        margin: 0;
        line-height: 1.3;
    }
    
    .xp-badge {
        background: var(--primary-blue);
        color: white;
        font-size: 0.7rem;
        font-weight: 600;
        padding: 0.25rem 0.5rem;
        border-radius: 9999px;
        flex-shrink: 0;
    }
    
    /* CORRE√á√ÉO: XP badge verde para pr√°tica */
    .xp-badge-pratica {
        background: var(--primary-green);
        color: white;
        font-size: 0.7rem;
        font-weight: 600;
        padding: 0.25rem 0.5rem;
        border-radius: 9999px;
        flex-shrink: 0;
    }
    
    .lesson-description {
        color: #64748B;
        font-size: 0.8rem;
        line-height: 1.4;
        margin-bottom: 1rem;
    }
    
    .lesson-footer {
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    
    .time-badge {
        display: inline-flex;
        align-items: center;
        gap: 0.25rem;
        background: rgba(16, 185, 129, 0.1);
        color: rgb(5, 150, 105);
        padding: 0.25rem 0.5rem;
        border-radius: 9999px;
        font-size: 0.7rem;
        font-weight: 600;
    }
    
    .action-btn {
        display: inline-flex;
        align-items: center;
        gap: 0.375rem;
        background: var(--primary-blue);
        color: white;
        padding: 0.375rem 0.75rem;
        border-radius: 0.5rem;
        font-size: 0.8rem;
        font-weight: 500;
        transition: all 0.3s ease;
        text-decoration: none;
    }
    
    .action-btn:hover {
        background: var(--primary-dark-blue);
        transform: translateY(-1px);
        box-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);
    }
    
    /* CORRE√á√ÉO: Bot√£o verde para pr√°tica */
    .action-btn-pratica {
        display: inline-flex;
        align-items: center;
        gap: 0.375rem;
        background: var(--primary-green);
        color: white;
        padding: 0.375rem 0.75rem;
        border-radius: 0.5rem;
        font-size: 0.8rem;
        font-weight: 500;
        transition: all 0.3s ease;
        text-decoration: none;
    }
    
    .action-btn-pratica:hover {
        background: var(--dark-green);
        transform: translateY(-1px);
        box-shadow: 0 2px 8px rgba(16, 185, 129, 0.3);
    }
    
    /* Conte√∫do escondido */
    .hidden-content {
        display: none;
    }
    
    .visible-content {
        display: block;
    }
    
    /* Anima√ß√µes de entrada para os cards */
    .lesson-card:nth-child(1) { animation-delay: 0.1s; }
    .lesson-card:nth-child(2) { animation-delay: 0.2s; }
    .lesson-card:nth-child(3) { animation-delay: 0.3s; }
    .lesson-card:nth-child(4) { animation-delay: 0.4s; }
    .lesson-card:nth-child(5) { animation-delay: 0.5s; }
    .lesson-card:nth-child(6) { animation-delay: 0.6s; }
    
    /* Bot√£o voltar - MAIS COMPACTO */
    .back-btn {
        display: inline-flex;
        align-items: center;
        gap: 0.375rem;
        background: white;
        border: 1px solid #CBD5E1;
        border-radius: 0.5rem;
        padding: 0.375rem 0.75rem;
        font-size: 0.8rem;
        color: #64748B;
        transition: all 0.3s ease;
        margin-bottom: 1rem;
        text-decoration: none;
    }
    
    .back-btn:hover {
        border-color: var(--primary-blue);
        color: var(--primary-blue);
        transform: translateY(-1px);
    }
    
    /* Responsividade melhorada */
    @media (max-width: 768px) {
        .page-header {
            padding: 1.5rem;
        }
        
        .page-title {
            font-size: 1.75rem;
        }
        
        .header-main {
            flex-direction: column;
            gap: 1rem;
        }
        
        .header-progress {
            text-align: left;
            width: 100%;
        }
        
        .progress-badge {
            width: 100%;
            text-align: center;
            margin-top: 0;
        }
        
        .stats-grid {
            grid-template-columns: 1fr;
        }
        
        .tab-container {
            flex-direction: column;
            gap: 0.5rem;
        }
        
        .lesson-header {
            flex-direction: column;
            gap: 0.5rem;
            align-items: flex-start;
        }
        
        .lesson-footer {
            flex-direction: column;
            gap: 0.75rem;
            align-items: flex-start;
        }
        
        .action-btn, .action-btn-pratica {
            width: 100%;
            justify-content: center;
        }
        
        /* CORRE√á√ÉO: Ajuste do √≠cone do foguete em mobile */
        .module-icon {
            width: 4rem;
            height: 4rem;
        }
    }
    
    @media (max-width: 640px) {
        .page-title {
            font-size: 1.5rem;
        }
        
        .page-subtitle {
            font-size: 1rem;
        }
        
        .lesson-card {
            padding: 1rem;
        }
        
        /* CORRE√á√ÉO: Ajuste adicional do √≠cone do foguete em telas pequenas */
        .module-icon {
            width: 3.5rem;
            height: 3.5rem;
        }
        
        /* CORRE√á√ÉO: Cards de estat√≠stica ainda mais compactos em mobile */
        .stats-grid {
            grid-template-columns: 1fr;
        }
        
        .stat-card {
            padding: 0.875rem;
        }
    }

/* Bot√£o voltar */
    .back-button {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        background: white;
        border: 1px solid #CBD5E1;
        border-radius: 0.75rem;
        padding: 0.75rem 1.25rem;
        font-size: 0.875rem;
        font-weight: 500;
        color: #64748B;
        transition: all 0.3s ease;
        margin-bottom: 2rem;
    }
    
    .back-button:hover {
        border-color: var(--primary-blue);
        color: var(--primary-blue);
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(59, 130, 246, 0.1);
    }

  /* ‚úÖ ESTILOS PARA ELEMENTOS BLOQUEADOS SEM VIDAS */
.btn-blocked {
    opacity: 0.5 !important;
    cursor: not-allowed !important;
    pointer-events: none !important;
}

.no-lives-badge {
    margin-left: auto;
}

/* ‚úÖ Mensagem tempor√°ria n√£o bloqueante */
.temp-message {
    animation: slideInRight 0.3s ease-out;
}

@keyframes slideInRight {
    from {
        transform: translateX(100%);
        opacity: 0;
    }
    to {
        transform: translateX(0);
        opacity: 1;
    }
}

/* ‚úÖ Tooltip informativo */
.lives-warning {
    animation: fadeIn 0.5s ease;
}

</style>
{% endblock %}

{% block content %}
<div class="space-y-6">
  <!-- BOT√ÉO VOLTAR FIXO NO TOPO - MAIS COMPACTO -->
  <a href="{% url 'modulos' %}" class="back-button">
    <img src="{% static 'imagem/arrow_back_20dp_64748B_FILL0_wght400_GRAD0_opsz20.png' %}" alt="Voltar" class="w-4 h-4">
    <span>Voltar aos Modulos</span>
</a>

  <!-- Cabe√ßalho do M√≥dulo DIN√ÇMICO - MELHOR DISTRIBUI√á√ÉO -->
  <div class="page-header">
    <div class="header-content">
      <div class="header-main">
        <div class="header-text">
          <div class="flex items-center gap-4 mb-3">
            <!-- CORRE√á√ÉO: √çcone do foguete maior -->
            <img src="{% static 'imagem/rocket_launch_100dp_FFFFFF_FILL0_wght400_GRAD0_opsz48.png' %}" alt="Python" class="module-icon floating-element">
            <div>
              <h1 class="page-title">{{ modulo.titulo }}</h1>
              <p class="page-subtitle">{{ modulo.descricao }}</p>
            </div>
          </div>
        </div>
        <div class="header-progress">
          <!-- CORRE√á√ÉO: Badge de progresso melhor centralizado verticalmente -->
          <div class="progress-badge">{{ progresso_geral }}% Conclu√≠do</div>
        </div>
      </div>
    </div>
  </div>

  <!-- CORRE√á√ÉO: Cards de progresso resumo DIN√ÇMICOS - MAIS COMPACTOS -->
  <div class="stats-grid">
    <div class="stat-card stat-card-teoria">
      <div class="stat-icon">
        <img src="{% static 'imagem/menu_book_35dp_FFFFFF_FILL0_wght400_GRAD0_opsz40.png' %}" alt="Teoria">
      </div>
      <div class="stat-number">{{ total_aulas_concluidas_teoria }}/{{ total_aulas_teoria }}</div>
      <div class="stat-label">Li√ß√µes de Teoria</div>
      <div class="stat-xp">{{ total_xp_teoria }} XP</div>
    </div>

    <div class="stat-card stat-card-pratica">
      <div class="stat-icon">
        <img src="{% static 'imagem/code_35dp_FFFFFF_FILL0_wght400_GRAD0_opsz40.png' %}" alt="Pr√°tica">
      </div>
      <div class="stat-number">{{ total_aulas_concluidas_pratica }}/{{ total_aulas_pratica }}</div>
      <div class="stat-label">Li√ß√µes Pr√°ticas</div>
      <div class="stat-xp">{{ total_xp_pratica }} XP</div>
    </div>
  </div>

  <!-- Dica de aprendizado - MAIS COMPACTA -->
  <div class="learning-tip">
    <img src="{% static 'imagem/lightbulb_2_100dp_2682EA_FILL0_wght400_GRAD0_opsz48.png' %}" alt="Dica" class="tip-icon">
    <p class="tip-text" id="texto-abas-conteudo">Aqui voc√™ encontrar√° todas as explica√ß√µes te√≥ricas necess√°rias para compreender os conceitos de Python antes de partir para a pr√°tica.</p>
  </div>

  <!-- Abas Teoria / Pr√°tica - ESTILO INVERTIDO E CORES DIFERENCIADAS -->
  <div class="tab-container">
    <!-- CORRE√á√ÉO: Abas com estilo invertido - ativa SEM fundo, inativa COM fundo -->
    <button id="tab-teoria" class="tab-btn tab-active">
      Teoria ({{ total_aulas_teoria }})
    </button>
    <button id="tab-pratica" class="tab-btn tab-pratica-inactive">
      Pr√°tica ({{ total_aulas_pratica }})
    </button>
  </div>

  <!-- Conte√∫do das Tabs DIN√ÇMICO -->
  <div id="conteudo-teoria" class="space-y-3">
    {% for aula_data in aulas_com_dados %}
      {% if aula_data.total_topicos > 0 %}
      <!-- Card de Teoria DIN√ÇMICO - MAIS COMPACTO E MELHOR DELINEADO -->
      <div class="lesson-card">
        <div class="lesson-header">
          <div class="lesson-icon-container">
            <div class="lesson-icon">
              {% if aula_data.concluida_teoria %}
                <img src="{% static 'imagem/check_small_100dp_2682EA_FILL0_wght400_GRAD0_opsz48.png' %}" alt="Conclu√≠do" class="w-5 h-5">
              {% else %}
                <img src="{% static 'imagem/hourglass_100dp_2682EA_FILL0_wght400_GRAD0_opsz48.png' %}" alt="Em progresso" class="w-5 h-5">
              {% endif %}
            </div>
            <h3 class="lesson-title">{{ aula_data.aula.titulo_teoria|default:aula_data.aula.titulo_aula }}</h3>
          </div>
          <div class="xp-badge">
            {% if aula_data.concluida_teoria %}
              +5 XP
            {% else %}
              +{{ aula_data.xp_teoria }} XP
            {% endif %}
          </div>
        </div>
        
        {% if aula_data.aula.descricao_breve %}
        <p class="lesson-description">{{ aula_data.aula.descricao_breve }}</p>
        {% else %}
        <p class="lesson-description">Aprenda os conceitos fundamentais de {{ aula_data.aula.titulo_aula }} atrav√©s de explica√ß√µes detalhadas e exemplos pr√°ticos.</p>
        {% endif %}
        
        <div class="lesson-footer">
          <div class="time-badge">
            <img src="{% static 'imagem/schedule_20dp_2682EA_FILL0_wght400_GRAD0_opsz20.png' %}" alt="Tempo">
            <span>{{ aula_data.tempo_teoria }} min</span>
          </div>
          <a href="{% url 'teoria' %}?aula_id={{ aula_data.aula.id }}">
            <button class="action-btn">
              {% if aula_data.concluida_teoria %}
                Revisar
              {% else %}
                Iniciar
              {% endif %}
              <img src="{% static 'imagem/arrow_forward_35dp_FFFFFF_FILL0_wght400_GRAD0_opsz40.png' %}" alt="Avan√ßar" class="w-3 h-3">
            </button>
          </a>
        </div>
      </div>
      {% endif %}
    {% empty %}
    <!-- Mensagem quando n√£o h√° aulas de teoria -->
    <div class="text-center py-6">
      <img src="{% static 'imagem/menu_book_100dp_2682EA_FILL0_wght400_GRAD0_opsz48.png' %}" alt="Sem teoria" class="w-12 h-12 mx-auto mb-3 opacity-50">
      <h3 class="text-base font-bold text-blue-700 mb-1">Nenhuma aula te√≥rica dispon√≠vel</h3>
      <p class="text-blue-600 text-sm">Este m√≥dulo ainda n√£o possui conte√∫do te√≥rico.</p>
    </div>
    {% endfor %}
  </div>

  <div id="conteudo-pratica" class="space-y-3 hidden-content">
    {% for aula_data in aulas_com_dados %}
      {% if aula_data.total_questoes > 0 %}
      <!-- Card de Pr√°tica DIN√ÇMICO - MAIS COMPACTO E MELHOR DELINEADO -->
      <div class="lesson-card">
        <div class="lesson-header">
          <div class="lesson-icon-container">
            <div class="lesson-icon">
              {% if aula_data.concluida_pratica %}
                <img src="{% static 'imagem/check_small_100dp_2682EA_FILL0_wght400_GRAD0_opsz48.png' %}" alt="Conclu√≠do" class="w-5 h-5">
              {% else %}
                <img src="{% static 'imagem/code_blocks_100dp_2682EA_FILL0_wght400_GRAD0_opsz48.png' %}" alt="Em progresso" class="w-5 h-5">
              {% endif %}
            </div>
            <h3 class="lesson-title">{{ aula_data.aula.titulo_pratica|default:"Exerc√≠cios Pr√°ticos" }}</h3>
          </div>
          <!-- CORRE√á√ÉO: XP badge verde para pr√°tica -->
          <div class="xp-badge-pratica">
            {% if aula_data.concluida_pratica %}
              +5 XP
            {% else %}
              +{{ aula_data.xp_pratica }} XP
            {% endif %}
          </div>
        </div>
        
        {% if aula_data.aula.conteudo_pratico %}
        <p class="lesson-description">{{ aula_data.aula.conteudo_pratico }}</p>
        {% else %}
        <p class="lesson-description">Pratique os conceitos aprendidos sobre {{ aula_data.aula.titulo_aula }} atrav√©s de exerc√≠cios e desafios pr√°ticos.</p>
        {% endif %}
        
        <div class="lesson-footer">
          <div class="time-badge">
            <img src="{% static 'imagem/schedule_20dp_2682EA_FILL0_wght400_GRAD0_opsz20.png' %}" alt="Tempo">
            <span>{{ aula_data.tempo_pratica }} min</span>
          </div>
          <a href="{% url 'pratica' %}?aula_id={{ aula_data.aula.id }}">
            <!-- CORRE√á√ÉO: Bot√£o verde para pr√°tica -->
            <button class="action-btn-pratica">
              {% if aula_data.concluida_pratica %}
                Revisar
              {% else %}
                Iniciar
              {% endif %}
              <img src="{% static 'imagem/arrow_forward_35dp_FFFFFF_FILL0_wght400_GRAD0_opsz40.png' %}" alt="Avan√ßar" class="w-3 h-3">
            </button>
          </a>
        </div>
      </div>
      {% endif %}
    {% empty %}
    <!-- Mensagem quando n√£o h√° aulas pr√°ticas -->
    <div class="text-center py-6">
      <img src="{% static 'imagem/code_100dp_2682EA_FILL0_wght400_GRAD0_opsz48.png' %}" alt="Sem pr√°tica" class="w-12 h-12 mx-auto mb-3 opacity-50">
      <h3 class="text-base font-bold text-blue-700 mb-1">Nenhuma aula pr√°tica dispon√≠vel</h3>
      <p class="text-blue-600 text-sm">Este m√≥dulo ainda n√£o possui exerc√≠cios pr√°ticos.</p>
    </div>
    {% endfor %}
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
  // Elementos das abas
  const tabTeoria = document.getElementById('tab-teoria');
  const tabPratica = document.getElementById('tab-pratica');
  const conteudoTeoria = document.getElementById('conteudo-teoria');
  const conteudoPratica = document.getElementById('conteudo-pratica');
  const textoAbas = document.getElementById('texto-abas-conteudo');

  // ‚úÖ DADOS DO USU√ÅRIO DO CONTEXTO
  const userLives = {{ vidas_restantes }};
  const maxLives = {{ max_vidas }};
  const podeFazerPratica = {{ pode_fazer_pratica|yesno:"true,false" }};
  const tempoProximaVida = {{ tempo_proxima_vida }};

  console.log(`üíì Status Vidas: ${userLives}/${maxLives}`);
  console.log(`üîì Pode fazer pr√°tica: ${podeFazerPratica}`);
  console.log(`‚è∞ Pr√≥xima vida em: ${tempoProximaVida} min`);

// ‚úÖ FUN√á√ÉO PARA BLOQUEAR ATIVIDADES PR√ÅTICAS SE SEM VIDAS
function checkAndBlockPracticeActivities() {
  if (!podeFazerPratica) {
    console.log("üö´ Usu√°rio sem vidas - bloqueando atividades pr√°ticas");
    
    // Bloquear todos os bot√µes de pr√°tica
    const practiceButtons = document.querySelectorAll('.action-btn-pratica');
    practiceButtons.forEach(button => {
      button.disabled = true;
      button.style.opacity = '0.5';
      button.style.cursor = 'not-allowed';
      button.style.background = '#9CA3AF'; // Cinza
      button.style.border = '1px solid #6B7280';
      
      // Alterar texto do bot√£o
      const buttonText = button.querySelector('span') || button;
      if (buttonText.textContent.includes('Iniciar') || buttonText.textContent.includes('Revisar')) {
        buttonText.innerHTML = `Sem Vidas <img src="{% static 'imagem/block_20dp_FFFFFF_FILL0_wght400_GRAD0_opsz20.png' %}" alt="Bloqueado" class="w-3 h-3">`;
      }
    });

    // ‚úÖ ESCONDER O XP DAS ATIVIDADES PR√ÅTICAS
    const practiceCards = document.querySelectorAll('#conteudo-pratica .lesson-card');
    practiceCards.forEach(card => {
      // Esconder o badge de XP
      const xpBadge = card.querySelector('.xp-badge-pratica');
      if (xpBadge) {
        xpBadge.style.display = 'none';
      }
      
      // Adicionar badge de sem vidas no lugar do XP (apenas se n√£o existir)
      if (!card.querySelector('.no-lives-badge')) {
        const header = card.querySelector('.lesson-header');
        if (header) {
          const badge = document.createElement('div');
          badge.className = 'no-lives-badge';
          badge.innerHTML = `
            <div style="display: inline-flex; align-items: center; gap: 0.25rem; background: #FEF2F2; color: #DC2626; padding: 0.25rem 0.5rem; border-radius: 9999px; font-size: 0.7rem; font-weight: 600; border: 1px solid #FECACA;">
              <img src="{% static 'imagem/block_20dp_DC2626_FILL0_wght400_GRAD0_opsz20.png' %}" alt="Sem vidas" class="w-3 h-3">
              <span>Sem Vidas</span>
            </div>
          `;
          header.appendChild(badge);
        }
      }
    });

    // Adicionar tooltip informativo (SEM FUNDO VERMELHO)
    const practiceSection = document.getElementById('conteudo-pratica');
    if (practiceSection && !practiceSection.querySelector('.lives-warning')) {
      const warning = document.createElement('div');
      warning.className = 'lives-warning';
      warning.innerHTML = `
        <div style="background: #FEF2F2; border: 1px solid #FECACA; border-radius: 0.75rem; padding: 1rem; margin-bottom: 1rem;">
          <div style="display: flex; align-items: center; gap: 0.75rem; margin-bottom: 0.5rem;">
            <img src="{% static 'imagem/block_20dp_DC2626_FILL0_wght400_GRAD0_opsz20.png' %}" alt="Aten√ß√£o" class="w-5 h-5">
            <p style="color: #DC2626; font-weight: 600; margin: 0; font-size: 0.9rem;">Sem vidas dispon√≠veis</p>
          </div>
          <p style="color: #7F1D1D; margin: 0; font-size: 0.8rem; line-height: 1.4;">
            Aguarde a regenera√ß√£o das vidas (${tempoProximaVida} minuto${tempoProximaVida !== 1 ? 's' : ''}) para continuar com as atividades pr√°ticas.
            <br>Enquanto isso, voc√™ pode revisar a teoria ou voltar mais tarde.
          </p>
        </div>
      `;
      practiceSection.insertBefore(warning, practiceSection.firstChild);
    }

    return true; // Est√° bloqueado
  } else {
    // ‚úÖ SE TEM VIDAS, GARANTIR QUE O XP EST√Å VIS√çVEL
    const practiceCards = document.querySelectorAll('#conteudo-pratica .lesson-card');
    practiceCards.forEach(card => {
      const xpBadge = card.querySelector('.xp-badge-pratica');
      if (xpBadge) {
        xpBadge.style.display = 'flex'; // Ou 'block' dependendo do estilo original
      }
      
      // Remover badge de sem vidas se existir
      const noLivesBadge = card.querySelector('.no-lives-badge');
      if (noLivesBadge) {
        noLivesBadge.remove();
      }
    });
    
    // Remover warning se existir
    const warning = document.querySelector('.lives-warning');
    if (warning) {
      warning.remove();
    }
    
    return false; // N√£o est√° bloqueado
  }
}

  // ‚úÖ FUN√á√ÉO PARA VERIFICAR E ATUALIZAR ESTADO DAS AULAS PR√ÅTICAS
  function updatePracticeButtonsState() {
    const isBlocked = checkAndBlockPracticeActivities();
    
    if (isBlocked) {
      // Se estiver bloqueado, adicionar listener para mostrar mensagem ao clicar
      const practiceButtons = document.querySelectorAll('.action-btn-pratica');
      practiceButtons.forEach(button => {
        button.onclick = function(e) {
          e.preventDefault();
          showTemporaryMessage(`Voc√™ n√£o tem vidas dispon√≠veis. Pr√≥xima vida em ${tempoProximaVida} minuto${tempoProximaVida !== 1 ? 's' : ''}.`, 'error');
        };
      });

      // Tamb√©m bloquear links
      const practiceLinks = document.querySelectorAll('a[href*="pratica"]');
      practiceLinks.forEach(link => {
        link.onclick = function(e) {
          if (!podeFazerPratica) {
            e.preventDefault();
            showTemporaryMessage(`Voc√™ n√£o tem vidas dispon√≠veis. Pr√≥xima vida em ${tempoProximaVida} minuto${tempoProximaVida !== 1 ? 's' : ''}.`, 'error');
            return false;
          }
        };
      });
    } else {
      // Se n√£o est√° bloqueado, garantir que os links funcionam normalmente
      const practiceLinks = document.querySelectorAll('a[href*="pratica"]');
      practiceLinks.forEach(link => {
        link.onclick = null; // Remover qualquer bloqueio anterior
      });
    }
  }

  // ‚úÖ FUN√á√ÉO PARA MOSTRAR MENSAGEM TEMPOR√ÅRIA (N√ÉO BLOQUEANTE)
  function showTemporaryMessage(message, type = 'info') {
    // Remover mensagem anterior se existir
    const existingMessage = document.querySelector('.temp-message');
    if (existingMessage) {
      existingMessage.remove();
    }

    const messageDiv = document.createElement('div');
    messageDiv.className = `temp-message fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg ${
      type === 'error' ? 'bg-red-500 text-white' : 'bg-blue-500 text-white'
    }`;
    messageDiv.style.maxWidth = '400px';
    messageDiv.innerHTML = `
      <div class="flex items-center gap-2">
        <img src="{% static 'imagem/block_20dp_FFFFFF_FILL0_wght400_GRAD0_opsz20.png' %}" alt="Aten√ß√£o" class="w-5 h-5">
        <span class="text-sm">${message}</span>
      </div>
    `;

    document.body.appendChild(messageDiv);

    // Remover ap√≥s 4 segundos
    setTimeout(() => {
      if (messageDiv.parentNode) {
        messageDiv.remove();
      }
    }, 4000);
  }

  // ‚úÖ FUN√á√ÉO PARA ATUALIZAR TEXTO DA DICA BASEADO NAS VIDAS
  function updateTipText() {
    if (!podeFazerPratica) {
      textoAbas.textContent = `Voc√™ est√° sem vidas para atividades pr√°ticas. Aguarde ${tempoProximaVida} minuto${tempoProximaVida !== 1 ? 's' : ''} para a pr√≥xima vida ou revise a teoria.`;
    }
  }

  // Fun√ß√£o para alternar entre abas
  function alternarAba(abaAtiva, abaInativa, conteudoAtivo, conteudoInativo, texto, isPratica) {
    // Resetar todas as abas
    if (isPratica) {
      // Se estamos ativando a pr√°tica
      tabTeoria.classList.remove('tab-active');
      tabTeoria.classList.add('tab-inactive');
      tabPratica.classList.remove('tab-pratica-inactive');
      tabPratica.classList.add('tab-pratica-active');
      
      // ‚úÖ ATUALIZAR TEXTO SE ESTIVER SEM VIDAS
      if (!podeFazerPratica) {
        textoAbas.textContent = `Voc√™ est√° sem vidas para atividades pr√°ticas. Aguarde ${tempoProximaVida} minuto${tempoProximaVida !== 1 ? 's' : ''} para a pr√≥xima vida.`;
      } else {
        textoAbas.textContent = texto;
      }
    } else {
      // Se estamos ativando a teoria
      tabTeoria.classList.remove('tab-inactive');
      tabTeoria.classList.add('tab-active');
      tabPratica.classList.remove('tab-pratica-active');
      tabPratica.classList.add('tab-pratica-inactive');
      textoAbas.textContent = texto;
    }
    
    // Esconder todos os conte√∫dos
    conteudoTeoria.classList.remove('visible-content');
    conteudoTeoria.classList.add('hidden-content');
    conteudoPratica.classList.remove('visible-content');
    conteudoPratica.classList.add('hidden-content');
    
    // Ativar conte√∫do selecionado
    conteudoAtivo.classList.remove('hidden-content');
    conteudoAtivo.classList.add('visible-content');
    
    // ‚úÖ ATUALIZAR ESTADO DOS BOT√ïES QUANDO MUDAR DE ABA
    if (isPratica) {
      setTimeout(updatePracticeButtonsState, 100);
    }
  }

  // Event listeners para as abas
  tabTeoria.addEventListener('click', function() {
    alternarAba(
      tabTeoria, 
      tabPratica,
      conteudoTeoria, 
      conteudoPratica,
      "Aqui voc√™ encontrar√° todas as explica√ß√µes te√≥ricas necess√°rias para compreender os conceitos de Python antes de partir para a pr√°tica.",
      false
    );
  });

  tabPratica.addEventListener('click', function() {
    alternarAba(
      tabPratica,
      tabTeoria,
      conteudoPratica, 
      conteudoTeoria,
      "Aqui voc√™ poder√° praticar os conceitos aprendidos na teoria, resolvendo exerc√≠cios, desafios e projetos pr√°ticos.",
      true
    );
  });

  // ‚úÖ INICIALIZAR: Verificar e bloquear atividades pr√°ticas se necess√°rio
  updatePracticeButtonsState();
  updateTipText();

  // ‚úÖ VERIFICAR SE H√Å AULAS PR√ÅTICAS AO CARREGAR A P√ÅGINA
  // Se a aba de pr√°tica estiver ativa por padr√£o, garantir que os bot√µes est√£o bloqueados
  setTimeout(() => {
    const praticaContent = document.getElementById('conteudo-pratica');
    if (praticaContent && !praticaContent.classList.contains('hidden-content')) {
      updatePracticeButtonsState();
    }
  }, 500);

  // Marcar o item de conte√∫do como ativo na sidebar
  const conteudoLink = document.getElementById('nav-conteudo');
  if (conteudoLink) {
    conteudoLink.classList.add('bg-blue-500', 'text-white');
    
    const conteudoIcon = conteudoLink.querySelector('.nav-icon');
    if (conteudoIcon) {
      const whiteIcon = conteudoIcon.getAttribute('data-white');
      if (whiteIcon) {
        conteudoIcon.src = whiteIcon;
      }
    }
  }

  // ‚úÖ BOT√ÉO PARA VERIFICAR STATUS DE VIDAS (para debug)
  console.log("‚úÖ Sistema de vidas inicializado na p√°gina de tarefas");
});
</script>
{% endblock %}