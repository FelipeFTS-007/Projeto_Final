{% extends "base.html" %}
{% load static %}

{% block title %}Tarefas - {{ modulo.titulo }}{% endblock %}

{% block extra_css %}
<style>
    .card-hover {
      transition: all 0.3s ease;
    }
    
    .card-hover:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px -5px rgba(59, 130, 246, 0.4);
    }
    
    .module-card {
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }
    
    .module-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 10px 25px -5px rgba(59, 130, 246, 0.4);
    }
    
    .module-card::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 4px;
      background: linear-gradient(90deg, #3B82F6 0%, #1E40AF 100%);
    }
    
    .floating-element {
      animation: float 6s ease-in-out infinite;
    }
    
    @keyframes float {
      0% { transform: translateY(0px); }
      50% { transform: translateY(-10px); }
      100% { transform: translateY(0px); }
    }
    
    .shine-effect {
      position: relative;
      overflow: hidden;
    }
    
    .shine-effect::before {
      content: '';
      position: absolute;
      top: 0;
      left: -75%;
      width: 50%;
      height: 100%;
      background: linear-gradient(120deg, rgba(255,255,255,0) 0%, rgba(255,255,255,0.4) 50%, rgba(255,255,255,0) 100%);
      transform: skewX(-25deg);
      pointer-events: none;
    }
    
    .shine-effect:hover::before {
      animation: shine 1s forwards;
    }
    
    @keyframes shine {
      0% { left: -75%; }
      100% { left: 125%; }
    }
    
    .tab-active {
      background: linear-gradient(135deg, #3B82F6 0%, #1E40AF 100%);
      color: white;
    }
    
    .tab-inactive {
      background-color: #EFF6FF;
      color: #3B82F6;
    }
    
    .tab-inactive:hover {
      background-color: #DBEAFE;
    }

    /* Estilo para conteúdo escondido */
    .hidden-content {
      display: none;
    }

    .visible-content {
      display: block;
    }
</style>
{% endblock %}

{% block content %}
<div class="space-y-6">
  <!-- BOTÃO VOLTAR FIXO NO TOPO -->
  <div class="mb-4">
    <a href="{% url 'modulos' %}?capitulo={{ modulo.capitulo.id }}" class="text-blue-600 font-semibold hover:text-blue-800 flex items-center gap-2 transition-colors">
      <img src="{% static 'imagem/arrow_back_35dp_2682EA_FILL0_wght400_GRAD0_opsz40.png' %}" alt="Voltar" class="w-5 h-5">
      <span class="text-sm">Voltar aos módulos</span>
    </a>
  </div>

  <!-- Cabeçalho do Módulo DINÂMICO -->
  <div class="bg-gradient-to-r from-blue-600 to-blue-800 text-white p-6 rounded-2xl flex flex-col md:flex-row justify-between items-center relative overflow-hidden">
    <div class="flex items-center gap-6 z-10">
      <img src="{% static 'imagem/rocket_launch_100dp_FFFFFF_FILL0_wght400_GRAD0_opsz48.png' %}" alt="Python" class="w-16 h-16 floating-element">
      <div>
        <h2 class="text-2xl font-bold">{{ modulo.titulo }}</h2>
        <p class="text-blue-100">{{ modulo.descricao }}</p>
      </div>
    </div>
    <div class="text-right font-bold text-lg z-10 mt-4 md:mt-0">{{ progresso_geral }}% Concluído</div>
    
    <!-- Elementos decorativos de fundo -->
    <div class="absolute top-0 left-0 w-full h-full overflow-hidden opacity-10">
      <div class="absolute -top-4 -left-4 w-24 h-24 rounded-full bg-white"></div>
      <div class="absolute top-10 right-20 w-16 h-16 rounded-full bg-white"></div>
      <div class="absolute bottom-5 left-20 w-12 h-12 rounded-full bg-white"></div>
    </div>
  </div>

  <!-- Cards de progresso resumo DINÂMICOS -->
  <div class="grid md:grid-cols-2 gap-4">
    <div class="bg-white border border-blue-200 rounded-xl p-4 shadow-md card-hover">
      <div class="flex justify-between items-center mb-2">
        <div class="flex items-center gap-2">
          <div class="bg-blue-600 p-2 rounded-lg">
            <img src="{% static 'imagem/menu_book_35dp_FFFFFF_FILL0_wght400_GRAD0_opsz40.png' %}" alt="Teoria" class="w-5 h-5">
          </div>
          <span class="font-semibold text-blue-800">Teoria</span>
        </div>
        <span class="text-blue-600 font-bold">{{ total_aulas_concluidas_teoria }}/{{ total_aulas_teoria }} Lições</span>
      </div>
      <div class="w-full h-2 bg-blue-200 rounded-full">
        <div class="h-2 bg-blue-600 rounded-full" style="width: {{ progresso_teoria }}%"></div>
      </div>
      <div class="text-xs text-blue-600 mt-1">{{ total_xp_teoria }} XP Total</div>
    </div>

    <div class="bg-white border-blue-200 rounded-xl p-4 shadow-md card-hover">
      <div class="flex justify-between items-center mb-2">
        <div class="flex items-center gap-2">
          <div class="bg-blue-600 p-2 rounded-lg">
            <img src="{% static 'imagem/code_35dp_FFFFFF_FILL0_wght400_GRAD0_opsz40.png' %}" alt="Prática" class="w-5 h-5">
          </div>
          <span class="font-semibold text-blue-800">Prática</span>
        </div>
        <span class="text-blue-600 font-bold">{{ total_aulas_concluidas_pratica }}/{{ total_aulas_pratica }} Lições</span>
      </div>
      <div class="w-full h-2 bg-blue-200 rounded-full">
        <div class="h-2 bg-blue-600 rounded-full" style="width: {{ progresso_pratica }}%"></div>
      </div>
      <div class="text-xs text-blue-600 mt-1">{{ total_xp_pratica }} XP Total</div>
    </div>
  </div>

  <!-- Abas Teoria / Prática -->
  <div class="flex border-b border-blue-200 mt-4">
    <button id="tab-teoria" class="flex-1 py-3 font-semibold tab-active rounded-t-xl transition-colors">
      Teoria ({{ total_aulas_teoria }})
    </button>
    <button id="tab-pratica" class="flex-1 py-3 font-semibold tab-inactive rounded-t-xl transition-colors">
      Prática ({{ total_aulas_pratica }})
    </button>
  </div>

  <!-- Texto dinâmico após as abas -->
  <div class="bg-gradient-to-r from-blue-50 to-blue-100 border-l-4 border-blue-500 text-blue-700 text-sm rounded-r-xl p-4 mb-6 shadow flex items-center gap-3">
    <img src="{% static 'imagem/lightbulb_2_100dp_2682EA_FILL0_wght400_GRAD0_opsz48.png' %}" alt="Ícone" class="w-6 h-6">
    <span id="texto-abas-conteudo">Aqui você encontrará todas as explicações teóricas necessárias para compreender os conceitos de Python antes de partir para a prática.</span>
  </div>

  <!-- Conteúdo das Tabs DINÂMICO -->
  <div id="conteudo-teoria" class="space-y-4 mt-4">
    {% for aula_data in aulas_com_dados %}
      {% if aula_data.total_topicos > 0 %}
      <!-- Card de Teoria DINÂMICO -->
      <div class="module-card bg-gradient-to-b from-white to-blue-50 border border-blue-200 rounded-xl p-5 shadow-md">
        <div class="flex justify-between items-start mb-3">
          <div class="flex items-center gap-3">
            <div class="bg-blue-100 p-2 rounded-lg">
              {% if aula_data.concluida_teoria %}
              <img src="{% static 'imagem/check_small_100dp_2682EA_FILL0_wght400_GRAD0_opsz48.png' %}" alt="Concluído" class="w-6 h-6">
              {% else %}
              <img src="{% static 'imagem/hourglass_100dp_2682EA_FILL0_wght400_GRAD0_opsz48.png' %}" alt="Em progresso" class="w-6 h-6">
              {% endif %}
            </div>
            <h3 class="font-semibold text-blue-800">{{ aula_data.aula.titulo_teoria|default:aula_data.aula.titulo_aula }}</h3>
          </div>
          <div class="bg-blue-600 text-white text-xs font-bold px-2 py-1 rounded-full">+{{ aula_data.xp_teoria }} XP</div>
        </div>
        
        {% if aula_data.aula.descricao_breve %}
        <p class="text-blue-600 text-sm mb-4">{{ aula_data.aula.descricao_breve }}</p>
        {% else %}
        <p class="text-blue-600 text-sm mb-4">Aprenda os conceitos fundamentais de {{ aula_data.aula.titulo_aula }} através de explicações detalhadas e exemplos práticos.</p>
        {% endif %}
        
        <div class="flex justify-between items-center">
          <span class="text-blue-500 text-xs">{{ aula_data.tempo_teoria }} min</span>
          <a href="{% url 'teoria' %}?aula_id={{ aula_data.aula.id }}">
            <button class="px-4 py-2 bg-blue-600 text-white rounded-lg text-sm hover:bg-blue-700 transition-colors">
              {% if aula_data.concluida_teoria %}Revisar{% else %}Iniciar{% endif %}
            </button>
          </a>
        </div>
      </div>
      {% endif %}
    {% empty %}
    <!-- Mensagem quando não há aulas de teoria -->
    <div class="text-center py-8">
      <img src="{% static 'imagem/menu_book_100dp_2682EA_FILL0_wght400_GRAD0_opsz48.png' %}" alt="Sem teoria" class="w-16 h-16 mx-auto mb-4 opacity-50">
      <h3 class="text-lg font-bold text-blue-700 mb-2">Nenhuma aula teórica disponível</h3>
      <p class="text-blue-600">Este módulo ainda não possui conteúdo teórico.</p>
    </div>
    {% endfor %}
  </div>

  <div id="conteudo-pratica" class="space-y-4 mt-4 hidden-content">
    {% for aula_data in aulas_com_dados %}
      {% if aula_data.total_questoes > 0 %}
      <!-- Card de Prática DINÂMICO -->
      <div class="module-card bg-gradient-to-b from-white to-blue-50 border border-blue-200 rounded-xl p-5 shadow-md">
        <div class="flex justify-between items-start mb-3">
          <div class="flex items-center gap-3">
            <div class="bg-blue-100 p-2 rounded-lg">
              {% if aula_data.concluida_pratica %}
              <img src="{% static 'imagem/check_small_100dp_2682EA_FILL0_wght400_GRAD0_opsz48.png' %}" alt="Concluído" class="w-6 h-6">
              {% else %}
              <img src="{% static 'imagem/code_blocks_100dp_2682EA_FILL0_wght400_GRAD0_opsz48.png' %}" alt="Em progresso" class="w-6 h-6">
              {% endif %}
            </div>
            <h3 class="font-semibold text-blue-800">{{ aula_data.aula.titulo_pratica|default:"Exercícios Práticos" }}</h3>
          </div>
          <div class="bg-blue-600 text-white text-xs font-bold px-2 py-1 rounded-full">+{{ aula_data.xp_pratica }} XP</div>
        </div>
        
        {% if aula_data.aula.conteudo_pratico %}
        <p class="text-blue-600 text-sm mb-4">{{ aula_data.aula.conteudo_pratico }}</p>
        {% else %}
        <p class="text-blue-600 text-sm mb-4">Pratique os conceitos aprendidos sobre {{ aula_data.aula.titulo_aula }} através de exercícios e desafios práticos.</p>
        {% endif %}
        
        <div class="flex justify-between items-center">
          <span class="text-blue-500 text-xs">{{ aula_data.tempo_pratica }} min</span>
          <a href="{% url 'pratica' %}?aula_id={{ aula_data.aula.id }}">
            <button class="px-4 py-2 bg-blue-600 text-white rounded-lg text-sm hover:bg-blue-700 transition-colors">
              {% if aula_data.concluida_pratica %}Revisar{% else %}Iniciar{% endif %}
            </button>
          </a>
        </div>
      </div>
      {% endif %}
    {% empty %}
    <!-- Mensagem quando não há aulas práticas -->
    <div class="text-center py-8">
      <img src="{% static 'imagem/code_100dp_2682EA_FILL0_wght400_GRAD0_opsz48.png' %}" alt="Sem prática" class="w-16 h-16 mx-auto mb-4 opacity-50">
      <h3 class="text-lg font-bold text-blue-700 mb-2">Nenhuma aula prática disponível</h3>
      <p class="text-blue-600">Este módulo ainda não possui exercícios práticos.</p>
    </div>
    {% endfor %}
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
  // Elementos das abas
  const tabTeoria = document.getElementById('tab-teoria');
  const tabPratica = document.getElementById('tab-pratica');
  const conteudoTeoria = document.getElementById('conteudo-teoria');
  const conteudoPratica = document.getElementById('conteudo-pratica');
  const textoAbas = document.getElementById('texto-abas-conteudo');

  // Função para alternar entre abas
  function alternarAba(abaAtiva, conteudoAtivo, texto) {
    // Resetar todas as abas
    tabTeoria.classList.remove('tab-active');
    tabTeoria.classList.add('tab-inactive');
    tabPratica.classList.remove('tab-active');
    tabPratica.classList.add('tab-inactive');
    
    // Esconder todos os conteúdos
    conteudoTeoria.classList.remove('visible-content');
    conteudoTeoria.classList.add('hidden-content');
    conteudoPratica.classList.remove('visible-content');
    conteudoPratica.classList.add('hidden-content');
    
    // Ativar aba e conteúdo selecionado
    abaAtiva.classList.remove('tab-inactive');
    abaAtiva.classList.add('tab-active');
    conteudoAtivo.classList.remove('hidden-content');
    conteudoAtivo.classList.add('visible-content');
    
    // Atualizar texto
    textoAbas.textContent = texto;
  }

  // Event listeners para as abas
  tabTeoria.addEventListener('click', function() {
    alternarAba(
      tabTeoria, 
      conteudoTeoria, 
      "Aqui você encontrará todas as explicações teóricas necessárias para compreender os conceitos de Python antes de partir para a prática."
    );
  });

  tabPratica.addEventListener('click', function() {
    alternarAba(
      tabPratica, 
      conteudoPratica, 
      "Aqui você poderá praticar os conceitos aprendidos na teoria, resolvendo exercícios, desafios e projetos práticos."
    );
  });

  // Marcar o item de conteúdo como ativo na sidebar
  const conteudoLink = document.getElementById('nav-conteudo');
  if (conteudoLink) {
    conteudoLink.classList.add('bg-blue-500', 'text-white');
    
    const conteudoIcon = conteudoLink.querySelector('.nav-icon');
    if (conteudoIcon) {
      const whiteIcon = conteudoIcon.getAttribute('data-white');
      if (whiteIcon) {
        conteudoIcon.src = whiteIcon;
      }
    }
  }
});
</script>
{% endblock %}