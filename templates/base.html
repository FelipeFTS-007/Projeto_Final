{% load static %}
<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
  <title>PyQuest - {% block title %}{% endblock %}</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    /* Anima√ß√µes personalizadas */
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    @keyframes slideIn {
      from { transform: translateY(-10px); opacity: 0; }
      to { transform: translateY(0); opacity: 1; }
    }
    
    @keyframes pulse {
      0% { transform: scale(1); }
      50% { transform: scale(1.05); }
      100% { transform: scale(1); }
    }
    
    .animate-fadeIn {
      animation: fadeIn 0.3s ease-out;
    }
    
    .animate-slideIn {
      animation: slideIn 0.3s ease-out;
    }
    
    .animate-pulse {
      animation: pulse 0.5s ease-in-out;
    }
    
    /* Estiliza√ß√£o da barra de rolagem */
    .custom-scrollbar::-webkit-scrollbar {
      width: 6px;
    }
    
    .custom-scrollbar::-webkit-scrollbar-track {
      background: #f1f1f1;
      border-radius: 10px;
    }
    
    .custom-scrollbar::-webkit-scrollbar-thumb {
      background: #888;
      border-radius: 10px;
    }
    
    .custom-scrollbar::-webkit-scrollbar-thumb:hover {
      background: #555;
    }

    /* LAYOUT FIXO CORRIGIDO */
    .layout-container {
        display: flex;
        flex-direction: column;
        height: 100vh;
        overflow: hidden;
    }

    .header-container {
        flex-shrink: 0;
        margin: 1rem 1.5rem 0.5rem 1.5rem;
    }

    .main-container {
        display: flex;
        flex: 1;
        gap: 0.3rem;
        margin: 0 1.5rem 1.5rem 1.5rem;
        overflow: hidden;
    }

    .sidebar-fixed {
        width: 14rem;
        flex-shrink: 0;
        overflow-y: auto;
        background: white;
        border-radius: 1rem;
        margin-top: 0.5rem;
    }

    .content-fixed {
        flex: 1;
        border-radius: 1rem;
        background: white;
        margin-left: 1rem;
        margin-top: 0.5rem;
        overflow-y: auto;
    }

    .content-fixed::-webkit-scrollbar {
        display: none;
    }

    .content-fixed {
        -ms-overflow-style: none;
        scrollbar-width: none;
    }

    /* Garantir que o conte√∫do n√£o fique atr√°s */
    .content-wrapper {
        padding: 1rem;
        min-height: 100%;
        overflow-y: auto;
    }

    /* Efeitos do fogo */
    .fire-glow {
        filter: drop-shadow(0 0 6px rgba(255, 107, 0, 0.7));
    }
    
    .fire-transition {
        transition: all 0.5s ease-in-out;
    }

    /* Estilos para os itens de navega√ß√£o */
    .nav-btn {
        transition: all 0.3s ease;
    }

    .nav-btn:hover {
        transform: scale(1.05);
    }

    /* Anima√ß√µes do cora√ß√£o */
    .heart-pulse {
        animation: heartBeat 0.6s ease-in-out;
    }

    @keyframes heartBeat {
        0% { transform: scale(1); }
        25% { transform: scale(1.1); }
        50% { transform: scale(0.9); }
        75% { transform: scale(1.05); }
        100% { transform: scale(1); }
    }

    /* Efeito do trof√©u */
    .trophy-glow {
        filter: drop-shadow(0 0 4px rgba(255, 193, 7, 0.6));
    }
  </style>
  {% block extra_css %}{% endblock %}



</head>

<body class="bg-blue-200">

<div class="layout-container">
    <!-- HEADER -->
    <header class="header-container flex justify-between items-center bg-white px-6 py-2 rounded-xl">
        <!-- Logo -->
        <div class="flex items-center gap-2">
            <img src="{% static 'imagem/Python Sword & Coin Emblem.png' %}" 
                 alt="Logo PyQuest"
                 class="w-12 h-12 transform -rotate-90 scale-x-[-1]">
            <h1 class="font-bold text-2xl text-blue-600">PyQuest</h1>
        </div>

        <!-- Caixinhas -->
        <div class="flex gap-8 items-center text-lg">
            <!-- Vidas - Cora√ß√£o Vermelho -->
            <div class="bg-blue-200 px-3 py-1.5 rounded-xl text-blue-500 font-bold flex items-center">
                <i id="heart-icon" class="fas fa-heart text-red-500 text-lg mr-1.5"></i>
                <h2 id="vidas-count">{{ perfil.vidas }}</h2>
            </div>
            
            <!-- XP - Trof√©u Amarelo -->
            <div class="bg-blue-200 px-3 py-1.5 rounded-xl text-blue-500 font-bold flex items-center">
                <i id="xp-icon" class="fas fa-trophy text-yellow-500 text-lg mr-1.5 trophy-glow"></i>
                <h2 id="xp-count">{{ perfil.xp }} XP</h2>
            </div>
            
            <!-- Sequ√™ncia - Fogo Laranja -->
            <div class="bg-blue-200 px-3 py-1.5 rounded-xl text-blue-500 font-bold flex items-center">
                <i id="sequencia-fire" 
                  class="fas fa-fire text-xl mr-1.5 transition-all duration-300 {% if perfil.ja_fez_atividade_hoje %}text-orange-500 fire-glow{% else %}text-gray-400{% endif %}"></i>
                <h2 id="sequencia-days">{{ perfil.sequencia }} dias</h2>
            </div>
        </div>

        <!-- Solu√ß√£o sem Django templates - mais segura -->
        <script>
          window.perfilData = {
              streak: parseInt('{{ perfil.sequencia|default:0 }}'),
              jaFezAtividadeHoje: '{{ perfil.ja_fez_atividade_hoje|yesno:"true,false" }}' === 'true',
              vidas: parseInt('{{ perfil.vidas|default:3 }}'),
              nivel: parseInt('{{ perfil.nivel|default:1 }}')
          };
          console.log('üìä Dados carregados:', window.perfilData);
        </script>

        <!-- √çcones + Perfil -->
        <div class="flex items-center gap-6 text-blue-600 font-semibold">
            

            <!-- Perfil -->
            <div class="flex items-center gap-2 ml-5 mr-3">
                <img id="avatar-display" src="{{ perfil.avatar.url }}" 
                     alt="Perfil" class="w-8 h-8 rounded-full border-1">
                <div class="flex flex-col">
                    <span class="text-lg font-bold">{{ request.user.username }}</span>
                    <span class="text-xs">N√≠vel {{ perfil.nivel }}</span>
                </div>
            </div>
        </div>
    </header>

    <!-- MAIN CONTENT -->
    <div class="main-container">
        <!-- SIDEBAR FIXA -->
        <nav class="sidebar-fixed p-4 flex flex-col custom-scrollbar">
            <div class="flex-1">
                <!-- Home -->
                <a href="{% url 'home' %}" 
                   class="nav-btn flex items-center gap-3 px-4 py-3 rounded-xl font-medium border-2 border-transparent hover:border-blue-400 transition {% if request.resolver_match.url_name == 'home' %}bg-blue-500 text-white{% endif %}"
                   id="nav-home">
                    <img 
                      src="{% if request.resolver_match.url_name == 'home' %}{% static 'imagem/home_100dp_FFFFFF_FILL0_wght400_GRAD0_opsz48.png' %}{% else %}{% static 'imagem/home_100dp_000000_FILL0_wght400_GRAD0_opsz48.png' %}{% endif %}"
                      data-black="{% static 'imagem/home_100dp_000000_FILL0_wght400_GRAD0_opsz48.png' %}"
                      data-white="{% static 'imagem/home_100dp_FFFFFF_FILL0_wght400_GRAD0_opsz48.png' %}"
                      alt="Home" class="w-6 h-6 nav-icon">
                    <span>Home</span>
                </a>

                <!-- Conte√∫do -->
                <a href="{% url 'conteudo' %}" 
                   class="nav-btn flex items-center gap-3 px-4 py-3 rounded-xl font-medium border-2 border-transparent hover:border-blue-400 transition {% if request.resolver_match.url_name == 'conteudo' %}bg-blue-500 text-white{% endif %}"
                   id="nav-conteudo">
                    <img 
                      src="{% if request.resolver_match.url_name == 'conteudo' %}{% static 'imagem/book_ribbon_100dp_FFFFFF_FILL0_wght400_GRAD0_opsz48.png' %}{% else %}{% static 'imagem/book_ribbon_100dp_000000_FILL0_wght400_GRAD0_opsz48.png' %}{% endif %}" 
                      data-black="{% static 'imagem/book_ribbon_100dp_000000_FILL0_wght400_GRAD0_opsz48.png' %}"
                      data-white="{% static 'imagem/book_ribbon_100dp_FFFFFF_FILL0_wght400_GRAD0_opsz48.png' %}"
                      alt="Conte√∫do" class="w-6 h-6 nav-icon">
                    <span>Conte√∫do</span>
                </a>

                <!-- Dashboard -->
                <a href="{% url 'dashboard' %}" 
                   class="nav-btn flex items-center gap-3 px-4 py-3 rounded-xl font-medium border-2 border-transparent hover:border-blue-400 transition {% if request.resolver_match.url_name == 'dashboard' %}bg-blue-500 text-white{% endif %}"
                   id="nav-dashboard">
                    <img 
                      src="{% if request.resolver_match.url_name == 'dashboard' %}{% static 'imagem/analytics_100dp_FFFFFF_FILL0_wght400_GRAD0_opsz48.png' %}{% else %}{% static 'imagem/analytics_100dp_000000_FILL0_wght400_GRAD0_opsz48.png' %}{% endif %}" 
                      data-white="{% static 'imagem/analytics_100dp_FFFFFF_FILL0_wght400_GRAD0_opsz48.png' %}"
                      data-black="{% static 'imagem/analytics_100dp_000000_FILL0_wght400_GRAD0_opsz48.png' %}"
                      alt="Dashboard" class="w-6 h-6 nav-icon">
                    <span>Dashboard</span>
                </a>

                <!-- Ranking -->
                <a href="{% url 'ranking' %}" 
                   class="nav-btn flex items-center gap-3 px-4 py-3 rounded-xl font-medium border-2 border-transparent hover:border-blue-400 transition {% if request.resolver_match.url_name == 'ranking' %}bg-blue-500 text-white{% endif %}"
                   id="nav-ranking">
                    <img 
                      src="{% if request.resolver_match.url_name == 'ranking' %}{% static 'imagem/social_leaderboard_100dp_FFFFFF_FILL0_wght400_GRAD0_opsz48.png' %}{% else %}{% static 'imagem/social_leaderboard_100dp_000000_FILL0_wght400_GRAD0_opsz48.png' %}{% endif %}" 
                      data-white="{% static 'imagem/social_leaderboard_100dp_FFFFFF_FILL0_wght400_GRAD0_opsz48.png' %}"
                      data-black="{% static 'imagem/social_leaderboard_100dp_000000_FILL0_wght400_GRAD0_opsz48.png' %}"
                      alt="Ranking" class="w-6 h-6 nav-icon">
                    <span>Ranking</span>
                </a>

                <!-- F√≥rum -->
                <a href="{% url 'forum' %}" 
                   class="nav-btn flex items-center gap-3 px-4 py-3 rounded-xl font-medium border-2 border-transparent hover:border-blue-400 transition {% if request.resolver_match.url_name == 'forum' %}bg-blue-500 text-white{% endif %}"
                   id="nav-forum">
                    <img 
                      src="{% if request.resolver_match.url_name == 'forum' %}{% static 'imagem/forum_100dp_FFFFFF_FILL0_wght400_GRAD0_opsz48.png' %}{% else %}{% static 'imagem/forum_100dp_000000_FILL0_wght400_GRAD0_opsz48.png' %}{% endif %}" 
                      data-white="{% static 'imagem/forum_100dp_FFFFFF_FILL0_wght400_GRAD0_opsz48.png' %}"
                      data-black="{% static 'imagem/forum_100dp_000000_FILL0_wght400_GRAD0_opsz48.png' %}"
                      alt="F√≥rum" class="w-6 h-6 nav-icon">
                    <span>F√≥rum</span>
                </a>

                <!-- Perfil -->
                <a href="{% url 'perfil' %}" 
                   class="nav-btn flex items-center gap-3 px-4 py-3 rounded-xl font-medium border-2 border-transparent hover:border-blue-400 transition {% if request.resolver_match.url_name == 'perfil' %}bg-blue-500 text-white{% endif %}"
                   id="nav-perfil">
                    <img 
                      src="{% if request.resolver_match.url_name == 'perfil' %}{% static 'imagem/person_edit_100dp_FFFFFF_FILL0_wght400_GRAD0_opsz48.png' %}{% else %}{% static 'imagem/person_edit_100dp_000000_FILL0_wght400_GRAD0_opsz48.png' %}{% endif %}" 
                      data-white="{% static 'imagem/person_edit_100dp_FFFFFF_FILL0_wght400_GRAD0_opsz48.png' %}"
                      data-black="{% static 'imagem/person_edit_100dp_000000_FILL0_wght400_GRAD0_opsz48.png' %}"
                      alt="Perfil" class="w-6 h-6 nav-icon">
                    <span>Perfil</span>
                </a>

                {% if request.user.groups.all.0.name == 'professores' or request.user.is_staff %}
                <a href="{% url 'criar_conteudo' %}" 
                  class="nav-btn flex items-center gap-3 px-4 py-3 rounded-xl font-medium border-2 border-transparent hover:border-blue-400 transition {% if request.resolver_match.url_name == 'criar_conteudo' %}bg-blue-500 text-white{% endif %}"
                  id="nav-criar-conteudo">
                  <img 
                    src="{% if request.resolver_match.url_name == 'criar_conteudo' %}{% static 'imagem/contract_edit_100dp_FFFFFF_FILL0_wght400_GRAD0_opsz48.png' %}{% else %}{% static 'imagem/contract_edit_100dp_000000_FILL0_wght400_GRAD0_opsz48.png' %}{% endif %}" 
                    data-white="{% static 'imagem/contract_edit_100dp_FFFFFF_FILL0_wght400_GRAD0_opsz48.png' %}"
                    data-black="{% static 'imagem/contract_edit_100dp_000000_FILL0_wght400_GRAD0_opsz48.png' %}"
                    alt="Criar_conteudo" class="w-6 h-6 nav-icon">
                  <span>Criar Conte√∫do</span>
                </a>
                {% endif %}
            </div>

            <!-- Bot√£o de Logout -->
            <div class="pt-4 mt-4 border-t border-gray-200">
                <a href="{% url 'logout' %}" 
                   class="nav-btn flex items-center gap-3 px-4 py-3 rounded-xl font-medium border-2 border-transparent hover:border-blue-400 transition"
                   id="nav-logout">
                    <img 
                      src="{% static 'imagem/logout_100dp_2682EA_FILL0_wght400_GRAD0_opsz48.png' %}" 
                      alt="Sair" class="w-6 h-6">
                    <span>Sair</span>
                </a>
            </div>
        </nav>

        <!-- CONTE√öDO PRINCIPAL COM SCROLL E PADDING -->
        <section class="content-fixed custom-scrollbar">
            <div class="content-wrapper">
                {% block content %}
                <!-- O conte√∫do espec√≠fico de cada p√°gina ser√° inserido aqui -->
                {% endblock %}
            </div>
        </section>
    </div>
</div>

<!-- Modal Configura√ß√µes -->
<div id="config-modal" class="hidden fixed inset-0 bg-black/50 flex items-center justify-center z-50 animate-fadeIn">
  <div class="bg-white dark:bg-gray-800 w-11/12 max-w-md rounded-2xl shadow-2xl overflow-hidden animate-slideIn">
    <!-- Cabe√ßalho do Modal -->
    <div class="bg-blue-600 text-white p-5 flex justify-between items-center">
      <h2 class="text-xl font-bold">Configura√ß√µes</h2>
      <button id="close-config" class="text-white hover:text-blue-200 transition">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>
    </div>
    
    <!-- Conte√∫do do Modal -->
    <div class="p-5 max-h-96 overflow-y-auto custom-scrollbar">
      
      <!-- Configura√ß√µes de Notifica√ß√µes -->
      <div class="space-y-4 mb-6">
        <h3 class="font-semibold text-gray-700 dark:text-gray-300">Notifica√ß√µes</h3>
        
        <label class="flex items-center justify-between p-3 rounded-lg hover:bg-blue-50 dark:hover:bg-gray-700 transition cursor-pointer">
          <div>
            <span class="block text-gray-700 dark:text-gray-300">Notifica√ß√µes por email</span>
            <span class="block text-xs text-gray-500 dark:text-gray-400">Receba atualiza√ß√µes importantes</span>
          </div>
          <input type="checkbox" class="hidden peer" id="toggle-email">
          <div class="relative w-12 h-6 flex items-center bg-gray-300 rounded-full duration-300 ease-in-out peer-checked:bg-blue-500">
            <div class="bg-white w-4 h-4 rounded-full shadow-md transform duration-300 ease-in-out translate-x-1 peer-checked:translate-x-7"></div>
          </div>
        </label>
        
        <label class="flex items-center justify-between p-3 rounded-lg hover:bg-blue-50 dark:hover:bg-gray-700 transition cursor-pointer">
          <div>
            <span class="block text-gray-700 dark:text-gray-300">Notifica√ß√µes push</span>
            <span class="block text-xs text-gray-500 dark:text-gray-400">Permitir notifica√ß√µes do navegador</span>
          </div>
          <input type="checkbox" class="hidden peer" id="toggle-push">
          <div class="relative w-12 h-6 flex items-center bg-gray-300 rounded-full duration-300 ease-in-out peer-checked:bg-blue-500">
            <div class="bg-white w-4 h-4 rounded-full shadow-md transform duration-300 ease-in-out translate-x-1 peer-checked:translate-x-7"></div>
          </div>
        </label>
        
        <label class="flex items-center justify-between p-3 rounded-lg hover:bg-blue-50 dark:hover:bg-gray-700 transition cursor-pointer">
          <div>
            <span class="block text-gray-700 dark:text-gray-300">Som de notifica√ß√£o</span>
            <span class="block text-xs text-gray-500 dark:text-gray-400">Reproduzir som ao receber notifica√ß√µes</span>
          </div>
          <input type="checkbox" class="hidden peer" id="toggle-sound">
          <div class="relative w-12 h-6 flex items-center bg-gray-300 rounded-full duration-300 ease-in-out peer-checked:bg-blue-500">
            <div class="bg-white w-4 h-4 rounded-full shadow-md transform duration-300 ease-in-out translate-x-1 peer-checked:translate-x-7"></div>
          </div>
        </label>
      </div>
      
      <!-- Configura√ß√µes de Privacidade -->
      <div class="space-y-4">
        <h3 class="font-semibold text-gray-700 dark:text-gray-300">Privacidade</h3>
        
        <label class="flex items-center justify-between p-3 rounded-lg hover:bg-blue-50 dark:hover:bg-gray-700 transition cursor-pointer">
          <div>
            <span class="block text-gray-700 dark:text-gray-300">Perfil privado</span>
            <span class="block text-xs text-gray-500 dark:text-gray-400">Ocultar seu perfil de outros usu√°rios</span>
          </div>
          <input type="checkbox" class="hidden peer" id="toggle-private">
          <div class="relative w-12 h-6 flex items-center bg-gray-300 rounded-full duration-300 ease-in-out peer-checked:bg-blue-500">
            <div class="bg-white w-4 h-4 rounded-full shadow-md transform duration-300 ease-in-out translate-x-1 peer-checked:translate-x-7"></div>
          </div>
        </label>
        
        <label class="flex items-center justify-between p-3 rounded-lg hover:bg-blue-50 dark:hover:bg-gray-700 transition cursor-pointer">
          <div>
            <span class="block text-gray-700 dark:text-gray-300">Modo inc√≥gnito</span>
            <span class="block text-xs text-gray-500 dark:text-gray-400">N√£o aparecer online para outros</span>
          </div>
          <input type="checkbox" class="hidden peer" id="toggle-incognito">
          <div class="relative w-12 h-6 flex items-center bg-gray-300 rounded-full duration-300 ease-in-out peer-checked:bg-blue-500">
            <div class="bg-white w-4 h-4 rounded-full shadow-md transform duration-300 ease-in-out translate-x-1 peer-checked:translate-x-7"></div>
          </div>
        </label>
      </div>
    </div>
    
    <!-- Rodap√© do Modal -->
    <div class="bg-gray-100 dark:bg-gray-700 p-4 flex justify-end gap-3">
      <button id="cancel-config" class="px-4 py-2 rounded-lg text-gray-700 dark:text-gray-300 hover:bg-gray-200 dark:hover:bg-gray-600 transition">Cancelar</button>
      <button id="save-config" class="px-4 py-2 rounded-lg bg-blue-600 text-white hover:bg-blue-700 transition flex items-center gap-2">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
        </svg>
        Salvar Altera√ß√µes
      </button>
    </div>
  </div>
</div>

<!-- Caixa de Notifica√ß√µes -->
<div id="notify-box" class="hidden fixed top-20 right-6 w-80 bg-white dark:bg-gray-800 shadow-xl rounded-xl overflow-hidden z-40 border border-gray-200 dark:border-gray-700 animate-slideIn">
  <!-- Cabe√ßalho das Notifica√ß√µes -->
  <div class="bg-blue-600 text-white p-4 flex justify-between items-center">
    <h3 class="font-semibold">Notifica√ß√µes</h3>
    <button id="clear-notifications" class="text-sm bg-blue-500 hover:bg-blue-400 px-2 py-1 rounded transition">Limpar Tudo</button>
  </div>
  
  <!-- Lista de Notifica√ß√µes -->
  <div class="max-h-96 overflow-y-auto custom-scrollbar">
    <div class="p-2">
      <!-- Notifica√ß√£o n√£o lida -->
      <div class="notify-item p-3 rounded-lg bg-blue-50 dark:bg-gray-700 mb-2 cursor-pointer hover:shadow-md transition" data-id="1">
        <div class="flex gap-3">
          <div class="flex-shrink-0 w-10 h-10 bg-blue-100 dark:bg-blue-900 rounded-full flex items-center justify-center">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-blue-600 dark:text-blue-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
          </div>
          <div class="flex-1">
            <h4 class="font-medium text-gray-800 dark:text-gray-200">Miss√£o conclu√≠da!</h4>
            <p class="text-sm text-gray-600 dark:text-gray-400">Voc√™ completou "Introdu√ß√£o ao Python" +100 XP</p>
            <span class="text-xs text-blue-500 dark:text-blue-400">H√° 5 minutos</span>
          </div>
          <button class="notify-dismiss self-start text-gray-400 hover:text-gray-600 dark:hover:text-gray-300">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
            </svg>
          </button>
        </div>
      </div>
      
      <!-- Notifica√ß√£o n√£o lida -->
      <div class="notify-item p-3 rounded-lg bg-blue-50 dark:bg-gray-700 mb-2 cursor-pointer hover:shadow-md transition" data-id="2">
        <div class="flex gap-3">
          <div class="flex-shrink-0 w-10 h-10 bg-green-100 dark:bg-green-900 rounded-full flex items-center justify-center">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-green-600 dark:text-green-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 7h8m0 0v8m0-8l-8 8-4-4-6 6" />
            </svg>
          </div>
          <div class="flex-1">
            <h4 class="font-medium text-gray-800 dark:text-gray-200">Novo n√≠vel alcan√ßado!</h4>
            <p class="text-sm text-gray-600 dark:text-gray-400">Parab√©ns! Voc√™ alcan√ßou o n√≠vel 12</p>
            <span class="text-xs text-blue-500 dark:text-blue-400">H√° 1 hora</span>
          </div>
          <button class="notify-dismiss self-start text-gray-400 hover:text-gray-600 dark:hover:text-gray-300">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
            </svg>
          </button>
        </div>
      </div>
      
      <!-- Notifica√ß√£o n√£o lida -->
      <div class="notify-item p-3 rounded-lg bg-blue-50 dark:bg-gray-700 mb-2 cursor-pointer hover:shadow-md transition" data-id="3">
        <div class="flex gap-3">
          <div class="flex-shrink-0 w-10 h-10 bg-purple-100 dark:bg-purple-900 rounded-full flex items-center justify-center">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-purple-600 dark:text-purple-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
            </svg>
          </div>
          <div class="flex-1">
            <h4 class="font-medium text-gray-800 dark:text-gray-200">Nova mensagem</h4>
            <p class="text-sm text-gray-600 dark:text-gray-400">Voc√™ recebeu uma mensagem de PythonMaster</p>
            <span class="text-xs text-blue-500 dark:text-blue-400">H√° 3 horas</span>
          </div>
          <button class="notify-dismiss self-start text-gray-400 hover:text-gray-600 dark:hover:text-gray-300">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
            </svg>
          </button>
        </div>
      </div>
      
      <!-- Notifica√ß√£o lida -->
      <div class="notify-item p-3 rounded-lg mb-2 cursor-pointer hover:bg-gray-50 dark:hover:bg-gray-700 transition" data-id="4">
        <div class="flex gap-3">
          <div class="flex-shrink-0 w-10 h-10 bg-yellow-100 dark:bg-yellow-900 rounded-full flex items-center justify-center">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-yellow-600 dark:text-yellow-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
            </svg>
          </div>
          <div class="flex-1">
            <h4 class="font-medium text-gray-600 dark:text-gray-400">Desafio em andamento</h4>
            <p class="text-sm text-gray-500 dark:text-gray-500">Seu desafio semanal termina em 2 dias</p>
            <span class="text-xs text-gray-400">Ontem</span>
          </div>
          <button class="notify-dismiss self-start text-gray-400 hover:text-gray-600 dark:hover:text-gray-300">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
            </svg>
          </button>
        </div>
      </div>
    </div>
  </div>
  
  <!-- Rodap√© das Notifica√ß√µes -->
  <div class="bg-gray-100 dark:bg-gray-700 p-3 text-center">
    <a href="#" class="text-sm text-blue-600 dark:text-blue-400 hover:underline">Ver todas as notifica√ß√µes</a>
  </div>
</div>

<script>
  // ===== SISTEMA DE STREAK CORRIGIDO =====
  
  // Sistema de atualiza√ß√£o autom√°tica do streak
  function iniciarAtualizacaoStreak() {
      atualizarStatusStreak();
      
      // Atualizar a cada 30 segundos
      setInterval(atualizarStatusStreak, 30000);
  }

  async function atualizarStatusStreak() {
      try {
          const response = await fetch('/api/streak/');
          const data = await response.json();
          
          if (data.success) {
              // Atualizar display
              document.getElementById('sequencia-days').textContent = data.streak_atual + ' dias';
              
              // Atualizar fogo baseado no streak e atividade do dia
              atualizarFogoStreak(data.streak_atual, data.ja_fez_atividade_hoje);
              
              console.log('‚úÖ Status streak atualizado:', data.streak_atual, 'dias');
          }
      } catch (error) {
          console.log('Erro ao atualizar streak:', error);
      }
  }

  // Fun√ß√£o para atualizar o visual do fogo
    // Fun√ß√£o para atualizar o visual do fogo
  function atualizarFogoStreak(streakAtual, jaFezAtividadeHoje = null) {
      const fireElement = document.getElementById('sequencia-fire');
      const daysElement = document.getElementById('sequencia-days');
      
      if (!fireElement || !daysElement) return;
      
      // Usar dados do window.perfilData se n√£o fornecido
      if (jaFezAtividadeHoje === null && window.perfilData) {
          jaFezAtividadeHoje = window.perfilData.jaFezAtividadeHoje;
      }
      
      // Atualizar contador
      daysElement.textContent = streakAtual + ' dias';
      
      console.log('üéØ Atualizando fogo - Streak:', streakAtual, 'Atividade hoje:', jaFezAtividadeHoje);
      
      // L√ìGICA CORRIGIDA: Fogo aceso se j√° fez atividade HOJE E tem streak > 0
      if (jaFezAtividadeHoje && streakAtual > 0) {
          // Fogo ACESO - laranja vibrante com efeitos
          fireElement.className = 'fas fa-fire text-xl mr-1.5 text-orange-500 fire-glow animate-pulse';
          console.log('üî• Fogo ACESO - Atividade hoje + streak:', streakAtual);
      } else if (streakAtual > 0) {
          // Fogo "meio apagado" - tem streak mas n√£o fez atividade hoje
          fireElement.className = 'fas fa-fire text-xl mr-1.5 text-orange-300';
          fireElement.classList.remove('fire-glow', 'animate-pulse');
          console.log('üî∂ Fogo MEIO APAGADO - Streak mas sem atividade hoje');
      } else {
          // Fogo APAGADO - sem streak
          fireElement.className = 'fas fa-fire text-xl mr-1.5 text-gray-400';
          fireElement.classList.remove('fire-glow', 'animate-pulse');
          console.log('‚ö´ Fogo APAGADO - Sem streak');
      }
  }

  // Fun√ß√£o para registrar atividade e acender o fogo IMEDIATAMENTE
  async function registrarAtividadeStreak(aulaId = null) {
      try {
          const response = await fetch('/api/streak/registrar-atividade/', {
              method: 'POST',
              headers: {
                  'Content-Type': 'application/json',
                  'X-CSRFToken': getCookie('csrftoken')
              },
              body: JSON.stringify({ 
                  aula_id: aulaId,
                  tipo: 'pratica'  // ou 'teoria' dependendo da atividade
              })
          });
          
          const data = await response.json();
          
          if (data.success) {
              // ‚úÖ ATUALIZA√á√ÉO IMEDIATA DO FOCO - SEM DELAY
              const fireElement = document.getElementById('sequencia-fire');
              const daysElement = document.getElementById('sequencia-days');
              
              // ACENDER O FOCO IMEDIATAMENTE
              fireElement.className = 'fas fa-fire text-xl mr-1.5 text-orange-500 fire-glow animate-pulse';
              daysElement.textContent = data.streak_atual + ' dias';
              
              // Efeito visual de celebra√ß√£o
              celebrarStreak(data.streak_aumentado);
              
              console.log('üéØ Atividade registrada! Streak:', data.streak_atual);
              return true;
          } else {
              console.error('Erro ao registrar atividade:', data.error);
              return false;
          }
      } catch (error) {
          console.error('Erro ao registrar atividade:', error);
          return false;
      }
  }

  // Fun√ß√£o para celebrar aumento de streak
  function celebrarStreak(streakAumentado) {
      if (streakAumentado) {
          // Efeito especial quando o streak aumenta
          const fireElement = document.getElementById('sequencia-fire');
          
          // Pulsa√ß√£o mais intensa
          fireElement.classList.add('animate-pulse');
          setTimeout(() => {
              fireElement.classList.remove('animate-pulse');
          }, 2000);
          
          // Mostrar notifica√ß√£o de celebra√ß√£o
          mostrarNotificacao('üî• Streak aumentou! Continue assim!', 'success');
      }
  }

  // ===== SISTEMA DE VIDAS CORRIGIDO =====
  
  function iniciarAtualizacaoVidas() {
      atualizarStatusVidas();
      setInterval(atualizarStatusVidas, 30000);
  }

  async function atualizarStatusVidas() {
      try {
          const response = await fetch('/api/vidas/status/');
          const data = await response.json();
          
          if (data.success) {
              document.getElementById('vidas-count').textContent = data.vidas;
              const heartIcon = document.getElementById('heart-icon');
              
              if (data.vidas === 0) {
                  heartIcon.className = 'fas fa-heart-crack text-gray-400 text-lg mr-1.5';
              } else {
                  heartIcon.className = 'fas fa-heart text-red-500 text-lg mr-1.5';
              }
          }
      } catch (error) {
          console.log('Erro ao atualizar vidas:', error);
      }
  }

  async function usarVida(aulaId = null) {
      try {
          const response = await fetch('/api/vidas/usar/', {
              method: 'POST',
              headers: {
                  'Content-Type': 'application/json',
                  'X-CSRFToken': getCookie('csrftoken')
              },
              body: JSON.stringify({ aula_id: aulaId })
          });
          
          const data = await response.json();
          
          if (data.success) {
              document.getElementById('vidas-count').textContent = data.vidas_restantes;
              animarCoracao();
              return true;
          } else {
              mostrarNotificacao('Sem vidas dispon√≠veis!', 'error');
              return false;
          }
      } catch (error) {
          mostrarNotificacao('Erro ao usar vida', 'error');
          return false;
      }
  }

  // Helper para pegar CSRF token
  function getCookie(name) {
      let cookieValue = null;
      if (document.cookie && document.cookie !== '') {
          const cookies = document.cookie.split(';');
          for (let i = 0; i < cookies.length; i++) {
              const cookie = cookies[i].trim();
              if (cookie.substring(0, name.length + 1) === (name + '=')) {
                  cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                  break;
              }
          }
      }
      return cookieValue;
  }

  // Fun√ß√µes de utilidade
  function animarCoracao() {
      const heartIcon = document.getElementById('heart-icon');
      heartIcon.classList.add('heart-pulse');
      setTimeout(() => heartIcon.classList.remove('heart-pulse'), 600);
  }

  function mostrarNotificacao(mensagem, tipo = 'info') {
      const notification = document.createElement('div');
      const bgColor = tipo === 'success' ? 'bg-green-500' : 
                     tipo === 'error' ? 'bg-red-500' : 'bg-blue-500';
      
      notification.className = `fixed top-4 right-4 ${bgColor} text-white p-4 rounded-lg shadow-lg z-50 transform transition-transform duration-300 translate-x-full`;
      notification.innerHTML = `
          <div class="flex items-center">
              <i class="fas fa-${tipo === 'success' ? 'check' : tipo === 'error' ? 'exclamation-triangle' : 'info'} mr-2"></i>
              <span>${mensagem}</span>
          </div>
      `;
      
      document.body.appendChild(notification);
      
      setTimeout(() => notification.classList.remove('translate-x-full'), 100);
      setTimeout(() => {
          notification.classList.add('translate-x-full');
          setTimeout(() => notification.remove(), 300);
      }, 5000);
  }

  // ===== SISTEMA ORIGINAL (MANTIDO) =====

  // Bot√£o Configura√ß√µes
  const btnConfig = document.getElementById("btn-config");
  const configModal = document.getElementById("config-modal");
  const closeConfig = document.getElementById("close-config");
  const cancelConfig = document.getElementById("cancel-config");
  const saveConfig = document.getElementById("save-config");

  if (btnConfig) {
      btnConfig.addEventListener("click", () => {
          configModal.classList.remove("hidden");
          document.body.style.overflow = 'hidden';
      });
  }

  function closeConfigModal() {
      configModal.classList.add("hidden");
      document.body.style.overflow = '';
  }

  if (closeConfig) closeConfig.addEventListener("click", closeConfigModal);
  if (cancelConfig) cancelConfig.addEventListener("click", closeConfigModal);

  configModal.addEventListener("click", (e) => {
      if (e.target === configModal) closeConfigModal();
  });

  if (saveConfig) {
      saveConfig.addEventListener("click", () => {
          saveConfig.innerHTML = `
            <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
            </svg>
            Salvo!
          `;
          saveConfig.classList.add('bg-green-600', 'hover:bg-green-700');
          
          setTimeout(() => {
              closeConfigModal();
              setTimeout(() => {
                  saveConfig.innerHTML = `
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                    </svg>
                    Salvar Altera√ß√µes
                  `;
                  saveConfig.classList.remove('bg-green-600', 'hover:bg-green-700');
              }, 1000);
          }, 1000);
      });
  }

  // Bot√£o Notifica√ß√µes
  const btnNotify = document.getElementById("btn-notify");
  const notifyBox = document.getElementById("notify-box");
  const clearNotifications = document.getElementById("clear-notifications");
  const notificationCounter = document.querySelector('#btn-notify span');

  if (btnNotify) {
      btnNotify.addEventListener("click", (e) => {
          e.stopPropagation();
          notifyBox.classList.toggle("hidden");
          
          if (!notifyBox.classList.contains("hidden")) {
              const unreadNotifications = document.querySelectorAll('.notify-item.bg-blue-50, .notify-item.dark\\:bg-gray-700');
              unreadNotifications.forEach(notification => {
                  notification.classList.remove('bg-blue-50', 'dark:bg-gray-700');
                  notification.classList.add('bg-white', 'dark:bg-gray-800');
              });
              
              if (notificationCounter) {
                  notificationCounter.textContent = '0';
                  notificationCounter.classList.remove('animate-pulse');
              }
          }
      });
  }

  document.addEventListener('click', (e) => {
      if (notifyBox && !notifyBox.contains(e.target) && e.target !== btnNotify && !btnNotify.contains(e.target)) {
          notifyBox.classList.add('hidden');
      }
  });

  if (clearNotifications) {
      clearNotifications.addEventListener('click', () => {
          const notificationItems = document.querySelectorAll('.notify-item');
          notificationItems.forEach(item => {
              item.style.opacity = '0';
              item.style.transition = 'opacity 0.3s ease';
              setTimeout(() => item.remove(), 300);
          });
          
          if (notificationCounter) {
              notificationCounter.textContent = '0';
              notificationCounter.classList.remove('animate-pulse');
          }
          
          setTimeout(() => {
              const emptyMessage = document.createElement('div');
              emptyMessage.className = 'p-4 text-center text-gray-500';
              emptyMessage.textContent = 'Nenhuma notifica√ß√£o';
              notifyBox.querySelector('.p-2').appendChild(emptyMessage);
          }, 350);
      });
  }

  // Fechar notifica√ß√µes individualmente
  document.querySelectorAll('.notify-dismiss').forEach(button => {
      button.addEventListener('click', (e) => {
          e.stopPropagation();
          const notificationItem = button.closest('.notify-item');
          notificationItem.style.opacity = '0';
          notificationItem.style.transition = 'opacity 0.3s ease';
          
          setTimeout(() => {
              notificationItem.remove();
              
              const unreadCount = document.querySelectorAll('.notify-item.bg-blue-50, .notify-item.dark\\:bg-gray-700').length;
              if (notificationCounter) {
                  notificationCounter.textContent = unreadCount;
                  if (unreadCount === 0) {
                      notificationCounter.classList.remove('animate-pulse');
                  }
              }
          }, 300);
      });
  });

  // ===== FUN√á√ïES GLOBAIS =====

  // Fun√ß√£o global para registrar atividade
  window.registrarAtividadeStreak = registrarAtividadeStreak;
  window.usarVida = usarVida;

  // Fun√ß√£o global para ser chamada quando completar uma atividade
  window.completarAtividade = function(aulaId = null) {
      // Registrar atividade no streak
      registrarAtividadeStreak(aulaId);
      
      // Atualizar status das vidas (caso tenha usado)
      atualizarStatusVidas();
  };

      // Inicializar quando a p√°gina carregar
  document.addEventListener('DOMContentLoaded', function() {
      // Iniciar sistemas
      iniciarRegeneracaoVidas(); // ‚úÖ FALTANDO ESTA CHAMADA
      iniciarAtualizacaoVidas();
      iniciarAtualizacaoStreak();
      
      // üî• CORRE√á√ÉO: For√ßar atualiza√ß√£o visual imediata do fogo
      const fireElement = document.getElementById('sequencia-fire');
      const daysElement = document.getElementById('sequencia-days');
      
      if (fireElement && daysElement) {
          const streakAtual = parseInt(daysElement.textContent) || 0;
          const isFireLit = fireElement.classList.contains('text-orange-500');
          
          console.log('üéØ Estado inicial - Streak:', streakAtual, 'Fogo aceso:', isFireLit);
          
          // L√≥gica direta: se tem streak > 0, acende o fogo
          if (streakAtual > 0) {
              fireElement.className = 'fas fa-fire text-xl mr-1.5 text-orange-500 fire-glow';
              console.log('üî• Fogo ACESO no carregamento');
          } else {
              fireElement.className = 'fas fa-fire text-xl mr-1.5 text-gray-400';
              console.log('‚ö´ Fogo APAGADO no carregamento');
          }
      }
      
      // Fazer uma verifica√ß√£o via API ap√≥s 2 segundos (fallback)
      setTimeout(() => {
          atualizarStatusStreak();
      }, 2000);
      
      console.log('üî• Sistema de streak inicializado');
  });
 

  // Mantenha tamb√©m a fun√ß√£o original para compatibilidade
  function iniciarAtualizacaoVidas() {
      atualizarStatusVidas();
      setInterval(atualizarStatusVidas, 30000);
  }

  async function atualizarStatusVidas() {
      try {
          const response = await fetch('/api/vidas/status/');
          const data = await response.json();
          
          if (data.success) {
              document.getElementById('vidas-count').textContent = data.vidas;
              const heartIcon = document.getElementById('heart-icon');
              
              if (data.vidas === 0) {
                  heartIcon.className = 'fas fa-heart-crack text-gray-400 text-lg mr-1.5';
              } else {
                  heartIcon.className = 'fas fa-heart text-red-500 text-lg mr-1.5';
              }
              
              console.log('‚ù§Ô∏è Status vidas atualizado:', data.vidas);
          }
      } catch (error) {
          console.log('Erro ao atualizar vidas:', error);
      }
  }
  function iniciarRegeneracaoVidas() {
      console.log('üîÑ Iniciando sistema de regenera√ß√£o de vidas...');
      
      // Verificar a cada 30 segundos
      setInterval(async () => {
          await verificarERegenerarVidas();
      }, 30000); // 30 segundos
      
      // Verificar imediatamente ao carregar
      verificarERegenerarVidas();
  }

  async function verificarERegenerarVidas() {
      try {
          console.log('üîç Verificando regenera√ß√£o de vidas...');
          
          const response = await fetch('/api/vidas/status/');
          const data = await response.json();
          
          if (data.success) {
              // Atualizar display
              document.getElementById('vidas-count').textContent = data.vidas;
              
              // Atualizar √≠cone do cora√ß√£o
              const heartIcon = document.getElementById('heart-icon');
              if (data.vidas === 0) {
                  heartIcon.className = 'fas fa-heart-crack text-gray-400 text-lg mr-1.5';
              } else {
                  heartIcon.className = 'fas fa-heart text-red-500 text-lg mr-1.5';
              }
              
              console.log(`‚ù§Ô∏è Vidas: ${data.vidas}/${data.max_vidas} | Pr√≥xima em: ${data.tempo_para_proxima_vida}min`);
              
              // Mostrar notifica√ß√£o se vida regenerou
              if (data.vidas > 0 && data.tempo_para_proxima_vida === 0) {
                  mostrarNotificacaoVidaRegenerada();
              }
          }
      } catch (error) {
          console.log('‚ùå Erro ao verificar vidas:', error);
      }
  }

  

  // ===== ATUALIZA√á√ÉO DA VIEW api_vidas_status =====
</script>

{% block extra_js %}{% endblock %}
</body>
</html>